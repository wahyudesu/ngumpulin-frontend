!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9adf2dda-02e6-4d12-944f-0049bcb76bba",e._sentryDebugIdIdentifier="sentry-dbid-9adf2dda-02e6-4d12-944f-0049bcb76bba")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7752],{95034:function(e,t,n){n.d(t,{Q:function(){return F},G:function(){return z}});var s=n(97458),r=n(52983),a=n(41341),o=n(19168),i=n(5546),l=n(63204),c=n(98038),d=n(15997),u=n(77518),m=n(98809);let h=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"ServiceRoleIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("rect",{x:"37.161",y:".53",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 10.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"15.964",y:".53",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 5.53h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},x=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"53",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AnonIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("path",{d:"M1 4.994a.5.5 0 0 0 0 1v-1Zm16.218 1h.5v-1h-.5v1ZM1 5.994h1.014v-1H1v1Zm3.04 0h2.028v-1H4.041v1Zm4.056 0h2.027v-1H8.096v1Zm4.054 0h2.027v-1H12.15v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m15.92 12.56 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"15.964",y:".494",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"37.161",y:".744",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M1 10.494h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M15.96 7.562 22.568.956M19.049 14.885l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})},f=e=>{let{isSelected:t=!1}=e,{resolvedTheme:n}=(0,m.F)();return(0,s.jsx)("svg",{width:"68",height:"17",fill:"none",xmlns:"http://www.w3.org/2000/svg","data-sentry-element":"svg","data-sentry-component":"AuthenticatedIcon","data-sentry-source-file":"Icons.tsx",children:(0,s.jsxs)("g",{opacity:t?"1":".5","data-sentry-element":"g","data-sentry-source-file":"Icons.tsx",children:[(0,s.jsx)("path",{d:"M15.63 5.156a.5.5 0 1 0 0 1v-1Zm16.218 1h.5v-1h-.5v1Zm-16.218 0h1.013v-1H15.63v1Zm3.04 0h2.028v-1h-2.027v1Zm4.055 0h2.028v-1h-2.028v1Zm4.055 0h2.027v-1H26.78v1Zm4.055 0h1.013v-1h-1.013v1Z",fill:"light"===n?"#7E868C":"#7E7E7E","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m30.55 12.722 9.04-9.04",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"30.594",y:".656",width:"9",height:"15",rx:"4.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("rect",{x:"51.791",y:".906",width:"15",height:"15",rx:"5.5",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"rect","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M15.63 10.656h32.214",stroke:"#33A7E9",strokeLinecap:"round",strokeDasharray:"2 2","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"m30.59 7.724 6.607-6.606M33.679 15.047l5.957-5.958",stroke:"light"===n?"#11181C":"#EDEDED","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"}),(0,s.jsx)("path",{d:"M12.666 14.281v-1.333A2.667 2.667 0 0 0 10 10.28H6a2.667 2.667 0 0 0-2.667 2.667v1.333M8 7.615A2.667 2.667 0 1 0 8 2.28a2.667 2.667 0 0 0 0 5.334Z",stroke:"light"===n?"#11181C":"#EDEDED",strokeLinecap:"round",strokeLinejoin:"round","data-sentry-element":"path","data-sentry-source-file":"Icons.tsx"})]})})};var p=n(45196),g=n(62431),v=function(e){let{label:t,value:n,isSelected:r,onSelectedChange:a,icon:o}=e;return(0,s.jsxs)("label",{className:(0,i.cn)("border border-default rounded-md bg-surface-200 hover:bg-overlay-hover hover:border-control px-4 py-3 w-44 cursor-pointer transition-colors",r&&"border-foreground-muted hover:border-foreground-muted bg-surface-300"),tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&a(n)},htmlFor:"role-".concat(n),"data-sentry-component":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationRadio.tsx",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[o&&(0,s.jsx)("div",{children:o}),r&&(0,s.jsxs)("div",{className:"flex items-center justify-center p-0.5 bg-foreground text-background rounded-full",children:["boolean"==typeof r&&(0,s.jsx)(p.Z,{size:12,strokeWidth:"4",className:"text-background"}),"partially"===r&&(0,s.jsx)(g.Z,{size:12,strokeWidth:"4",className:"text-background"})]})]}),(0,s.jsx)("input",{id:"role-".concat(n),type:"radio",name:"role",value:n,checked:!!r,onChange:e=>{a(e.target.value)},className:"invisible h-0 w-0 border-0"}),(0,s.jsxs)("span",{className:(0,i.cn)("text-sm text-foreground-light whitespace-nowrap select-none transition-colors",r&&"text-foreground"),children:[null!=t?t:n," role"]})]})},y=n(23382),j=n(70437),b=n(78854),w=n(14415),N=n(2552),S=n(20170),D=n(61223),R=n(83154),C=n(96789),k=n(20821),E=n(16787),A=n(33074),I=n(62365),_=()=>{var e,t,n,a;let[i,c]=(0,r.useState)(""),[u,m]=(0,r.useState)("aal1"),h=(0,d.fN)(),x=(0,y.Nr)(i,300),{project:f}=(0,S.d2)(),{data:p,isSuccess:g,isLoading:v,isError:_,error:z,isFetching:F,isPreviousData:T}=(0,R.x7)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,keywords:x.trim().toLocaleLowerCase()},{keepPreviousData:!0}),M=(0,r.useMemo)(()=>{var e;return null!==(e=null==p?void 0:p.pages.flatMap(e=>e.result))&&void 0!==e?e:[]},[null==p?void 0:p.pages]),W=(null===(e=h.role)||void 0===e?void 0:e.type)==="postgrest"&&"authenticated"===h.role.role&&h.role.user;function U(e){h.setRole({type:"postgrest",role:"authenticated",user:e,aal:u})}return(0,s.jsxs)("div",{className:"flex flex-col gap-1","data-sentry-component":"UserImpersonationSelector","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsx)("h2",{className:"text-foreground text-sm",children:W?"Impersonating ".concat((0,I.Gf)(W,null!==(a=null!==(n=null!==(t=W.email)&&void 0!==t?t:W.phone)&&void 0!==n?n:W.id)&&void 0!==a?a:"Unknown")):"Impersonate a User"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:W?"Results will respect your database's Row-Level Security policies for this user.":"Select a user to respect your database's Row-Level Security policies for that particular user."}),W?(0,s.jsx)(L,{user:W,onClick:function(){h.setRole(void 0)},isImpersonating:!0,aal:u}):(0,s.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,s.jsx)(C.Z,{className:"table-editor-search border-none",icon:T&&F?(0,s.jsx)(j.Z,{className:"animate-spin text-foreground-lighter",size:16,strokeWidth:1.5}):(0,s.jsx)(b.Z,{className:"text-foreground-lighter",size:16,strokeWidth:1.5}),placeholder:"Search for a user..",onChange:e=>c(e.target.value),value:i,size:"small",actions:i&&(0,s.jsx)(o.z,{size:"tiny",type:"text",className:"px-1",onClick:()=>c(""),children:(0,s.jsx)(w.Z,{size:12,strokeWidth:2})})}),(0,s.jsxs)(k.zF,{children:[(0,s.jsx)(k.wy,{className:"group font-normal p-0 [&[data-state=open]>div>svg]:!-rotate-180",children:(0,s.jsxs)("div",{className:"flex items-center gap-x-1 w-full",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light group-hover:text-foreground transition",children:"Advanced options"}),(0,s.jsx)(l.Z,{className:"transition-transform duration-200",strokeWidth:1.5,size:14})]})}),(0,s.jsxs)(k.Fw,{className:"mt-1 flex flex-row items-center gap-x-4 text-sm text-foreground-light",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,s.jsx)("h3",{children:"MFA assurance level"}),(0,s.jsxs)(A.b,{side:"top",className:"flex flex-col gap-1 max-w-96",children:[(0,s.jsxs)("p",{children:["AAL1 verifies users via standard login methods, while AAL2 adds a second authentication factor.",(0,s.jsx)("br",{}),"If you're not using MFA, you can leave this on AAL1."]}),(0,s.jsxs)("a",{href:"/docs/guides/auth/auth-mfa",target:"_blank",rel:"noreferrer",className:"flex items-center gap-x-1 opacity-50 hover:opacity-100 transition",children:["Learn more about MFA ",(0,s.jsx)(N.Z,{size:14,strokeWidth:2})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-row items-center gap-x-2 text-xs font-bold",children:[(0,s.jsx)("p",{className:"aal1"===u?void 0:"text-foreground-lighter",children:"AAL1"}),(0,s.jsx)(E.r,{checked:"aal2"===u,onCheckedChange:function(){m(e=>"aal2"===e?"aal1":"aal2")}}),(0,s.jsx)("p",{className:"aal2"===u?void 0:"text-foreground-lighter",children:"AAL2"})]})]})]}),v&&(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:[(0,s.jsx)(j.Z,{className:"animate-spin",size:24}),(0,s.jsx)("span",{children:"Loading users..."})]}),_&&(0,s.jsx)(D.Z,{error:z,subject:"Failed to retrieve users"}),g&&(M.length>0?(0,s.jsx)("ul",{className:"divide-y max-h-[150px] overflow-y-scroll",role:"list",children:M.map(e=>(0,s.jsx)("li",{role:"listitem",children:(0,s.jsx)(Z,{user:e,onClick:U})},e.id))}):(0,s.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center h-24",children:(0,s.jsx)("p",{className:"text-foreground-light text-xs",role:"status",children:"No users found"})}))]})]})};let L=e=>{var t,n,r;let{user:a,onClick:i,isImpersonating:l=!1,aal:d}=e,u=(0,I.E$)(a),m=(0,I.Gf)(a,null!==(r=null!==(n=null!==(t=a.email)&&void 0!==t?t:a.phone)&&void 0!==n?n:a.id)&&void 0!==r?r:"Unknown")+(a.is_anonymous?" (anonymous)":"");return(0,s.jsxs)("div",{className:"flex items-center gap-3 py-2 text-foreground","data-sentry-component":"UserImpersonatingRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-surface-200 pr-4 pl-0.5 py-0.5 border rounded-full max-w-l",children:[u?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:u,alt:m}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border border-strong flex items-center justify-center",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsxs)("span",{className:"text-sm truncate",children:[m," ",(0,s.jsx)("span",{className:"ml-2 text-foreground-lighter text-xs font-light",children:"aal2"===d?"AAL2":"AAL1"})]})]}),(0,s.jsx)(o.z,{type:"default",onClick:()=>i(a),"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:l?"Stop Impersonating":"Impersonate"})]})},Z=e=>{var t,n,r;let{user:a,onClick:i,isImpersonating:l=!1}=e,d=(0,I.E$)(a),u=(0,I.Gf)(a,null!==(r=null!==(n=null!==(t=a.email)&&void 0!==t?t:a.phone)&&void 0!==n?n:a.id)&&void 0!==r?r:"Unknown")+(a.is_anonymous?" (anonymous)":"");return(0,s.jsxs)("div",{className:"flex items-center justify-between py-1 text-foreground","data-sentry-component":"UserRow","data-sentry-source-file":"UserImpersonationSelector.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[d?(0,s.jsx)("img",{className:"rounded-full w-5 h-5",src:d,alt:u}):(0,s.jsx)("div",{className:"rounded-full w-[21px] h-[21px] bg-surface-300 border text-muted flex items-center justify-center text-background",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"text-sm",children:u})]}),(0,s.jsx)(o.z,{type:"default",onClick:()=>i(a),"data-sentry-element":"Button","data-sentry-source-file":"UserImpersonationSelector.tsx",children:l?"Stop Impersonating":"Impersonate"})]})};var z=e=>{var t;let{serviceRoleLabel:n,padded:a=!0}=e,o=(0,d.fN)(),[l,c]=(0,r.useState)(()=>{var e;return(null===(e=o.role)||void 0===e?void 0:e.type)==="postgrest"&&("anon"===o.role.role||"authenticated"===o.role.role)?o.role.role:"service_role"}),m=!!("authenticated"===l&&(null===(t=o.role)||void 0===t?void 0:t.type)==="postgrest"&&"authenticated"===o.role.role&&o.role.user);function p(e){"service_role"===e&&o.setRole(void 0),"anon"===e&&o.setRole({type:"postgrest",role:e}),c(e)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-3",a?"p-5":"pb-5"),children:[(0,s.jsx)("h2",{className:"text-foreground text-base",children:"Database role settings"}),(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,s.jsxs)("fieldset",{className:"flex gap-3",children:[(0,s.jsx)(v,{value:"service_role",isSelected:"service_role"===l,onSelectedChange:p,label:n,icon:(0,s.jsx)(h,{isSelected:"service_role"===l}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,s.jsx)(v,{value:"anon",isSelected:"anon"===l,onSelectedChange:p,icon:(0,s.jsx)(x,{isSelected:"anon"===l}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"}),(0,s.jsx)(v,{value:"authenticated",isSelected:"authenticated"===l&&(m||"partially"),onSelectedChange:p,icon:(0,s.jsx)(f,{isSelected:"authenticated"===l}),"data-sentry-element":"RoleImpersonationRadio","data-sentry-source-file":"RoleImpersonationSelector.tsx"})]})}),"service_role"===l&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["The default Postgres/superuser role. This has admin privileges.",(0,s.jsx)("br",{}),"It will bypass Row Level Security (RLS) policies."]}),"anon"===l&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "anonymous access". This is the role which the API (PostgREST) will use when a user',(0,s.jsx)("br",{}),"is not logged in. It will respect Row Level Security (RLS) policies."]}),"authenticated"===l&&(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:['For "authenticated access". This is the role which the API (PostgREST) will use when',(0,s.jsx)("br",{})," a user is logged in. It will respect Row Level Security (RLS) policies."]})]}),"authenticated"===l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.VD,{}),(0,s.jsx)("div",{className:(0,i.cn)("py-5",a&&"px-5"),children:(0,s.jsx)(_,{})})]})]})},F=e=>{var t,n,c,u;let{serviceRoleLabel:m,variant:h="regular",align:x="end"}=e,f=(0,d.fN)(),[p,g]=(0,r.useState)(!1),v=null!==(u=null!==(c=null===(t=f.role)||void 0===t?void 0:t.role)&&void 0!==c?c:m)&&void 0!==u?u:"service role";return(0,s.jsxs)(a.J2,{open:p,onOpenChange:g,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"RoleImpersonationPopover","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[(0,s.jsx)(a.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsx)(o.z,{size:"tiny",type:"default",className:(0,i.cn)("h-[26px] pr-3 gap-0","connected-on-right"===h&&"rounded-r-none border-r-0","connected-on-left"===h&&"rounded-l-none border-l-0","connected-on-both"===h&&"rounded-none border-x-0"),"data-sentry-element":"Button","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-foreground-muted",children:"role"}),(0,s.jsx)("span",{children:v}),(null===(n=f.role)||void 0===n?void 0:n.type)==="postgrest"&&"authenticated"===f.role.role&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T,{user:f.role.user}),(0,s.jsx)("span",{className:"text-xs text-foreground-lighter font-light",children:"aal2"===f.role.aal?"AAL2":"AAL1"})]}),(0,s.jsx)(l.Z,{className:"text-muted",strokeWidth:1,size:12,"data-sentry-element":"ChevronDown","data-sentry-source-file":"RoleImpersonationPopover.tsx"})]})})}),(0,s.jsx)(a.yk,{className:"p-0 w-full overflow-hidden",side:"bottom",align:x,"data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:(0,s.jsx)(z,{serviceRoleLabel:m,"data-sentry-element":"RoleImpersonationSelector","data-sentry-source-file":"RoleImpersonationPopover.tsx"})})]})};let T=e=>{var t,n,r;let{user:a}=e,o=(0,I.E$)(a),i=(0,I.Gf)(a,null!==(r=null!==(n=null!==(t=a.email)&&void 0!==t?t:a.phone)&&void 0!==n?n:a.id)&&void 0!==r?r:"Unknown");return(0,s.jsxs)("div",{className:"flex gap-1 items-center pl-0.5 pr-1.5 h-[21px] bg-surface-200 rounded-full overflow-hidden","data-sentry-component":"UserRoleButtonSection","data-sentry-source-file":"RoleImpersonationPopover.tsx",children:[o?(0,s.jsx)("img",{className:"rounded-full w-[18px] h-[18px]",src:o,alt:i}):(0,s.jsx)("div",{className:"rounded-full w-[18px] h-[18px] bg-surface-100 border flex items-center justify-center text-light",children:(0,s.jsx)(c.Z,{size:12,strokeWidth:2})}),(0,s.jsx)("span",{className:"truncate max-w-[84px]",children:i})]})}},49576:function(e,t,n){n.d(t,{l5:function(){return en.Z},mM:function(){return ej}});var s=n(97458),r=n(198),a=n(36457),o=n(26969),i=n.n(o),l=n(86474),c=n.n(l),d=n(53995),u=n(34549),m=n(45925),h=n(69468),x=n(4673),f=n(20170),p=n(26655),g=n(69171),v=n(24158),y=n(12025),j=n(87790),b=n(9374),w=n(46327),N=n(43428),S=n(7097),D=n(15997),R=n(44190),C=n(59205),k=n(67328),E=n(86173),A=n(88418),I=n(37669),_=n.n(I),L=n(52983),Z=n(27299),z=n(54811),F=n(13430),T=n(97881),M=n(18429),W=n(4621),U=n(33645),P=n(93066),q=n(77585),O=n(55604),G=n(82445),Q=n(19168),H=n(5546),V=n(41341),J=n(59863),K=n(587),B=n(95034),X=e=>{var t;let{table:n}=e,{ref:a}=(0,m.UO)(),{project:o}=(0,f.d2)(),{data:i=[]}=(0,P.U)({projectRef:null==o?void 0:o.ref}),l=(0,g.N3)(n),c=(0,g.GV)(n),d=(0,g.Du)(n),h=(0,g.z_)(n),x=(0,O.N)("realtime:all"),p=N.s.includes(n.schema),{mutate:v}=(0,q.V)({onError:e=>{u.Am.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{ef()}}),[y,b]=(0,L.useState)(!1),[w,S]=(0,L.useState)(!1),[D,R]=(0,L.useState)(!1),{selectedRows:I}=(0,Z.Qq)(),X=0===I.size,Y=null==o?void 0:o.ref,{data:$}=(0,M.r)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),ee=(null!=$?$:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:et}=(0,W.z)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),en=(null!=et?et:[]).find(e=>"supabase_realtime"===e.name),es=null!==(t=null==en?void 0:en.tables)&&void 0!==t?t:[],er=es.some(e=>e.id===(null==n?void 0:n.id)),{mutate:ea,isLoading:eo}=(0,U.u)({onSuccess:()=>{b(!1)},onError:e=>{u.Am.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),ei=(0,j.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"tables"),el=(0,j.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"columns"),ec="public"===n.schema,{hasLint:ed,matchingLint:eu}=(0,z.R)(n.name,"security_definer_view",["ERROR","WARN"],i,n.schema),{hasLint:em,matchingLint:eh}=(0,z.R)(n.name,"materialized_view_in_api",["ERROR","WARN"],i,n.schema),ex=async()=>{if(!o)return console.error("Project is required");if(!en)return console.error("Unable to find realtime publication");let e=es.some(e=>e.id==n.id)?es.filter(e=>e.id!=n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(es.map(e=>"".concat(e.schema,".").concat(e.name)));ea({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:en.id,tables:e})},ef=()=>{R(!1)},ep=async()=>{let e={id:n.id,rls_enabled:!(l&&n.rls_enabled)};v({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,id:e.id,schema:n.schema,payload:e})};return(0,s.jsxs)(s.Fragment,{children:[X&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ei&&!el&&(0,s.jsxs)(G.u,{children:[(0,s.jsx)(G.aJ,{asChild:!0,children:(0,s.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,s.jsx)(G._v,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),l?n.rls_enabled?(0,s.jsx)(s.Fragment,{children:ee.length<1&&!p?(0,s.jsx)(T.u,{asChild:!0,type:"default",className:"group",icon:(0,s.jsx)(C.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,s.jsx)(_(),{passHref:!0,href:"/project/".concat(Y,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:"Add RLS policy"})}):(0,s.jsx)(Q.z,{asChild:!0,type:ee.length<1&&!p?"warning":"default",className:"group",icon:p||ee.length>0?(0,s.jsx)("div",{className:(0,H.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",ee.length>9?" px-1":"w-[16px]",""),children:(0,s.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:ee.length})}):(0,s.jsx)(C.Z,{strokeWidth:1.5}),children:(0,s.jsxs)(_(),{passHref:!0,href:"/project/".concat(Y,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:["Auth ",ee.length>1?"policies":"policy"]})})}):(0,s.jsxs)(V.J2,{open:w,onOpenChange:()=>S(!w),modal:!1,children:[(0,s.jsx)(V.xo,{asChild:!0,children:(0,s.jsx)(Q.z,{type:"warning",icon:(0,s.jsx)(k.Z,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,s.jsxs)(V.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(k.Z,{size:16})," Row Level Security (RLS)"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,s.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!p&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Q.z,{type:"default",onClick:()=>R(!D),children:"Enable RLS for this table"})})]})]})]}):null,d&&ed&&(0,s.jsxs)(V.J2,{open:w,onOpenChange:()=>S(!w),modal:!1,children:[(0,s.jsx)(V.xo,{asChild:!0,children:(0,s.jsx)(Q.z,{type:"warning",icon:(0,s.jsx)(E.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,s.jsxs)(V.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Z,{size:16})," Secure your View"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,s.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Q.z,{type:"default",asChild:!0,children:(0,s.jsx)(_(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==eu?void 0:eu.level,"&id=").concat(null==eu?void 0:eu.cache_key),children:"Learn more"})})})]})]})]}),h&&em&&(0,s.jsxs)(V.J2,{open:w,onOpenChange:()=>S(!w),modal:!1,children:[(0,s.jsx)(V.xo,{asChild:!0,children:(0,s.jsx)(Q.z,{type:"warning",icon:(0,s.jsx)(E.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,s.jsxs)(V.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Z,{size:16})," Secure your View"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,s.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Q.z,{type:"default",asChild:!0,children:(0,s.jsx)(_(),{target:"_blank",href:"/project/".concat(a,"/advisors/security?preset=").concat(null==eh?void 0:eh.level,"&id=").concat(null==eh?void 0:eh.cache_key),children:"Learn more"})})})]})]})]}),c&&"public"===n.schema&&(0,s.jsxs)(V.J2,{open:w,onOpenChange:()=>S(!w),modal:!1,children:[(0,s.jsx)(V.xo,{asChild:!0,children:(0,s.jsx)(Q.z,{type:"warning",icon:(0,s.jsx)(E.Z,{strokeWidth:1.5}),children:"Foreign table is accessible via your project's APIs"})}),(0,s.jsxs)(V.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,s.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.Z,{size:16})," Secure Foreign table"]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,s.jsx)("p",{children:"Foreign tables do not enforce RLS. Move them to a private schema not exposed to Postgrest or disable Postgrest."}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(Q.z,{type:"default",asChild:!0,children:(0,s.jsx)(_(),{target:"_blank",href:"https://github.com/orgs/supabase/discussions/21647",children:"Learn more"})})})]})]})]}),(0,s.jsx)(B.Q,{serviceRoleLabel:"postgres"}),l&&x&&(0,s.jsxs)(Q.z,{type:"default",icon:(0,s.jsx)(A.Z,{strokeWidth:1.5,className:er?"text-brand":"text-foreground-muted"}),onClick:()=>b(!0),children:["Realtime ",er?"on":"off"]}),ec&&(0,s.jsx)(F.Z,{section:["entities",n.name]})]}),(0,s.jsx)(K.Z,{visible:y,loading:eo,title:"".concat(er?"Disable":"Enable"," realtime for ").concat(n.name),confirmLabel:"".concat(er?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(er?"Disabling":"Enabling"," realtime"),onCancel:()=>b(!1),onConfirm:()=>ex(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",er?"disabled":"enabled",", the table will"," ",er?"no longer ":"","broadcast any changes to authorized subscribers."]}),!er&&(0,s.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,s.jsx)(_(),{href:"/project/".concat(a,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),l&&(0,s.jsx)(J.Z,{danger:n.rls_enabled,visible:D,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:ef,onSelectConfirm:ep})]})},Y=n(56311),$=n(52065),ee=n(71794),et=e=>{let{id:t}=e;return(0,s.jsx)("div",{className:"flex items-center justify-center h-full","data-sentry-component":"NotFoundState","data-sentry-source-file":"NotFoundState.tsx",children:(0,s.jsx)("div",{className:"w-[400px]",children:(0,s.jsx)($.Z,{icon:(0,s.jsx)(ee.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(t),"data-sentry-element":"InformationBox","data-sentry-source-file":"NotFoundState.tsx"})})})},en=n(47576),es=n(85229),er=n(98809),ea=n(57249),eo=n(65663),ei=n(98261),el=n(28894),ec=n(29020),ed=n(58636),eu=n(30344);let em=e=>{let{id:t}=e;return"\n    ".concat(ed.k,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function eh(e,t){let{projectRef:n,connectionString:s,id:r}=e;if(!r)throw Error("id is required");let a=em({id:r}),{result:o}=await (0,ec.R)({projectRef:n,connectionString:s,sql:a,queryKey:["table-definition",r]},t);return o[0].definition.trim()}let ex=function(e){let{projectRef:t,connectionString:n,id:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,el.a)(eu.A.tableDefinition(t,s),e=>{let{signal:r}=e;return eh({projectRef:t,connectionString:n,id:s},r)},{enabled:r&&void 0!==t&&void 0!==s&&!isNaN(s),...a})},ef=e=>{let{id:t}=e;if(!t)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(t,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function ep(e,t){let{projectRef:n,connectionString:s,id:r}=e,a=ef({id:r}),{result:o}=await (0,ec.R)({projectRef:n,connectionString:s,sql:a,queryKey:["view-definition",r]},t);return o[0].definition.trim()}let eg=function(e){let{projectRef:t,connectionString:n,id:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,el.a)(eu.A.viewDefinition(t,s),e=>{let{signal:r}=e;return ep({projectRef:t,connectionString:n,id:s},r)},{enabled:r&&void 0!==t&&void 0!==s&&!isNaN(s),...a})};var ev=n(47878),ey=e=>{let{entity:t}=e,{ref:n}=(0,m.UO)(),r=(0,L.useRef)(null),a=(0,L.useRef)(null),{resolvedTheme:o}=(0,er.F)(),{project:i}=(0,f.d2)(),l=eg({id:null==t?void 0:t.id,projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString},{enabled:(0,g.D1)(t)}),c=ex({id:null==t?void 0:t.id,projectRef:null==i?void 0:i.ref,connectionString:null==i?void 0:i.connectionString},{enabled:(0,g.N3)(t)}),{data:d,isLoading:u}=(0,g.D1)(t)?l:c,h=(0,g.Du)(t)?"create view ".concat(t.schema,".").concat(t.name," as\n"):(0,g.z_)(t)?"create materialized view ".concat(t.schema,".").concat(t.name," as\n"):"",x=e=>{try{return(0,ea.WU)(e,{language:"postgresql",keywordCase:"lower"})}catch(t){return e}},p=(0,L.useMemo)(()=>d?x(h+d):void 0,[d]),v=async(e,t)=>{r.current=e,a.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,ev.Vs)(500),null==e||e.focus()};return u?(0,s.jsxs)("div",{className:"h-full grid",children:[(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(ei.A,{})}),(0,s.jsx)("div",{className:"mt-auto",children:(0,s.jsx)(eo.Z,{})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,s.jsx)(Q.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10","data-sentry-element":"Button","data-sentry-source-file":"TableDefinition.tsx",children:(0,s.jsx)(_(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=p?p:"")),"data-sentry-element":"Link","data-sentry-source-file":"TableDefinition.tsx",children:"Open in SQL Editor"})}),(0,s.jsx)(es.default,{className:"monaco-editor",theme:(null==o?void 0:o.includes("dark"))?"vs-dark":"vs",onMount:v,defaultLanguage:"pgsql",value:p,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},"data-sentry-element":"Editor","data-sentry-source-file":"TableDefinition.tsx"})]}),(0,s.jsx)(eo.Z,{"data-sentry-element":"Footer","data-sentry-source-file":"TableDefinition.tsx"})]})},ej=e=>{var t,n;let{theme:o="dark",isLoadingSelectedTable:l=!1,selectedTable:C}=e,k=(0,d.useRouter)(),{ref:E,id:A}=(0,m.UO)(),{project:I}=(0,f.d2)(),_=(0,R._2)(),L=(0,D.z6)(),[{view:Z="data"}]=(0,w.x)(),z=(0,j.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"tables"),F=(0,j.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"columns"),T=!z&&!F,M=(0,a.NL)(),{mutate:W}=(0,y.Gz)({async onMutate(e){let{projectRef:t,table:n,configuration:s,payload:r}=e,a=new Set(Object.keys(s.identifiers)),o=v.s.tableRows(t,{table:{id:n.id}});await M.cancelQueries(o);let i=M.getQueriesData(o);return M.setQueriesData(o,e=>{var t;return{rows:null!==(t=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[t]=e;return a.has(t)}).every(e=>{let[t,n]=e;return n===s.identifiers[t]})?{...e,...r}:e))&&void 0!==t?t:[]}}),{previousRowsQueries:i}},onError(e,t,n){let{previousRowsQueries:s}=n;s.forEach(e=>{let[t,n]=e;n&&M.setQueriesData(t,n),M.invalidateQueries(t)}),V(e)}}),U=(0,b.Z)(null!==(t=null==C?void 0:C.columns)&&void 0!==t?t:S.Z6);if(l)return(0,s.jsx)(Y.h,{});if(c()(C))return(0,s.jsx)(et,{id:Number(A)});let P=(0,g.Du)(C)||(0,g.z_)(C),q=(0,g.N3)(C),O=N.s.includes(null!==(n=null==C?void 0:C.schema)&&void 0!==n?n:""),G=q&&!O,Q=(0,x.NK)(C),H="".concat(C.schema,"_").concat(C.name),V=e=>{var t,n;u.Am.error(null!==(n=null!==(t=null==e?void 0:e.details)&&void 0!==t?t:null==e?void 0:e.message)&&void 0!==n?n:e)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.z,{theme:o,gridProps:{height:"100%"},projectRef:E,editable:!T&&G,schema:C.schema,table:Q,headerActions:(0,s.jsx)(X,{table:C,canEditViaTableEditor:G}),onAddColumn:_.onAddColumn,onEditColumn:e=>{let t=i()(U.current,{name:e});t?_.onEditColumn(t):u.Am.error("Unable to find column ".concat(e," in ").concat(null==C?void 0:C.name))},onDeleteColumn:e=>{var t;let n=i()(null!==(t=U.current)&&void 0!==t?t:[],{name:e});n?_.onDeleteColumn(n):u.Am.error("Unable to find column ".concat(e," in ").concat(null==C?void 0:C.name))},onAddRow:_.onAddRow,updateTableRow:(e,t)=>{var n;if(!I)return;let r=null===(n=C.columns)||void 0===n?void 0:n.filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),a={};if((0,g.N3)(C)&&C.primary_keys.forEach(t=>a[t.name]=e[t.name]),0===Object.keys(a).length)return(0,u.Am)("Unable to update row as table has no primary keys",{description:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(p.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});W({projectRef:I.ref,connectionString:I.connectionString,table:C,configuration:{identifiers:a},payload:t,enumArrayColumns:r,impersonatedRole:L()})},onEditRow:_.onEditRow,onImportData:_.onImportData,onError:V,onExpandJSONEditor:(e,t)=>{_.onExpandJSONEditor({column:e,row:t,value:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{_.onExpandTextEditor(e,t)},onEditForeignKeyColumnValue:_.onEditForeignKeyColumnValue,showCustomChildren:(P||q)&&"definition"===Z,customHeader:(P||q)&&"definition"===Z?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("p",{children:["SQL Definition of ",(0,s.jsx)("code",{className:"text-sm",children:C.name})," "]}),(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,"data-sentry-element":"SupabaseGrid","data-sentry-source-file":"TableGridEditor.tsx",children:(P||q)&&(0,s.jsx)(ey,{entity:C})},H),(0,s.jsx)(en.Z,{editable:!T&&G,selectedTable:(0,g.N3)(C)?C:void 0,onTableCreated:e=>{k.push("/project/".concat(E,"/editor/").concat(e.id))},"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"TableGridEditor.tsx"})]})};n(18996)},18429:function(e,t,n){n.d(t,{r:function(){return c}});var s=n(28894),r=n(61250),a=n(51735),o=n(77946),i=n(48930);async function l(e,t,n){let{projectRef:s,connectionString:a,schema:o}=e;if(!s)throw Error("projectRef is required");let i=new Headers(n);a&&i.set("x-connection-encrypted",a);let{data:l,error:c}=await (0,r.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":a},path:{ref:s},query:{included_schemas:o||"",excluded_schemas:""}},headers:i,signal:t});return c&&(0,r.S3)(c),l}let c=function(e){let{projectRef:t,connectionString:n,schema:r}=e,{enabled:c=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,a.Vm)(),m=(null==u?void 0:u.status)===o.S.ACTIVE_HEALTHY;return(0,s.a)(i.R.list(t,r),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n,schema:r},s)},{enabled:c&&void 0!==t&&m,...d})}},27340:function(e,t,n){n.d(t,{Z:function(){return T}});var s=n(97458),r=n(2552),a=n(37669),o=n.n(a),i=n(34549),l=n(4673),c=n(20170),d=n(6222),u=n(36457),m=n(64618),h=n(44767),x=n(29020),f=n(190),p=n(15997),g=n(24158),v=n(24519);async function y(e){let{projectRef:t,connectionString:n,table:s,filters:r,impersonatedRole:a}=e,o=(0,f.Jh)(function(e){var t;let{table:n,filters:s}=e,r=new h.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return s.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,v.q)(n,e);r=r.filter(e.column,e.operator,t)}),r.toSql()}({table:s,filters:r}),{projectRef:t,role:a}),{result:i}=await (0,x.R)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,p.Gm)(a)});return i}let j=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,u.NL)();return(0,m.D)(e=>y(e),{async onSuccess(t,n,r){let{projectRef:a,table:o}=n;await s.invalidateQueries(g.s.tableRowsAndCount(a,o.id)),await (null==e?void 0:e(t,n,r))},async onError(e,n,s){void 0===t?i.Am.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,s)},...n})};var b=n(42772),w=n(26655);async function N(e){let{projectRef:t,connectionString:n,table:s,rows:r,impersonatedRole:a}=e,o=(0,f.Jh)(function(e){var t;let{table:n,rows:s}=e,{primaryKeys:r,error:a}=(0,v.h)({table:n});if(a)throw a;let o=new h.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return null==r||r.forEach(e=>{let t=s.map(t=>t[e]);o=o.filter(e,"in",t)}),o.toSql()}({table:s,rows:r}),{projectRef:t,role:a}),{result:i}=await (0,x.R)({projectRef:t,connectionString:n,sql:o,isRoleImpersonationEnabled:(0,p.Gm)(a)});return i}let S=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,u.NL)();return(0,m.D)(e=>N(e),{async onSuccess(t,n,s){let{projectRef:a,table:o}=n;await r.invalidateQueries(g.s.tableRowsAndCount(a,o.id)),await (null==e?void 0:e(t,n,s))},async onError(e,n,r){if(void 0===t){let{table:t,rows:r}=n,a=e.message.includes("Please add a primary key column"),o=e.message.includes("violates foreign key constraint"),l=r.length>1;if(o){let n=t.name,r=e.message.split("on table ")[2].replaceAll('"',""),a=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),o=l?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(r,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(r,"`."),c="Set an on delete behavior on the foreign key relation `".concat(a,"` in the `").concat(r,"` table to automatically respond when row(s) are being deleted in the `").concat(n,"` table.");(0,i.Am)(o,{description:(0,s.jsx)(b.U,{content:c,className:"[&>p]:m-0"}),action:(0,s.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,s.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else a?(0,i.Am)("Unable to delete row(s) as table has no primary keys",{description:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):i.Am.error("Failed to delete table row: ".concat(e.message))}else t(e,n,r)},...n})};async function D(e){let{projectRef:t,connectionString:n,table:s}=e,r=function(e){var t;let{table:n}=e;return new h.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).truncate().toSql()}({table:s}),{result:a}=await (0,x.R)({projectRef:t,connectionString:n,sql:r});return a}let R=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,u.NL)();return(0,m.D)(e=>D(e),{async onSuccess(t,n,r){let{projectRef:a,table:o}=n;await s.invalidateQueries(g.s.tableRowsAndCount(a,o.id)),await (null==e?void 0:e(t,n,r))},async onError(e,n,s){void 0===t?i.Am.error("Failed to truncate table row: ".concat(e.message)):t(e,n,s)},...n})};var C=n(19959),k=n(68680),E=n(10012),A=n(46327),I=n(7097),_=n(44190),L=n(52862),Z=n(71904),z=n(19168),F=n(587),T=e=>{var t,n,a,u,m,h,x,f,g;let{selectedTable:v,onAfterDeleteTable:y=I.ZT}=e,{project:b}=(0,c.d2)(),w=(0,_._2)(),{selectedSchema:N}=(0,E.B)(),[{filter:D},T]=(0,A.x)({arrayKeys:["filter","sort"]}),M=(0,l.Yb)(D),W=(0,k.AF)({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString}),U=e=>{T(t=>{var n,s;let r=null!==(n=null==t?void 0:t.filter)&&void 0!==n?n:[],a=null!==(s=null==t?void 0:t.sort)&&void 0!==s?s:[];return{...t,filter:r.filter(t=>{let[n]=t.split(":");if(n!==e)return t}),sort:a.filter(t=>{let[n]=t.split(":");if(n!==e)return t})}})},{mutate:P}=(0,d.v)({onSuccess:()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let t=w.confirmationDialog.column;U(t.name),i.Am.success('Successfully deleted column "'.concat(t.name,'"'))},onError:e=>{var t;if((null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)!=="column")return;let n=w.confirmationDialog.column;i.Am.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:q}=(0,C.H)({onSuccess:async()=>{y(await W(N)),i.Am.success('Successfully deleted table "'.concat(null==v?void 0:v.name,'"'))},onError:e=>{i.Am.error("Failed to delete ".concat(null==v?void 0:v.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:O}=S({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),i.Am.success("Successfully deleted selected row(s)")},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:G}=j({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),i.Am.success("Successfully deleted selected rows")},onError:e=>{i.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:Q}=R({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),i.Am.success("Successfully deleted all rows from table")},onError:e=>{i.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),H=(null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)==="row"&&w.confirmationDialog.allRowsSelected,V=(null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)==="row"?w.confirmationDialog.allRowsSelected?null!==(g=w.confirmationDialog.numRows)&&void 0!==g?g:0:w.confirmationDialog.rows.length:0,J=((null===(a=w.confirmationDialog)||void 0===a?void 0:a.type)==="column"||(null===(u=w.confirmationDialog)||void 0===u?void 0:u.type)==="table")&&w.confirmationDialog.isDeleteWithCascade,K=async()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===b)return;let t=w.confirmationDialog.column;void 0!==t&&P({id:t.id,cascade:J,projectRef:b.ref,connectionString:null==b?void 0:b.connectionString,table:v})},B=async()=>{var e;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==v&&q({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString,schema:v.schema,id:v.id,cascade:J})},X=(0,p.z6)(),Y=async()=>{var e;if(!b)return console.error("Project ref is required");if(!v)return console.error("Selected table required");if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let t=w.confirmationDialog.rows;if(w.confirmationDialog.allRowsSelected){if(0===M.length){if(void 0!==X())return w.closeConfirmationDialog(),i.Am.error("Table truncation is not supported when impersonating a role");Q({projectRef:b.ref,connectionString:b.connectionString,table:v})}else G({projectRef:b.ref,connectionString:b.connectionString,table:v,filters:M,impersonatedRole:X()})}else O({projectRef:b.ref,connectionString:b.connectionString,table:v,rows:t,impersonatedRole:X()})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(F.Z,{variant:"destructive",size:"small",visible:(null===(m=w.confirmationDialog)||void 0===m?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null===(h=w.confirmationDialog)||void 0===h?void 0:h.type)==="column"&&w.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:K,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,s.jsx)(L.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:J,onChange:()=>w.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),J&&(0,s.jsxs)(Z.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,s.jsx)(Z.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,s.jsx)(Z.X,{children:(0,s.jsx)(z.z,{asChild:!0,size:"tiny",type:"default",icon:(0,s.jsx)(r.Z,{}),children:(0,s.jsx)(o(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,s.jsx)(F.Z,{variant:"destructive",size:"small",visible:(null===(x=w.confirmationDialog)||void 0===x?void 0:x.type)==="table",title:(0,s.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==v?void 0:v.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:B,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,s.jsx)(L.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:J,onChange:()=>w.toggleConfirmationIsWithCascade(!J),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),J&&(0,s.jsxs)(Z.bZ,{variant:"warning",children:[(0,s.jsx)(Z.Cd,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,s.jsx)(Z.X,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,s.jsx)(Z.X,{className:"mt-4",children:(0,s.jsx)(z.z,{asChild:!0,size:"tiny",type:"default",icon:(0,s.jsx)(r.Z,{}),children:(0,s.jsx)(o(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,s.jsx)(F.Z,{variant:"destructive",size:"small",visible:(null===(f=w.confirmationDialog)||void 0===f?void 0:f.type)==="row",title:(0,s.jsxs)("p",{className:"break-words",children:[(0,s.jsx)("span",{children:"Confirm to delete the selected row"}),(0,s.jsx)("span",{children:V>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>w.closeConfirmationDialog(),onConfirm:()=>Y(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,s.jsx)("span",{children:"Are you sure you want to delete "}),(0,s.jsxs)("span",{children:[H?"all":"the selected"," "]}),(0,s.jsx)("span",{children:V>1&&"".concat(V," ")}),(0,s.jsx)("span",{children:"row"}),(0,s.jsx)("span",{children:V>1&&"s"}),(0,s.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},59863:function(e,t,n){var s=n(97458),r=n(52983),a=n(2054),o=n(93009),i=n(19168);t.Z=e=>{let{visible:t=!1,danger:n=!1,title:l="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:h=()=>{},onSelectConfirm:x=()=>{}}=e;(0,r.useEffect)(()=>{t&&p(!1)},[t]);let[f,p]=(0,r.useState)(!1),g=()=>{p(!0),x()};return(0,s.jsx)(a.Z,{header:l,visible:t,title:l,description:c,size:d,hideFooter:!0,onCancel:h,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,s.jsx)(o.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>g(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(a.Z.Content,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.z,{block:!0,htmlType:"button",type:"default",onClick:h,disabled:f,children:"Cancel"}),(0,s.jsx)(i.z,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:f,loading:f,children:m&&f?m:u||"Confirm"})]})})})})})}},33074:function(e,t,n){n.d(t,{b:function(){return i}});var s=n(97458),r=n(52983),a=n(82445);let o=(0,r.forwardRef)((e,t)=>(0,s.jsx)("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",...e,children:(0,s.jsx)("path",{d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",fillRule:"evenodd",clipRule:"evenodd"})})),i=(0,r.forwardRef)((e,t)=>{let{...n}=e;return(0,s.jsxs)(a.u,{children:[(0,s.jsx)(a.aJ,{type:"button",role:"button",className:"flex [&_svg]:data-[state=delayed-open]:fill-foreground-lighter [&_svg]:data-[state=instant-open]:fill-foreground-lighter",children:(0,s.jsx)(o,{strokeWidth:2,className:"transition-colors fill-foreground-muted w-4 h-4"})}),(0,s.jsx)(a._v,{...n})]})})}}]);