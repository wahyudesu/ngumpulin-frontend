!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="90fa33c2-5f69-4da4-955c-47e8d9ec3175",e._sentryDebugIdIdentifier="sentry-dbid-90fa33c2-5f69-4da4-955c-47e8d9ec3175")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1553],{23220:function(e,t,n){n.d(t,{FL:function(){return r},Ht:function(){return s},Xq:function(){return a}});let s=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_surgery","pg_visibility","supabase_vault","supautils","intagg","xml2","pg_tle"],a={vector:["pgvector","pg_vector"]},r={pg_cron:"Disabling this extension will delete all scheduled jobs. This cannot be undone."}},68823:function(e,t,n){n.d(t,{QI:function(){return l},cK:function(){return r}});var s=n(29787),a=n.n(s);function r(e){let t=null==e?void 0:e.split(",").map(e=>e.trim());return a()(e)||!t||0===t.length?{value:[]}:{value:t.map(e=>{let t=e.match(/(\w+)\s+([\w\[\]]+)(?:\s+DEFAULT\s+(.*))?/i);if(!t)return console.error("Error while trying to parse function arguments",e),null;{let[,e,n,s]=t,a=s?s.trim():void 0;return["timestamp","time","timetz","timestamptz"].includes(n.toLowerCase())&&a&&(a="'".concat(a,"'")),{name:e,type:n,defaultValue:a}}}).filter(Boolean)}}function l(e){let t=[];if(e)for(var n in e)t.push({name:n,value:e[n]});return{value:t}}},89491:function(e,t,n){n.d(t,{M4:function(){return tb},TH:function(){return R},B8:function(){return nL},RA:function(){return nn},ZR:function(){return nV},eX:function(){return nf},Ms:function(){return se},IP:function(){return e9},Vj:function(){return tn},_y:function(){return tr},yT:function(){return eK},bw:function(){return ed}});var s=n(97458),a=n(13948),r=n(198),l=n(71607),i=n.n(l),o=n(92494),c=n(78854),d=n(81449),u=n(15628),m=n(18656),x=n(17471),h=n(37669),f=n.n(h),p=n(52983),j=n(45925),g=n(20170),y=n(2207),v=n(99658),b=n(61223),N=n(97881),w=n(98261),S=n(59650),C=n(69171),Z=n(87790),k=n(43428),E=n(19168),_=n(96789),T=n(77518),F=n(63635),R=e=>{var t,n,l,h,R;let{onAddColumn:z=i(),onEditColumn:P=i(),onDeleteColumn:I=i()}=e,{id:A,ref:L}=(0,j.UO)(),D=A?Number(A):void 0,{project:B}=(0,g.d2)(),{data:W,error:O,isError:q,isLoading:M,isSuccess:V}=(0,S.iB)({projectRef:null==B?void 0:B.ref,connectionString:null==B?void 0:B.connectionString,id:D}),[Y,H]=(0,p.useState)(""),U=(0,C.N3)(W),X=null!==(l=0===Y.length?null!==(n=null==W?void 0:W.columns)&&void 0!==n?n:[]:null==W?void 0:null===(t=W.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(Y)))&&void 0!==l?l:[],Q=k.s.includes(null!==(h=null==W?void 0:W.schema)&&void 0!==h?h:""),G=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,s.jsxs)("div",{className:"space-y-4","data-sentry-component":"ColumnList","data-sentry-source-file":"ColumnList.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(E.z,{asChild:!0,type:"outline",icon:(0,s.jsx)(o.Z,{}),style:{padding:"5px"},"data-sentry-element":"Button","data-sentry-source-file":"ColumnList.tsx",children:(0,s.jsx)(f(),{href:"/project/".concat(L,"/database/tables"),"data-sentry-element":"Link","data-sentry-source-file":"ColumnList.tsx"})}),(0,s.jsx)(_.Z,{size:"small",placeholder:"Filter columns",value:Y,onChange:e=>H(e.target.value),icon:(0,s.jsx)(c.Z,{size:12}),"data-sentry-element":"Input","data-sentry-source-file":"ColumnList.tsx"})]}),!Q&&U&&(0,s.jsx)(N.u,{icon:(0,s.jsx)(d.Z,{}),disabled:!G,onClick:()=>z(),tooltip:{content:{side:"bottom",text:G?void 0:"You need additional permissions to create columns"}},children:"New column"})]}),Q&&(0,s.jsx)(F.Z,{schema:null!==(R=null==W?void 0:W.schema)&&void 0!==R?R:"",entity:"columns"}),M&&(0,s.jsx)(w.A,{}),q&&(0,s.jsx)(b.Z,{error:O,subject:'Failed to retrieve columns for table "'.concat(null==W?void 0:W.schema,".").concat(null==W?void 0:W.name,'"')}),V&&(0,s.jsx)(s.Fragment,{children:0===X.length?(0,s.jsx)(y.Z,{}):(0,s.jsx)("div",{children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,s.jsx)(v.Z.th,{children:"Data Type"},"type"),(0,s.jsx)(v.Z.th,{children:"Format"},"format"),(0,s.jsx)(v.Z.th,{},"buttons")],body:X.map((e,t)=>(0,s.jsxs)(v.Z.tr,{className:"border-t",children:[(0,s.jsx)(v.Z.td,{children:(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(v.Z.td,{className:"break-all whitespace-normal hidden xl:table-cell",children:null!==e.comment?(0,s.jsx)("p",{title:e.comment,children:e.comment}):(0,s.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,s.jsx)(v.Z.td,{children:(0,s.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,s.jsx)(v.Z.td,{className:"font-mono text-xs",children:(0,s.jsx)("code",{className:"text-xs",children:e.format})}),(0,s.jsx)(v.Z.td,{className:"text-right",children:!Q&&U&&(0,s.jsxs)(T.h_,{children:[(0,s.jsx)(T.$F,{asChild:!0,children:(0,s.jsx)(E.z,{type:"default",className:"px-1",icon:(0,s.jsx)(u.Z,{})})}),(0,s.jsxs)(T.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,s.jsx)(T.Xi,{disabled:!G,onClick:()=>P(e),children:(0,s.jsxs)(a.fC,{delayDuration:0,children:[(0,s.jsxs)(a.xz,{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.Z,{size:12}),(0,s.jsx)("p",{children:"Edit column"})]}),!G&&(0,s.jsx)(a.h_,{children:(0,s.jsxs)(a.VY,{side:"bottom",children:[(0,s.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,s.jsx)(T.Xi,{disabled:!G||Q,onClick:()=>I(e),children:(0,s.jsxs)(a.fC,{delayDuration:0,children:[(0,s.jsxs)(a.xz,{className:"flex items-center space-x-2",children:[(0,s.jsx)(x.Z,{stroke:"red",size:12}),(0,s.jsx)("p",{children:"Delete column"})]}),!G&&(0,s.jsx)(a.h_,{children:(0,s.jsxs)(a.VY,{side:"bottom",children:[(0,s.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name))})})})]})},z=n(6303),P=n(77733),I=n(35986),A=n(45196),L=n(14415),D=n(84380),B=n(72871),W=n(53995),O=n(26781),q=n(4621),M=n(7514),V=n(28894),Y=n(61250),H=n(9390);async function U(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,Y.U2)("/platform/pg-meta/{ref}/foreign-tables",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||"",include_columns:!0}},headers:r,signal:t});return i&&(0,Y.S3)(i),l}let X=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.a)(s?H.T.listBySchema(t,s):H.T.list(t),e=>{let{signal:a}=e;return U({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,...r})},Q={list:e=>["projects",e,"materializedViews"],listBySchema:(e,t)=>[...Q.list(e),t]};async function G(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,Y.U2)("/platform/pg-meta/{ref}/materialized-views",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||"",include_columns:!0}},headers:r,signal:t});return i&&(0,Y.S3)(i),l}let J=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.a)(s?Q.listBySchema(t,s):Q.list(t),e=>{let{signal:a}=e;return G({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,staleTime:0,...r})};var K=n(28763),$=n(68680),ee=n(2325);async function et(e,t){let{projectRef:n,connectionString:s,schema:a}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,Y.U2)("/platform/pg-meta/{ref}/views",{params:{header:{"x-connection-encrypted":s},path:{ref:n},query:{included_schemas:a||""}},headers:r,signal:t});return i&&(0,Y.S3)(i),l}let en=function(e){let{projectRef:t,connectionString:n,schema:s}=e,{enabled:a=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.a)(s?ee.N.listBySchema(t,s):ee.N.list(t),e=>{let{signal:a}=e;return et({projectRef:t,connectionString:n,schema:s},a)},{enabled:a&&void 0!==t,staleTime:0,...r})};var es=n(10012),ea=n(41341),er=n(65497),el=n(27037),ei=n(82445),eo=n(5546);let ec=e=>{let{tables:t=[],views:n=[],materializedViews:s=[],foreignTables:a=[]}=e,r=t.map(e=>{var t;return{...e,type:M.l.TABLE,rows:e.live_rows_estimate,columns:null!==(t=e.columns)&&void 0!==t?t:[]}});return[...r,...n.map(e=>{var t;return{type:M.l.VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...s.map(e=>{var t;return{type:M.l.MATERIALIZED_VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...a.map(e=>{var t;return{type:M.l.FOREIGN_TABLE,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}})].sort((e,t)=>e.name.localeCompare(t.name))};var ed=e=>{let{onDuplicateTable:t,onAddTable:n=i(),onEditTable:l=i(),onDeleteTable:o=i()}=e,h=(0,W.useRouter)(),{ref:y}=(0,j.UO)(),{project:S}=(0,g.d2)(),C=(0,K.yF)(),{selectedSchema:R,setSelectedSchema:V}=(0,es.B)(),[Y,H]=(0,p.useState)(""),[U,Q]=(0,p.useState)(Object.values(M.l)),G=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:ee,error:et,isError:ed,isLoading:eu,isSuccess:em}=(0,$.Bj)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:R,sortByProperty:"name",includeColumns:!0},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:ex,error:eh,isError:ef,isLoading:ep,isSuccess:ej}=en({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:R},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:eg,error:ey,isError:ev,isLoading:eb,isSuccess:eN}=J({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:R},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:ew,error:eS,isError:eC,isLoading:eZ,isSuccess:ek}=X({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString,schema:R},{select:e=>0===Y.length?e:e.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase()))}),{data:eE}=(0,q.z)({projectRef:null==S?void 0:S.ref,connectionString:null==S?void 0:S.connectionString}),e_=(null!=eE?eE:[]).find(e=>"supabase_realtime"===e.name),eT=ec({tables:ee,views:ex,materializedViews:eg,foreignTables:ew}).filter(e=>U.includes(e.type)),eF=k.s.includes(R),eR=e=>{var t,n,s,a;return null===(a=Object.entries(M.l).find(t=>{let[,n]=t;return n===e}))||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:null===(n=s.toLowerCase())||void 0===n?void 0:null===(t=n.split("_"))||void 0===t?void 0:t.join(" ")};return(0,s.jsxs)("div",{className:"flex flex-col gap-y-4","data-sentry-component":"TableList","data-sentry-source-file":"TableList.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2 flex-wrap",children:[(0,s.jsx)(O.Z,{className:"w-[180px]",size:"tiny",showError:!1,selectedSchemaName:R,onSelectSchema:V,"data-sentry-element":"SchemaSelector","data-sentry-source-file":"TableList.tsx"}),(0,s.jsxs)(ea.J2,{"data-sentry-element":"Popover_Shadcn_","data-sentry-source-file":"TableList.tsx",children:[(0,s.jsx)(ea.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TableList.tsx",children:(0,s.jsx)(E.z,{size:"tiny",type:5!==U.length?"default":"dashed",className:"px-1",icon:(0,s.jsx)(z.Z,{}),"data-sentry-element":"Button","data-sentry-source-file":"TableList.tsx"})}),(0,s.jsx)(ea.yk,{className:"p-0 w-56",side:"bottom",align:"center","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TableList.tsx",children:(0,s.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,s.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,s.jsx)("div",{className:"flex flex-col",children:Object.entries(M.l).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(er.X,{id:t,name:t,checked:U.includes(n),onCheckedChange:()=>{U.includes(n)?Q(U.filter(e=>e!==n)):Q(U.concat([n]))}}),(0,s.jsx)(el._,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,s.jsx)(E.z,{size:"tiny",type:"default",onClick:()=>Q([n]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]}),(0,s.jsx)(_.Z,{size:"tiny",className:"w-52",placeholder:"Search for a table",value:Y,onChange:e=>H(e.target.value),icon:(0,s.jsx)(c.Z,{size:12}),"data-sentry-element":"Input","data-sentry-source-file":"TableList.tsx"}),!eF&&(0,s.jsx)(N.u,{className:"ml-auto",icon:(0,s.jsx)(d.Z,{}),disabled:!G,onClick:()=>n(),tooltip:{content:{side:"bottom",text:G?void 0:"You need additional permissions to create tables"}},children:"New table"})]}),eF&&(0,s.jsx)(F.Z,{schema:R,entity:"tables"}),(eu||ep||eb||eZ)&&(0,s.jsx)(w.A,{}),(ed||ef||ev||eC)&&(0,s.jsx)(b.Z,{error:et||eh||ey||eS,subject:"Failed to retrieve tables"}),em&&ej&&eN&&ek&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{className:"!px-0"},"icon"),(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,s.jsx)(v.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,s.jsx)(v.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,s.jsx)(v.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,s.jsx)(v.Z.th,{},"buttons")],body:(0,s.jsxs)(s.Fragment,{children:[0===eT.length&&0===Y.length&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsx)(v.Z.td,{colSpan:7,children:0===U.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Please select at least one entity type to filter with"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are currently no results based on the filter that you have applied"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["There are no"," ",5===U.length?"tables":1===U.length?"".concat(eR(U[0]),"s"):"".concat(U.slice(0,-1).map(e=>"".concat(eR(e),"s")).join(", "),", and ").concat(eR(U[U.length-1]),"s")," ",'found in the schema "',R,'"']})]})})},R),0===eT.length&&Y.length>0&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:7,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',Y,'" did not return any results']})]})},R),eT.length>0&&eT.map(e=>{var n,r,i,c;return(0,s.jsxs)(v.Z.tr,{children:[(0,s.jsx)(v.Z.td,{className:"!pl-5 !pr-1",children:(0,s.jsxs)(ei.u,{children:[(0,s.jsx)(ei.aJ,{asChild:!0,children:e.type===M.l.TABLE?(0,s.jsx)(P.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):e.type===M.l.VIEW?(0,s.jsx)(I.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):(0,s.jsx)("div",{className:(0,eo.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",e.type===M.l.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",e.type===M.l.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500"),children:null===(i=Object.entries(M.l).find(t=>{let[,n]=t;return n===e.type}))||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:n.toUpperCase()})}),(0,s.jsx)(ei._v,{side:"bottom",className:"capitalize",children:eR(e.type)})]})}),(0,s.jsx)(v.Z.td,{children:e.name.length>20?(0,s.jsxs)(a.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,s.jsx)(a.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(a.h_,{children:(0,s.jsxs)(a.VY,{side:"bottom",children:[(0,s.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,s.jsx)("p",{children:e.name})}),(0,s.jsx)(v.Z.td,{className:"hidden lg:table-cell ",children:null!==e.comment?(0,s.jsx)("span",{className:"lg:max-w-48 truncate inline-block",title:e.comment,children:e.comment}):(0,s.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,s.jsx)(v.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.rows?e.rows.toLocaleString():"-"}),(0,s.jsx)(v.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.size?(0,s.jsx)("code",{className:"text-xs",children:e.size}):"-"}),(0,s.jsx)(v.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(c=null==e_?void 0:e_.tables)&&void 0!==c?c:[]).find(t=>t.id===e.id)?(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(A.Z,{size:18,strokeWidth:2,className:"text-brand"})}):(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(L.Z,{size:18,strokeWidth:2,className:"text-foreground-lighter"})})}),(0,s.jsx)(v.Z.td,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(E.z,{asChild:!0,type:"default",iconRight:(0,s.jsx)(D.Z,{size:14,className:"text-foreground-light"}),className:"whitespace-nowrap hover:border-muted",style:{paddingTop:3,paddingBottom:3},children:(0,s.jsxs)(f(),{href:"/project/".concat(y,"/database/tables/").concat(e.id),children:[e.columns.length," columns"]})}),!eF&&(0,s.jsxs)(T.h_,{children:[(0,s.jsx)(T.$F,{asChild:!0,children:(0,s.jsx)(E.z,{type:"default",className:"px-1",icon:(0,s.jsx)(u.Z,{})})}),(0,s.jsxs)(T.AW,{side:"bottom",align:"end",className:"w-40",children:[(0,s.jsxs)(T.Xi,{className:"flex items-center space-x-2",onClick:()=>h.push("/project/".concat(null==S?void 0:S.ref,"/editor/").concat(e.id)),onMouseEnter:()=>C({id:e.id?String(e.id):void 0}),children:[(0,s.jsx)(I.Z,{size:12}),(0,s.jsx)("p",{children:"View in Table Editor"})]}),e.type===M.l.TABLE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.VD,{}),(0,s.jsxs)(ei.u,{children:[(0,s.jsx)(ei.aJ,{asChild:!0,children:(0,s.jsxs)(T.Xi,{className:"!pointer-events-auto gap-x-2",disabled:!G,onClick:()=>{G&&l(e)},children:[(0,s.jsx)(m.Z,{size:12}),(0,s.jsx)("p",{children:"Edit table"})]})}),!G&&(0,s.jsx)(ei._v,{side:"left",children:"You need additional permissions to edit this table"})]}),(0,s.jsxs)(T.Xi,{className:"space-x-2",onClick:n=>{n.stopPropagation(),G&&t(e)},children:[(0,s.jsx)(B.Z,{size:12}),(0,s.jsx)("span",{children:"Duplicate Table"})]},"duplicate-table"),(0,s.jsxs)(ei.u,{children:[(0,s.jsx)(ei.aJ,{asChild:!0,children:(0,s.jsxs)(T.Xi,{disabled:!G||eF,className:"!pointer-events-auto gap-x-2",onClick:()=>{G&&!eF&&o({...e,schema:R})},children:[(0,s.jsx)(x.Z,{stroke:"red",size:12}),(0,s.jsx)("p",{children:"Delete table"})]})}),!G&&(0,s.jsx)(ei._v,{side:"left",children:"You need additional permissions to delete tables"})]})]})]})]})]})})]},e.id)})]})})})]})},eu=n(50663),em=n.n(eu),ex=n(71635),eh=n.n(ex),ef=n(21371),ep=n(59262),ej=n(30863),eg=n(94485),ey=n(28436),ev=n(78751),eb=n(86848),eN=n(34549),ew=n(5394),eS=n(50060),eC=n(95199),eZ=n(36457),ek=n(64618),eE=n(29020);async function e_(e){let{projectRef:t,connectionString:n,payload:s}=e,a=eC.Z.roles.create(s).sql,{result:r}=await (0,eE.R)({projectRef:t,connectionString:n,sql:a,queryKey:["roles","create"]});return r}let eT=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>e_(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ej.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to create database role: ".concat(e.message)):t(e,n,s)},...n})};var eF=n(86977),eR=n(40241),ez=n(40347),eP=n(16787),eI=n(13638);let eA=ew.ZP.object({name:ew.ZP.string().trim().min(1,"You must provide a name").default(""),isSuperuser:ew.ZP.boolean().default(!1),canLogin:ew.ZP.boolean().default(!1),canCreateRole:ew.ZP.boolean().default(!1),canCreateDb:ew.ZP.boolean().default(!1),isReplicationRole:ew.ZP.boolean().default(!1),canBypassRls:ew.ZP.boolean().default(!1)}),eL={name:"",isSuperuser:!1,canLogin:!1,canCreateRole:!1,canCreateDb:!1,isReplicationRole:!1,canBypassRls:!1};var eD=e=>{let{visible:t,onClose:n}=e,a="create-new-role",{project:r}=(0,g.d2)(),l=(0,eb.cI)({resolver:(0,ev.F)(eA)}),{mutate:i,isLoading:o}=eT({onSuccess:(e,t)=>{eN.Am.success("Successfully created new role: ".concat(t.payload.name)),d()}}),c=async e=>{if(!r)return console.error("Project is required");i({projectRef:r.ref,connectionString:r.connectionString,payload:e})},d=()=>{n(),l.reset(eL)};return(0,s.jsx)(eF.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:d,customFooter:(0,s.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,s.jsx)(eS.i,{form:a,isSubmitting:o,hasChanges:l.formState.isDirty,handleReset:d})}),"data-sentry-element":"SidePanel","data-sentry-component":"CreateRolePanel","data-sentry-source-file":"CreateRolePanel.tsx",children:(0,s.jsx)(eR.l0,{...l,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateRolePanel.tsx",children:(0,s.jsxs)("form",{id:a,className:"grid gap-6 w-full px-8 py-8",onSubmit:l.handleSubmit(c),children:[(0,s.jsx)(eR.Wi,{control:l.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(eR.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,s.jsx)(eR.NI,{className:"col-span-8",children:(0,s.jsx)(ez.I,{...t,className:"w-full"})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateRolePanel.tsx"}),(0,s.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsx)(eR.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light","data-sentry-element":"FormLabel_Shadcn_","data-sentry-source-file":"CreateRolePanel.tsx",children:"Role privileges"})}),(0,s.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(eI.IC).filter(e=>eI.IC[e].grant_by_dashboard).map(e=>{let t=eI.IC[e];return(0,s.jsx)(eR.Wi,{control:l.control,name:e,render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,s.jsx)(eR.NI,{className:"col-span-8 flex items-center gap-4",children:(0,s.jsxs)("div",{className:"w-full text-sm",children:[(0,s.jsx)(eP.r,{checked:n.value,onCheckedChange:n.onChange}),(0,s.jsx)(eR.lX,{children:t.description})]})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,s.jsx)(eF.ZP.Separator,{"data-sentry-element":"unknown","data-sentry-source-file":"CreateRolePanel.tsx"}),(0,s.jsxs)("div",{className:"grid gap-4",children:[(0,s.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(eI.IC).filter(e=>!eI.IC[e].grant_by_dashboard).map(e=>{let t=eI.IC[e];return(0,s.jsx)(eR.Wi,{control:l.control,name:e,render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"space-y-0 opacity-70",children:[(0,s.jsx)(eR.NI,{className:"flex items-center gap-4",children:(0,s.jsxs)("div",{className:"w-full text-sm",children:[(0,s.jsx)(eP.r,{checked:n.value,onCheckedChange:n.onChange,disabled:!0,"aria-readonly":!0}),(0,s.jsx)(eR.lX,{children:t.description})]})}),(0,s.jsx)(eR.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},eB=n(2054);async function eW(e){let{projectRef:t,connectionString:n,id:s,payload:a}=e,r=eC.Z.roles.remove({id:s},a).sql,{result:l}=await (0,eE.R)({projectRef:t,connectionString:n,sql:r,queryKey:["roles","delete"]});return l}let eO=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>eW(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ej.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to delete database role: ".concat(e.message)):t(e,n,s)},...n})};var eq=e=>{let{role:t,visible:n,onClose:a}=e,{project:r}=(0,g.d2)(),{mutate:l,isLoading:i}=eO({onSuccess:()=>{eN.Am.success("Successfully deleted role: ".concat(t.name)),a()}}),o=async()=>r?t?void l({projectRef:r.ref,connectionString:r.connectionString,id:t.id}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,s.jsx)(eB.Z,{size:"small",alignFooter:"right",visible:n,onCancel:a,onConfirm:o,header:(0,s.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:i,"data-sentry-element":"Modal","data-sentry-component":"DeleteRoleModal","data-sentry-source-file":"DeleteRoleModal.tsx",children:(0,s.jsx)(eB.Z.Content,{"data-sentry-element":"unknown","data-sentry-source-file":"DeleteRoleModal.tsx",children:(0,s.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})},eM=n(93009),eV=n(48653),eY=n(25084);async function eH(e){let{projectRef:t,connectionString:n,id:s,payload:a}=e,r=eC.Z.roles.update({id:s},a).sql,{result:l}=await (0,eE.R)({projectRef:t,connectionString:n,sql:r,queryKey:["roles","update"]});return l}let eU=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>eH(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await (0,ej.fA)(s,r),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to update database role: ".concat(e.message)):t(e,n,s)},...n})};var eX=n(85407),eQ=n(39677),eG=e=>{let{role:t,disabled:n=!1,onSelectDelete:r}=e,{project:l}=(0,g.d2)(),[i,o]=(0,p.useState)(!1),{mutate:c,isLoading:d}=eU(),{isSuperuser:m,canLogin:h,canCreateRole:f,canCreateDb:j,isReplicationRole:y,canBypassRls:v}=t,b=async(e,n)=>{let{resetForm:s}=n;if(!l)return console.error("Project is required");let a=Object.fromEntries(Object.entries(e).filter(e=>{let[n,s]=e;return s!==t[n]}));c({projectRef:l.ref,connectionString:l.connectionString,id:t.id,payload:a},{onSuccess:()=>{eN.Am.success('Successfully updated role "'.concat(t.name,'"')),s({values:{...e},initialValues:{...e}})}})};return(0,s.jsx)(eM.Z,{name:"role-update-form",initialValues:{isSuperuser:m,canLogin:h,canCreateRole:f,canCreateDb:j,isReplicationRole:y,canBypassRls:v},onSubmit:b,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br","data-sentry-element":"Form","data-sentry-component":"RoleRow","data-sentry-source-file":"RoleRow.tsx",children:e=>{let{values:l,initialValues:c,handleReset:m}=e,h=JSON.stringify(l)!==JSON.stringify(c);return(0,s.jsxs)(eV.ZP,{open:i,children:[(0,s.jsx)(eV.ZP.Trigger,{asChild:!0,children:(0,s.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&o(!i)},children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(eX.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,s.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,s.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,s.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[t.activeConnections>0&&(0,s.jsx)("div",{className:"relative h-2 w-2",children:(0,s.jsxs)("span",{className:"flex h-2 w-2",children:[(0,s.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,s.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,s.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.activeConnections>0?"text-foreground":"text-foreground-light"),children:[t.activeConnections," connections"]}),!n&&(0,s.jsxs)(T.h_,{children:[(0,s.jsx)(T.$F,{asChild:!0,children:(0,s.jsx)(E.z,{type:"default",className:"px-1",children:(0,s.jsx)(u.Z,{})})}),(0,s.jsx)(T.AW,{side:"bottom",className:"w-[120px]",children:(0,s.jsxs)(T.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),r(t)},children:[(0,s.jsx)(x.Z,{className:"text-red-800",size:"14",strokeWidth:2}),(0,s.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,s.jsx)(eV.ZP.Content,{children:(0,s.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,s.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(eI.IC).map(e=>(0,s.jsx)(eY.Z,{size:"small",id:e,name:e,label:eI.IC[e].description,disabled:n||eI.IC[e].disabled,className:["roles-toggle",n||eI.IC[e].disabled?"opacity-50":""].join(" "),afterLabel:!n&&eI.IC[e].disabled?(0,s.jsxs)(a.fC,{delayDuration:0,children:[(0,s.jsx)(a.xz,{type:"button",children:(0,s.jsx)(eQ.Z,{size:"14",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,s.jsx)(a.h_,{children:(0,s.jsxs)(a.VY,{align:"center",side:"bottom",children:[(0,s.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,s.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]}):(0,s.jsx)(s.Fragment,{})},e))}),!n&&(0,s.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,s.jsx)(E.z,{type:"default",disabled:!h||d,onClick:()=>m(),children:"Cancel"}),(0,s.jsx)(E.z,{type:"primary",htmlType:"submit",disabled:!h||d,loading:d,children:"Save"})]})]})})]})}})},eJ=e=>{let{index:t}=e;return(0,s.jsx)("div",{className:(0,eo.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),"data-sentry-component":"RoleRowSkeleton","data-sentry-source-file":"RoleRowSkeleton.tsx",children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(eX.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14,"data-sentry-element":"ChevronUp","data-sentry-source-file":"RoleRowSkeleton.tsx"}),(0,s.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,s.jsx)(w.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"RoleRowSkeleton.tsx"}),(0,s.jsx)(w.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"RoleRowSkeleton.tsx"})]})]}),(0,s.jsx)(w.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"RoleRowSkeleton.tsx"})]})})},eK=()=>{let{project:e}=(0,g.d2)(),[t,n]=(0,p.useState)(""),[l,i]=(0,p.useState)("all"),[o,u]=(0,p.useState)(!1),[m,x]=(0,p.useState)(),h=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:f}=(0,eg.E3)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),j=null==f?void 0:f.maxConnections,{data:y,isLoading:v}=(0,ej.x4)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),b=eh()(null!=y?y:[],e=>e.name.toLocaleLowerCase()),w=("active"===l?b.filter(e=>e.activeConnections>0):b).filter(e=>e.name.includes(t)),[S,C]=em()(w,e=>eI.NM.includes(e.name)),k=b.map(e=>e.activeConnections).reduce((e,t)=>e+t,0),T=eh()(b.filter(e=>e.activeConnections>0),e=>-e.activeConnections);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(_.Z,{size:"tiny",className:"w-52",placeholder:"Search for a role",icon:(0,s.jsx)(c.Z,{size:12}),value:t,onChange:e=>n(e.target.value),actions:t&&(0,s.jsx)(E.z,{size:"tiny",type:"text",onClick:()=>n(""),className:"px-1 mr-1",children:(0,s.jsx)(L.Z,{size:12,strokeWidth:2})}),"data-sentry-element":"Input","data-sentry-source-file":"RolesList.tsx"}),(0,s.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[26px]",children:[(0,s.jsx)("button",{className:["text-xs w-[80px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("all"),children:"All roles"}),(0,s.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,s.jsx)("button",{className:["text-xs w-[80px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("active"),children:"Active roles"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,s.jsxs)(a.fC,{delayDuration:0,"data-sentry-element":"unknown","data-sentry-source-file":"RolesList.tsx",children:[(0,s.jsx)(a.xz,{"data-sentry-element":"unknown","data-sentry-source-file":"RolesList.tsx",children:(0,s.jsx)("div",{className:"w-42",children:(0,s.jsx)(ep.Z,{type:"horizontal",max:j||k,value:k,barClass:0===j||void 0===j?"bg-foreground":k>.9*j?"bg-destructive":k>.75*j?"bg-warning":void 0,labelTop:Number.isInteger(j)?"".concat(k,"/").concat(j):"".concat(k),labelTopClass:"text-xs",labelBottom:"Active connections",labelBottomClass:"text-xs","data-sentry-element":"SparkBar","data-sentry-source-file":"RolesList.tsx"})})}),(0,s.jsxs)(a.VY,{align:"start",side:"bottom","data-sentry-element":"unknown","data-sentry-source-file":"RolesList.tsx",children:[(0,s.jsx)(a.Eh,{className:"radix-tooltip-arrow","data-sentry-element":"unknown","data-sentry-source-file":"RolesList.tsx"}),(0,s.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,s.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),T.map(e=>(0,s.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.activeConnections]},e.id))]})]})]}),(0,s.jsx)(N.u,{type:"primary",disabled:!h,icon:(0,s.jsx)(d.Z,{size:12}),onClick:()=>u(!0),tooltip:{content:{side:"bottom",text:h?void 0:"You need additional permissions to add a new role"}},"data-sentry-element":"ButtonTooltip","data-sentry-source-file":"RolesList.tsx",children:"Add role"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,s.jsx)(ey.C,{variant:"brand","data-sentry-element":"Badge","data-sentry-source-file":"RolesList.tsx",children:"Protected"})]}),v?Array.from({length:5}).map((e,t)=>(0,s.jsx)(eJ,{index:t},t)):S.map(e=>(0,s.jsx)(eG,{disabled:!0,role:e,onSelectDelete:x},e.id))]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),v?Array.from({length:3}).map((e,t)=>(0,s.jsx)(eJ,{index:t},t)):C.map(e=>(0,s.jsx)(eG,{disabled:!h,role:e,onSelectDelete:x},e.id))]})]}),t.length>0&&0===w.length&&(0,s.jsx)(ef.Z,{searchString:t,onResetFilter:()=>n("")}),(0,s.jsx)(eD,{visible:o,onClose:()=>u(!1),"data-sentry-element":"CreateRolePanel","data-sentry-source-file":"RolesList.tsx"}),(0,s.jsx)(eq,{role:m,visible:void 0!==m,onClose:()=>x(void 0),"data-sentry-element":"DeleteRoleModal","data-sentry-source-file":"RolesList.tsx"})]})},e$=n(7534),e0=n.n(e$),e1=n(71794),e2=n(26655),e4=n(52065),e5=n(71292),e3=n(44165),e8=e=>{let{index:t=0}=e;return(0,s.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm","data-sentry-component":"ExtensionCardSkeleton","data-sentry-source-file":"ExtensionCardSkeleton.tsx",children:[(0,s.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,s.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,s.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,s.jsx)(w.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"ExtensionCardSkeleton.tsx"})})}),(0,s.jsx)(eY.Z,{size:"tiny",checked:!1,disabled:!0,"data-sentry-element":"Toggle","data-sentry-source-file":"ExtensionCardSkeleton.tsx"})]}),(0,s.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,s.jsx)("div",{className:"py-3 px-4",children:(0,s.jsx)(w.Z,{className:"h-4 w-48",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"ExtensionCardSkeleton.tsx"})})})]})},e6=n(23220),e9=()=>{let{filter:e}=(0,j.UO)(),{project:t}=(0,g.d2)(),[n,a]=(0,p.useState)(""),{data:l,isLoading:i}=(0,e5.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),o=0===n.length?null!=l?l:[]:(null!=l?l:[]).filter(e=>{let t=e.name.toLowerCase().includes(n.toLowerCase()),s=(e6.Xq[e.name]||[]).some(e=>e.includes(n.toLowerCase()));return t||s}),d=o.filter(e=>!e6.Ht.includes(e.name)),[u,m]=em()(d,e=>!e0()(e.installed_version)),x=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),h=(0,Z.N4)();return(0,p.useEffect)(()=>{void 0!==e&&a(e)},[e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(_.Z,{size:"tiny",placeholder:"Search for an extension",value:n,onChange:e=>a(e.target.value),className:"w-52",icon:(0,s.jsx)(c.Z,{size:14}),"data-sentry-element":"Input","data-sentry-source-file":"Extensions.tsx"}),(0,s.jsx)(e2.G,{href:"https://supabase.com/docs/guides/database/extensions","data-sentry-element":"DocsButton","data-sentry-source-file":"Extensions.tsx"})]})}),h&&!x&&(0,s.jsx)(e4.Z,{icon:(0,s.jsx)(e1.Z,{className:"text-foreground-light",size:18,strokeWidth:2}),title:"You need additional permissions to update database extensions"}),i?(0,s.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(w.Z,{className:"h-[28px] w-40"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,s.jsx)(e8,{index:t},t))})]})}):(0,s.jsxs)(s.Fragment,{children:[0===o.length&&(0,s.jsx)(ef.Z,{searchString:n,onResetFilter:()=>a("")}),(0,s.jsxs)("div",{className:"my-8 w-full space-y-12",children:[u.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:u.map(e=>(0,s.jsx)(e3.Z,{extension:e},e.name))})]}),m.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,s.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:m.map(e=>(0,s.jsx)(e3.Z,{extension:e},e.name))})]})]})]})]})},e7=n(587),te=n(33645),tt=e=>{let{index:t}=e;return(0,s.jsxs)(v.Z.tr,{className:"border-t","data-sentry-element":"unknown","data-sentry-component":"PublicationSkeleton","data-sentry-source-file":"PublicationSkeleton.tsx",children:[(0,s.jsx)(v.Z.td,{className:"px-4 py-3",style:{width:"25%"},"data-sentry-element":"unknown","data-sentry-source-file":"PublicationSkeleton.tsx",children:(0,s.jsx)(w.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"PublicationSkeleton.tsx"})}),(0,s.jsx)(v.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},"data-sentry-element":"unknown","data-sentry-source-file":"PublicationSkeleton.tsx",children:(0,s.jsx)(w.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"PublicationSkeleton.tsx"})}),Array.from({length:4}).map((e,t)=>(0,s.jsx)(v.Z.td,{children:(0,s.jsx)(eY.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2","data-sentry-element":"unknown","data-sentry-source-file":"PublicationSkeleton.tsx",children:(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(w.Z,{className:"h-6 w-12 p-0",delayIndex:t,"data-sentry-element":"ShimmeringLoader","data-sentry-source-file":"PublicationSkeleton.tsx"})})})]})},tn=e=>{let{onSelectPublication:t=i()}=e,{project:n}=(0,g.d2)(),[a,l]=(0,p.useState)(""),{data:o,isLoading:d}=(0,q.z)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{mutate:u}=(0,te.u)({onSuccess:()=>{eN.Am.success("Successfully updated event"),y(null)}}),m=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),x=(0,Z.N4)(),h=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],f=0===a.length?null!=o?o:[]:(null!=o?o:[]).filter(e=>e.name.includes(a)),[j,y]=(0,p.useState)(null),b=async()=>{if(!j||!n)return;let{publication:e,event:t,currentStatus:s}=j,a={projectRef:n.ref,connectionString:n.connectionString,id:e.id};a["publish_".concat(t.event.toLowerCase())]=!s,u(a)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(_.Z,{size:"tiny",icon:(0,s.jsx)(c.Z,{size:"14"}),placeholder:"Filter",value:a,onChange:e=>l(e.target.value),"data-sentry-element":"Input","data-sentry-source-file":"PublicationsList.tsx"})}),x&&!m&&(0,s.jsx)("div",{className:"w-[500px]",children:(0,s.jsx)(e4.Z,{icon:(0,s.jsx)(e1.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database publications"})})]})}),(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"header.name"),(0,s.jsx)(v.Z.th,{children:"System ID"},"header.id"),(0,s.jsx)(v.Z.th,{children:"Insert"},"header.insert"),(0,s.jsx)(v.Z.th,{children:"Update"},"header.update"),(0,s.jsx)(v.Z.th,{children:"Delete"},"header.delete"),(0,s.jsx)(v.Z.th,{children:"Truncate"},"header.truncate"),(0,s.jsx)(v.Z.th,{className:"text-right",children:"Source"},"header.source")],body:d?Array.from({length:5}).map((e,t)=>(0,s.jsx)(tt,{index:t},t)):f.map(e=>(0,s.jsxs)(v.Z.tr,{className:"border-t",children:[(0,s.jsx)(v.Z.td,{className:"px-4 py-3",children:e.name}),(0,s.jsx)(v.Z.td,{children:e.id}),h.map(t=>(0,s.jsx)(v.Z.td,{children:(0,s.jsx)(eY.Z,{size:"tiny",checked:e[t.key],disabled:!m,onChange:()=>{y({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2",children:(0,s.jsx)("div",{className:"flex justify-end gap-2",children:(0,s.jsx)(E.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name)),"data-sentry-element":"Table","data-sentry-source-file":"PublicationsList.tsx"}),!d&&0===f.length&&(0,s.jsx)(ef.Z,{searchString:a,onResetFilter:()=>l(""),className:"rounded-t-none border-t-0"}),(0,s.jsx)(e7.Z,{visible:null!==j,title:"Confirm to toggle sending ".concat(null==j?void 0:j.event.event.toLowerCase()," events"),confirmLabel:"Confirm",confirmLabelLoading:"Updating",onCancel:()=>y(null),onConfirm:()=>{b()},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"PublicationsList.tsx",children:(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to ",(null==j?void 0:j.currentStatus)?"stop":"start"," ","sending ",null==j?void 0:j.event.event.toLowerCase()," events for"," ",null==j?void 0:j.publication.name,"?"]})})]})},ts=n(59108),ta=e=>{var t;let{table:n,selectedPublication:a}=e,{project:l}=(0,g.d2)(),i=null==a.tables,[o,c]=(0,p.useState)((null===(t=a.tables)||void 0===t?void 0:t.find(e=>e.id==n.id))!=void 0),d=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:u,isLoading:m}=(0,te.u)(),x=async(e,t)=>{var n;if(void 0===l)return console.error("Project is required");c(!o);let s=null!==(n=null==t?void 0:t.tables)&&void 0!==n?n:[],a=s.some(t=>t.id==e.id)?s.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(s.map(e=>"".concat(e.schema,".").concat(e.name)));u({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:t.id,tables:a},{onSuccess:()=>{eN.Am.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{eN.Am.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),c(o)}})};return(0,s.jsxs)(v.Z.tr,{"data-sentry-element":"unknown","data-sentry-component":"PublicationsTableItem","data-sentry-source-file":"PublicationsTableItem.tsx",children:[(0,s.jsx)(v.Z.td,{className:"whitespace-nowrap","data-sentry-element":"unknown","data-sentry-source-file":"PublicationsTableItem.tsx",children:n.name}),(0,s.jsx)(v.Z.td,{className:"whitespace-nowrap","data-sentry-element":"unknown","data-sentry-source-file":"PublicationsTableItem.tsx",children:n.schema}),(0,s.jsx)(v.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell","data-sentry-element":"unknown","data-sentry-source-file":"PublicationsTableItem.tsx",children:n.comment}),(0,s.jsx)(v.Z.td,{className:"px-4 py-3 pr-2","data-sentry-element":"unknown","data-sentry-source-file":"PublicationsTableItem.tsx",children:(0,s.jsx)("div",{className:"flex justify-end gap-2",children:i?(0,s.jsxs)(ey.C,{children:[(0,s.jsx)("span",{children:"Enabled"}),(0,s.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,s.jsx)(eY.Z,{size:"tiny",align:"right",disabled:!d||m,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>x(n,a)})})})]},n.id)},tr=e=>{let{selectedPublication:t,onSelectBack:n}=e,{project:a}=(0,g.d2)(),[l,i]=(0,p.useState)(""),d=(0,Z.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:u,isLoading:m,isSuccess:x,isError:h,error:f}=(0,$.Bj)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString},{select:e=>e.filter(e=>0===l.length?!k.s.includes(e.schema):!k.s.includes(e.schema)&&e.name.includes(l))});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(E.z,{type:"outline",onClick:()=>n(),icon:(0,s.jsx)(o.Z,{}),style:{padding:"5px"},"data-sentry-element":"Button","data-sentry-source-file":"PublicationsTables.tsx"}),(0,s.jsx)("div",{children:(0,s.jsx)(_.Z,{size:"small",placeholder:"Filter",value:l,onChange:e=>i(e.target.value),icon:(0,s.jsx)(c.Z,{size:"14"}),"data-sentry-element":"Input","data-sentry-source-file":"PublicationsTables.tsx"})})]}),!d&&(0,s.jsx)("div",{className:"w-[500px]",children:(0,s.jsx)(e4.Z,{icon:(0,s.jsx)(e1.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),m&&(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(ts.Z,{})}),h&&(0,s.jsx)(b.Z,{error:f,subject:"Failed to retrieve tables"}),x&&(0===u.length?(0,s.jsx)(y.Z,{}):(0,s.jsx)("div",{children:(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Name"},"header-name"),(0,s.jsx)(v.Z.th,{children:"Schema"},"header-schema"),(0,s.jsx)(v.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,s.jsx)(v.Z.th,{},"header-all")],body:u.map(e=>(0,s.jsx)(ta,{table:e,selectedPublication:t},e.id))})}))]})},tl=n(28977),ti=n.n(tl),to=n(50838),tc=n(73119),td=n(16354);async function tu(e){let{ref:t,backup:n}=e;if(n.isPhysicalBackup){let{data:e,error:s}=await (0,Y.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:n.id,recovery_time_target:n.inserted_at}});if(s)throw s;return e}let{data:s,error:a}=await (0,Y.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:n.id}});return a&&(0,Y.S3)(a),s}let tm=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ek.D)(e=>tu(e),{async onSuccess(t,n,s){await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,n,s)},...n})};var tx=n(24358),th=n(37417),tf=n(77946),tp=n(2684),tj=n(18341),tg=e=>{let{index:t,isHealthy:n,backup:a,onSelectBackup:l}=e,{ref:i}=(0,j.UO)(),o=(0,Z.Xo)(r.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=(0,tj.s)({onSuccess:e=>{let{fileUrl:t}=e,n=document.createElement("a");n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}});return(0,s.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),"data-sentry-component":"BackupItem","data-sentry-source-file":"BackupItem.tsx",children:[(0,s.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==a.status?"".concat(ti()(a.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):ti()(a.inserted_at).format("DD MMM YYYY")}),(0,s.jsx)("div",{children:"COMPLETED"===a.status?(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(N.u,{type:"default",disabled:!n||!o,onClick:l,tooltip:{content:{side:"bottom",text:n?o?void 0:"You need additional permissions to trigger a restore":"Cannot be restored as project is not active"}},children:"Restore"}),!a.isPhysicalBackup&&(0,s.jsx)(N.u,{type:"default",icon:(0,s.jsx)(tp.Z,{}),loading:d,disabled:!o||d,onClick:()=>{if(!i)return console.error("Project ref is required");c({ref:i,backup:a})},tooltip:{content:{side:"bottom",text:o?void 0:"You need additional permissions to download backups"}},children:"Download"})]}):(0,s.jsx)(ey.C,{variant:"warning","data-sentry-element":"Badge","data-sentry-component":"generateSideButtons","data-sentry-source-file":"BackupItem.tsx",children:"Backup In Progress..."})})]})},ty=n(32902),tv=n(76285),tb=()=>{var e,t;let n=(0,W.useRouter)(),a=(0,eZ.NL)(),{ref:r}=(0,j.UO)(),{project:l}=(0,g.d2)(),i=(null==l?void 0:l.status)===tf.S.ACTIVE_HEALTHY,[o,c]=(0,p.useState)(),{data:d}=(0,tx.T)({projectRef:r}),{mutate:u,isLoading:m,isSuccess:x}=tm({onSuccess:()=>{r&&setTimeout(()=>{(0,th.k7)(a,r,tf.S.RESTORING),eN.Am.success("Restoring database back to ".concat(ti()(null==o?void 0:o.inserted_at).format("DD MMM YYYY HH:mm:ss"))),n.push("/project/".concat(r))},3e3)}}),h=null!==(e=null==d?void 0:d.tierKey)&&void 0!==e?e:"",f=(null!==(t=null==d?void 0:d.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),y=null==d?void 0:d.pitr_enabled;return"FREE"===h?(0,s.jsx)(td.Z,{addon:"pitr",icon:(0,s.jsx)(to.Z,{size:20}),primaryText:"Free Plan does not include project backups.",secondaryText:"Upgrade to the Pro Plan for up to 7 days of scheduled backups."}):y?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"space-y-6",children:0===f.length&&"FREE"!==h?(0,s.jsx)(ty.Z,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tv.Z,{}),(0,s.jsx)(tc.Z,{children:null==f?void 0:f.map((e,t)=>(0,s.jsx)(tg,{backup:e,index:t,isHealthy:i,onSelectBackup:()=>c(e)},e.id))})]})}),(0,s.jsx)(e7.Z,{size:"small",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==o,title:"Confirm to restore from backup",loading:m||x,onCancel:()=>c(void 0),onConfirm:()=>void 0===r?console.error("Project ref required"):void 0===o?console.error("Backup required"):void u({ref:r,backup:o}),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"BackupsList.tsx",children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to restore from"," ",ti()(null==o?void 0:o.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})},tN=n(98219),tw=n(99896),tS=n.n(tw),tC=n(29787),tZ=n.n(tC),tk=n(61230),tE=n.n(tk),t_=n(27767),tT=n.n(t_),tF=n(92238),tR=n.n(tF),tz=n(23470),tP=n(26288),tI=n(50588),tA=n(83571),tL=n(52862),tD=n(48855),tB=e=>{let{icon:t,text:n}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2","data-sentry-component":"FormBoxEmpty","data-sentry-source-file":"FormBoxEmpty.tsx",children:[(0,s.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,s.jsx)("p",{className:"text-foreground-light",children:n})]})},tW=n(45756),tO=n(69452),tq=n(16211),tM=n(55410),tV=n(61929);async function tY(e){let{id:t,projectRef:n,connectionString:s,payload:a}=e,r=new Headers;s&&r.set("x-connection-encrypted",s);let l=await (0,tM.r$)("".concat(tf.T5,"/pg-meta/").concat(n,"/triggers?id=").concat(t),a,{headers:Object.fromEntries(r)});if(l.error)throw l.error;return l}let tH=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>tY(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(tV.D.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,n,s)},...n})};var tU=n(77308),tX=n(5643),tQ=n(65022),tG=n(23539),tJ=n(69107),tK=n.n(tJ),t$=n(3010),t0=n.n(t$),t1=n(27614),t2=n(70236),t4=n(63204),t5=e=>{let{triggerFunctions:t,visible:n,onChange:a,setVisible:r}=e,l=t.length>=1,i=tK()(t0()(t,"schema"),"schema");function o(e){a(e),r(!n)}return(0,s.jsx)(eF.ZP,{size:"large",header:"Pick a function",visible:n,onCancel:()=>r(!n),className:"hooks-sidepanel","data-sentry-element":"SidePanel","data-sentry-component":"ChooseFunctionForm","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("div",{className:"py-6",children:l?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(t3,{}),i.map(e=>(0,s.jsx)(t6,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:o},e))]}):(0,s.jsx)(t8,{})})})};let t3=()=>{let{ref:e}=(0,j.UO)();return(0,s.jsx)("div",{className:"px-6","data-sentry-component":"NoticeBox","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)(e4.Z,{icon:(0,s.jsx)(eQ.Z,{size:"20",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,s.jsx)(E.z,{asChild:!0,type:"default",children:(0,s.jsx)(f(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})}),"data-sentry-element":"InformationBox","data-sentry-source-file":"ChooseFunctionForm.tsx"})})},t8=()=>{let e=(0,W.useRouter)(),{ref:t}=e.query;return(0,s.jsx)(t1.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},"data-sentry-element":"ProductEmptyState","data-sentry-component":"NoFunctionsState","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},t6=e=>{let{schema:t,functions:n,selectFunction:a}=e;return(0,s.jsxs)("div",{className:"space-y-4","data-sentry-component":"SchemaFunctionGroup","data-sentry-source-file":"ChooseFunctionForm.tsx",children:[(0,s.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,s.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,s.jsx)("h5",{children:t})]}),(0,s.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:n.map(e=>(0,s.jsx)(t9,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:a},e.id))})]})},t9=e=>{let{id:t,completeStatement:n,name:a,onClick:r}=e,[l,i]=(0,p.useState)(!1);return(0,s.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>r(t),"data-sentry-component":"Function","data-sentry-source-file":"ChooseFunctionForm.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tQ.Z,{strokeWidth:2,size:14,"data-sentry-element":"Terminal","data-sentry-source-file":"ChooseFunctionForm.tsx"})}),(0,s.jsx)("p",{className:"mb-0 text-sm",children:a})]}),(0,s.jsx)(E.z,{type:"text",onClick:e=>{e.stopPropagation(),i(!l)},icon:(0,s.jsx)(t4.Z,{className:l?"rotate-180 transform":"rotate-0 transform"}),"data-sentry-element":"Button","data-sentry-source-file":"ChooseFunctionForm.tsx",children:l?"Hide definition":"View definition"})]}),(0,s.jsx)(tG.u,{show:l,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0","data-sentry-element":"Transition","data-sentry-source-file":"ChooseFunctionForm.tsx",children:(0,s.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,s.jsx)(t2.Z,{defaultValue:n,readOnly:!0,contextmenu:!1,"data-sentry-element":"SqlEditor","data-sentry-source-file":"ChooseFunctionForm.tsx"})})})]})};class t7{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,n,s,a,r,l,i,o,c,d,u;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(n=null==e?void 0:e.enabled_mode)&&void 0!==n?n:"ORIGIN"},this.events={value:null!==(s=null==e?void 0:e.events)&&void 0!==s?s:[]},this.functionName={value:null!==(a=null==e?void 0:e.function_name)&&void 0!==a?a:""},this.functionSchema={value:null!==(r=null==e?void 0:e.function_schema)&&void 0!==r?r:""},this.orientation={value:null!==(l=null==e?void 0:e.orientation)&&void 0!==l?l:"STATEMENT"},this.name={value:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""},this.condition={value:null!==(u=null==e?void 0:e.condition)&&void 0!==u?u:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,tN._)(this,"id",void 0),(0,tN._)(this,"originalName",void 0),(0,tN._)(this,"activation",void 0),(0,tN._)(this,"enabledMode",void 0),(0,tN._)(this,"events",void 0),(0,tN._)(this,"functionName",void 0),(0,tN._)(this,"functionSchema",void 0),(0,tN._)(this,"orientation",void 0),(0,tN._)(this,"name",void 0),(0,tN._)(this,"schema",void 0),(0,tN._)(this,"table",void 0),(0,tN._)(this,"tableId",void 0),(0,tN._)(this,"condition",void 0),(0,tz.ky)(this),this.reset()}}class ne{get isEditing(){return void 0!=this.formState.id}constructor(){(0,tN._)(this,"chooseFunctionFormVisible",!1),(0,tN._)(this,"formState",new t7),(0,tN._)(this,"meta",null),(0,tN._)(this,"tables",[]),(0,tN._)(this,"isDirty",!1),(0,tN._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,tN._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,tN._)(this,"setisDirty",e=>{this.isDirty=e}),(0,tN._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!k.s.includes(e.schema)),this.setDefaultSelectedTable()}),(0,tN._)(this,"onFormChange",e=>{let{key:t,value:n}=e;if(this.isDirty=!0,tS()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:n,error:void 0}}else this.formState[t]={value:n}}),(0,tN._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,tN._)(this,"validateForm",()=>{let e=!0,t=tE()(this.formState,(t,n)=>{switch(n){case"name":var s;if(tZ()(t.value)||(s=t.value,/\s/.test(s)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(tZ()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(tZ()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(tZ()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,tz.ky)(this)}}let nt=(0,p.createContext)(null);var nn=(0,tP.Pi)(e=>{let{trigger:t,visible:n,setVisible:a}=e,{project:r}=(0,g.d2)(),[l,i]=(0,p.useState)(!1),o=(0,tP.fv)(()=>new ne);(0,$.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{onSuccess(e){o.tables.length<=0&&o.setTables(e)}});let{data:c}=(0,tO.R)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),d=(null!=c?c:[]).filter(e=>"trigger"===e.return_type),{mutate:u,isLoading:m}=(0,tq.x)(),{mutate:x,isLoading:h}=tH();async function f(){if(!r)return console.error("Project is required");if(o.validateForm()){let e=o.formState.requestBody;o.isEditing&&e.id?x({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,payload:e},{onSuccess:()=>{eN.Am.success("Successfully updated trigger ".concat(e.name)),a(!n)},onError:e=>{eN.Am.error("Failed to update trigger: ".concat(e.message))}}):u({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,payload:e},{onSuccess:()=>{eN.Am.success("Successfully created trigger ".concat(e.name)),a(!n)},onError:e=>{eN.Am.error("Failed to create trigger: ".concat(e.message))}})}}(0,p.useEffect)(()=>{o.setisDirty(!1),t?o.formState.reset(t):(o.formState.reset(),o.setDefaultSelectedTable())},[n,t]);let j=o.tables.length>=1;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(eF.ZP,{size:"large",visible:n,onCancel:()=>{o.isDirty?i(!0):a(!n)},header:o.formState.id?"Edit '".concat(o.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!j,className:o.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:m||h,onConfirm:f,"data-sentry-element":"SidePanel","data-sentry-source-file":"CreateTrigger.tsx",children:j?(0,s.jsxs)("div",{children:[(0,s.jsxs)(nt.Provider,{value:o,children:[(0,s.jsx)("div",{className:"my-6 space-y-10",children:o.isEditing?(0,s.jsxs)("div",{className:"space-y-6 px-6",children:[(0,s.jsx)(ns,{}),(0,s.jsx)(na,{}),o.formState.condition.value&&(0,s.jsx)(nr,{})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(ns,{})}),(0,s.jsx)(eF.ZP.Separator,{}),(0,s.jsxs)("div",{className:"space-y-12 px-6",children:[(0,s.jsx)("h5",{children:"Conditions to fire trigger"}),(0,s.jsx)(ni,{}),(0,s.jsx)(no,{}),(0,s.jsx)(nc,{}),(0,s.jsx)(nl,{})]}),(0,s.jsx)(eF.ZP.Separator,{}),(0,s.jsx)(nd,{})]})}),(0,s.jsx)(t5,{triggerFunctions:d,visible:o.chooseFunctionFormVisible,setVisible:o.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=c?c:[]).find(t=>t.id===e);t&&o.onSelectFunction(t)}})]}),(0,s.jsx)(e7.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),a(!n)},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]}):(0,s.jsx)(tW.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let ns=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(_.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),na=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tA.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,s.jsxs)(tA.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behavior"})]}),(0,s.jsxs)(tA.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in replica mode"})]}),(0,s.jsxs)(tA.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,s.jsxs)(tA.Z.Option,{addOnBefore:e=>{let{active:t,selected:n}=e;return(0,s.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),nr=(0,tP.Pi)(()=>{let e=(0,p.useContext)(nt);return(0,s.jsxs)("div",{className:"text-sm leading-4 grid gap-2 md:grid md:grid-cols-12",children:[(0,s.jsx)("div",{className:"flex flex-col space-y-2 col-span-4",children:(0,s.jsx)("label",{className:"block text-foreground-light text-sm leading-4 break-all",children:"Condition"})}),(0,s.jsxs)("div",{className:"col-span-8 h-[100px]",children:[(0,s.jsx)(tD.Z,{isReadOnly:!0,autofocus:!1,id:"trigger-condition-".concat(e.formState.id),language:"pgsql",defaultValue:e.formState.condition.value}),(0,s.jsxs)("div",{className:"mt-2 text-foreground-lighter leading-normal text-sm",children:["This condition must be met for the trigger to fire.",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-foreground",children:"To update the condition, you must drop and recreate this trigger."})]})]})]})}),nl=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tA.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,s.jsxs)(tA.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,s.jsxs)(tA.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),ni=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(tA.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let n=t.tables.find(t=>t.id===e);n&&(t.onFormChange({key:"table",value:n.name}),t.onFormChange({key:"schema",value:n.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,s.jsx)(tA.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tI.Z,{src:"".concat(tf.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,s.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,s.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),no=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tL.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let n=t.formState.events.value,s=e.target.checked?tT()(n,[e.target.value]):tR()(n,e.target.value);t.onFormChange({key:"events",value:s})},error:t.formState.events.error,children:[(0,s.jsx)(tL.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,s.jsx)(tL.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,s.jsx)(tL.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),nc=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)(tA.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,s.jsx)(tA.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,s.jsx)(tU.Z,{strokeWidth:2,size:"18"})}),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:"before"}),(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,s.jsx)(tA.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,s.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,s.jsx)(tX.Z,{strokeWidth:2,size:"18"})}),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{children:"after"}),(0,s.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),nd=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"space-y-6 px-6",children:(0,s.jsx)("h5",{children:"Function to trigger"})}),(0,s.jsx)("div",{className:"px-6",children:tZ()(t.formState.functionName.value)?(0,s.jsx)(nu,{}):(0,s.jsx)(nm,{})})]})}),nu=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,s.jsx)(tB,{icon:(0,s.jsx)(tQ.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),nm=(0,tP.Pi)(e=>{let{}=e,t=(0,p.useContext)(nt);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,s.jsx)(tQ.Z,{size:"18",strokeWidth:2,width:14})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,s.jsx)("div",{children:(0,s.jsx)(ey.C,{children:t.formState.functionSchema.value})})]})]}),(0,s.jsx)(E.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var nx=n(25768),nh=n(97011),nf=e=>{let{trigger:t,visible:n,setVisible:a}=e,{project:r}=(0,g.d2)(),{id:l,name:i,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,nx.m)();async function u(){return r?l?void c({projectRef:r.ref,connectionString:r.connectionString,id:l},{onSuccess:()=>{eN.Am.success("Successfully removed ".concat(i)),a(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,s.jsx)(nh.Z,{variant:"warning",visible:n,onCancel:()=>a(!n),onConfirm:u,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(i),confirmPlaceholder:"Type in name of trigger",confirmString:i,text:(0,s.jsxs)(s.Fragment,{children:["This will delete your trigger called"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:i})," of schema"," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."},"data-sentry-element":"TextConfirmModal","data-sentry-component":"DeleteTrigger","data-sentry-source-file":"DeleteTrigger.tsx"})},np=n(64038),nj=n.n(np),ng=n(46235),ny=n(30344);async function nv(e){let{projectRef:t,connectionString:n,payload:s}=e,{sql:a,zod:r}=eC.Z.functions.create(s),{result:l}=await (0,eE.R)({projectRef:t,connectionString:n,sql:a,queryKey:["functions","create"]});return l}let nb=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>nv(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(ny.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to create database function: ".concat(e.message)):t(e,n,s)},...n})};async function nN(e){let{projectRef:t,connectionString:n,func:s,payload:a}=e,{sql:r,zod:l}=eC.Z.functions.update(s,a),{result:i}=await (0,eE.R)({projectRef:t,connectionString:n,sql:r,queryKey:["functions","update",s.id.toString()]});return i}let nw=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>nN(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(ny.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to update database function: ".concat(e.message)):t(e,n,s)},...n})};var nS=n(97274),nC=n(44273),nZ=n(84629),nk=n(89861),nE=n(83873),n_=n(54720),nT=n(68823);let nF=e=>{let{selectedFunction:t,assistantVisible:n,setAssistantVisible:a}=e;return(0,s.jsx)(nS.Tu,{className:"py-3 flex flex-row justify-between items-center border-b-0","data-sentry-element":"SheetHeader","data-sentry-component":"CreateFunctionHeader","data-sentry-source-file":"CreateFunctionHeader.tsx",children:(0,s.jsxs)("div",{className:"flex flex-row gap-3 items-center max-w-[75%]",children:[(0,s.jsxs)(nS.sw,{className:(0,eo.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),"data-sentry-element":"SheetClose","data-sentry-source-file":"CreateFunctionHeader.tsx",children:[(0,s.jsx)(L.Z,{className:"h-3 w-3","data-sentry-element":"X","data-sentry-source-file":"CreateFunctionHeader.tsx"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,s.jsx)(nS.bC,{className:"truncate","data-sentry-element":"SheetTitle","data-sentry-source-file":"CreateFunctionHeader.tsx",children:void 0!==t?"Edit '".concat(t,"' function"):"Add a new function"})]})})};var nR=n(71598),nz=n(62836);let nP=e=>{let{field:t,language:n,focused:a,setFocused:r}=e;return(0,s.jsxs)("div",{className:(0,eo.cn)("rounded-md relative group flex-grow"),"data-sentry-component":"FunctionEditor","data-sentry-source-file":"FunctionEditor.tsx",children:[(0,s.jsx)(eR.NI,{"data-sentry-element":"FormControl_Shadcn_","data-sentry-source-file":"FunctionEditor.tsx",children:void 0!==n&&(0,s.jsx)(tD.Z,{id:"database-functions-editor",language:"pgsql",placeholder:"plpgsql"===n?"BEGIN\n\nEND;":void 0,value:t.value,onInputChange:t.onChange})}),(0,s.jsx)("div",{className:(0,eo.cn)("absolute top-0 right-2 bg-surface-300 border border-strong rounded h-[28px]","opacity-0 group-hover:opacity-100 group-hover:top-2 transition-all"),children:(0,s.jsxs)(ei.u,{"data-sentry-element":"Tooltip_Shadcn_","data-sentry-source-file":"FunctionEditor.tsx",children:[(0,s.jsx)(ei.aJ,{asChild:!0,"data-sentry-element":"TooltipTrigger_Shadcn_","data-sentry-source-file":"FunctionEditor.tsx",children:(0,s.jsx)(E.z,{type:"text",size:"tiny",className:(0,eo.cn)("px-1.5 text-foreground-lighter hover:text-foreground","transition z-50"),onClick:()=>r(!a),icon:a?(0,s.jsx)(nR.Z,{}):(0,s.jsx)(nz.Z,{}),"data-sentry-element":"Button","data-sentry-source-file":"FunctionEditor.tsx"})}),(0,s.jsx)(ei._v,{side:"bottom","data-sentry-element":"TooltipContent_Shadcn_","data-sentry-source-file":"FunctionEditor.tsx",children:a?"Minimize editor":"Maximize editor"})]})})]})},nI="create-function-sidepanel",nA=ew.ZP.object({name:ew.ZP.string().trim().min(1),schema:ew.ZP.string().trim().min(1),args:ew.ZP.array(ew.ZP.object({name:ew.ZP.string().trim().min(1),type:ew.ZP.string().trim()})),behavior:ew.ZP.enum(["IMMUTABLE","STABLE","VOLATILE"]),definition:ew.ZP.string().trim().min(1),language:ew.ZP.string().trim(),return_type:ew.ZP.string().trim(),security_definer:ew.ZP.boolean(),config_params:ew.ZP.array(ew.ZP.object({name:ew.ZP.string().trim().min(1),value:ew.ZP.string().trim().min(1)})).optional()});var nL=e=>{let{func:t,visible:n,setVisible:a}=e,{project:r}=(0,g.d2)(),[l,i]=(0,p.useState)(!1),[o,c]=(0,p.useState)(!1),[d,u]=(0,p.useState)(!1),[m,x]=(0,p.useState)(!1),h=!!(null==t?void 0:t.id),f=(0,eb.cI)({resolver:(0,ev.F)(nA)}),j=f.watch("language"),{mutate:y,isLoading:v}=nb(),{mutate:b,isLoading:N}=nw();function w(){f.formState.isDirty?i(!0):a(!n)}let S=async e=>{if(!r)return console.error("Project is required");let s={...e,args:e.args.map(e=>"".concat(e.name," ").concat(e.type)),config_params:tE()(nj()(e.config_params,"name"),"value")};h?b({func:t,projectRef:r.ref,connectionString:r.connectionString,payload:s},{onSuccess:()=>{eN.Am.success("Successfully updated function ".concat(e.name)),a(!n)}}):y({projectRef:r.ref,connectionString:r.connectionString,payload:s},{onSuccess:()=>{eN.Am.success("Successfully created function ".concat(e.name)),a(!n)}})};return(0,p.useEffect)(()=>{if(n){var e,s,a,r,l,i,o;f.reset({name:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",schema:null!==(s=null==t?void 0:t.schema)&&void 0!==s?s:"public",args:(0,nT.cK)((null==t?void 0:t.argument_types)||"").value,behavior:null!==(a=null==t?void 0:t.behavior)&&void 0!==a?a:"VOLATILE",definition:null!==(r=null==t?void 0:t.definition)&&void 0!==r?r:"",language:null!==(l=null==t?void 0:t.language)&&void 0!==l?l:"plpgsql",return_type:null!==(i=null==t?void 0:t.return_type)&&void 0!==i?i:"void",security_definer:null!==(o=null==t?void 0:t.security_definer)&&void 0!==o&&o,config_params:(0,nT.QI)(null==t?void 0:t.config_params).value})}},[n,t]),(0,s.jsx)(nS.yo,{open:n,onOpenChange:()=>w(),"data-sentry-element":"Sheet","data-sentry-component":"CreateFunction","data-sentry-source-file":"index.tsx",children:(0,s.jsxs)(nS.ue,{showClose:!1,size:d?"lg":"default",className:(0,eo.cn)("p-0 flex flex-row gap-0",d?"!min-w-[1200px]":"!min-w-[600px]"),"data-sentry-element":"SheetContent","data-sentry-source-file":"index.tsx",children:[(0,s.jsxs)("div",{className:(0,eo.cn)("flex flex-col grow w-full",d&&"w-[60%]"),children:[(0,s.jsx)(nF,{selectedFunction:null==t?void 0:t.name,assistantVisible:d,setAssistantVisible:u,"data-sentry-element":"CreateFunctionHeader","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(nC.Z,{"data-sentry-element":"Separator","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(eR.l0,{...f,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"index.tsx",children:(0,s.jsxs)("form",{id:nI,className:"flex-grow overflow-auto",onSubmit:f.handleSubmit(S),children:[(0,s.jsx)(nS.DN,{className:m?"hidden":"","data-sentry-element":"SheetSection","data-sentry-source-file":"index.tsx",children:(0,s.jsx)(eR.Wi,{control:f.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsx)(n_.E,{label:"Name of function",description:"Name will also be used for the function name in postgres",layout:"horizontal",children:(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"index.tsx"})}),(0,s.jsx)(nC.Z,{className:m?"hidden":"","data-sentry-element":"Separator","data-sentry-source-file":"index.tsx"}),(0,s.jsxs)(nS.DN,{className:m?"hidden":"space-y-4","data-sentry-element":"SheetSection","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(eR.Wi,{control:f.control,name:"schema",render:e=>{let{field:t}=e;return(0,s.jsx)(n_.E,{label:"Schema",description:"Tables made in the table editor will be in 'public'",layout:"horizontal",children:(0,s.jsx)(eR.NI,{children:(0,s.jsx)(O.Z,{selectedSchemaName:t.value,excludedSchemas:k.s,size:"small",onSelectSchema:e=>t.onChange(e)})})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"index.tsx"}),!h&&(0,s.jsx)(eR.Wi,{control:f.control,name:"return_type",render:e=>{let{field:t}=e;return(0,s.jsx)(n_.E,{label:"Return type",layout:"horizontal",children:(0,s.jsxs)(nZ.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(nZ.i4,{className:"col-span-8",children:(0,s.jsx)(nZ.ki,{})}),(0,s.jsx)(nZ.Bw,{children:(0,s.jsx)(nk.x,{className:"h-52",children:["void","record","trigger","integer",...ng.DL].map(e=>(0,s.jsx)(nZ.Ql,{value:e,children:e},e))})})]})})}})]}),(0,s.jsx)(nC.Z,{className:m?"hidden":"","data-sentry-element":"Separator","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(nS.DN,{className:m?"hidden":"","data-sentry-element":"SheetSection","data-sentry-source-file":"index.tsx",children:(0,s.jsx)(nD,{readonly:h,"data-sentry-element":"FormFieldArgs","data-sentry-source-file":"index.tsx"})}),(0,s.jsx)(nC.Z,{className:m?"hidden":"","data-sentry-element":"Separator","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(nS.DN,{className:"".concat(m?"h-full":""," !px-0"),"data-sentry-element":"SheetSection","data-sentry-source-file":"index.tsx",children:(0,s.jsx)(eR.Wi,{control:f.control,name:"definition",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"space-y-4 flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"px-content",children:[(0,s.jsx)(eR.lX,{className:"text-base text-foreground",children:"Definition"}),(0,s.jsxs)(eR.pf,{className:"text-sm text-foreground-light",children:[(0,s.jsxs)("p",{children:["The language below should be written in ",(0,s.jsx)("code",{children:j}),"."]}),!h&&(0,s.jsx)("p",{children:"Change the language in the Advanced Settings below."})]})]}),(0,s.jsx)("div",{className:(0,eo.cn)("border border-default flex",m?"flex-grow ":"h-72"),children:(0,s.jsx)(nP,{field:t,language:j,focused:m,setFocused:x})}),(0,s.jsx)(eR.zG,{className:"px-content"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"index.tsx"})}),(0,s.jsx)(nC.Z,{className:m?"hidden":"","data-sentry-element":"Separator","data-sentry-source-file":"index.tsx"}),h?(0,s.jsx)(s.Fragment,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)("div",{className:"space-y-8 rounded bg-studio py-4 px-6 border border-overlay",children:(0,s.jsx)(eY.Z,{onChange:()=>c(!o),label:"Show advanced settings",checked:o,labelOptional:"These are settings that might be familiar for Postgres developers"})})}),o&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(nS.DN,{className:m?"hidden":"space-y-2 pt-0",children:[(0,s.jsx)(nO,{}),(0,s.jsx)(eR.Wi,{control:f.control,name:"behavior",render:e=>{let{field:t}=e;return(0,s.jsx)(n_.E,{label:"Behavior",layout:"horizontal",children:(0,s.jsxs)(nZ.Ph,{defaultValue:t.value,onValueChange:t.onChange,children:[(0,s.jsx)(nZ.i4,{className:"col-span-8",children:(0,s.jsx)(nZ.ki,{})}),(0,s.jsxs)(nZ.Bw,{children:[(0,s.jsx)(nZ.Ql,{value:"IMMUTABLE",children:"immutable"},"IMMUTABLE"),(0,s.jsx)(nZ.Ql,{value:"STABLE",children:"stable"},"STABLE"),(0,s.jsx)(nZ.Ql,{value:"VOLATILE",children:"volatile"},"VOLATILE")]})]})})}})]}),(0,s.jsx)(nC.Z,{className:m?"hidden":""}),(0,s.jsx)(nS.DN,{className:m?"hidden":"",children:(0,s.jsx)(nB,{readonly:h})}),(0,s.jsx)(nC.Z,{className:m?"hidden":""}),(0,s.jsxs)(nS.DN,{className:m?"hidden":"",children:[(0,s.jsx)("h5",{className:"text-base text-foreground mb-4",children:"Type of Security"}),(0,s.jsx)(eR.Wi,{control:f.control,name:"security_definer",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.NI,{className:"col-span-8",children:(0,s.jsxs)(nE.Z.Group,{type:"cards",layout:"vertical",onChange:e=>t.onChange("SECURITY_DEFINER"==e.target.value),value:t.value?"SECURITY_DEFINER":"SECURITY_INVOKER",children:[(0,s.jsx)(nE.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.value,description:(0,s.jsxs)(s.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,s.jsx)("span",{className:"text-foreground",children:"calls it"}),"."]})}),(0,s.jsx)(nE.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.value,description:(0,s.jsxs)(s.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,s.jsx)("span",{className:"text-foreground",children:"created it"}),"."]})})]})}),(0,s.jsx)(eR.zG,{})]})}})]})]})]})]})}),(0,s.jsxs)(nS.FF,{"data-sentry-element":"SheetFooter","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(E.z,{disabled:v||N,type:"default",onClick:w,"data-sentry-element":"Button","data-sentry-source-file":"index.tsx",children:"Cancel"}),(0,s.jsx)(E.z,{form:nI,htmlType:"submit",disabled:v||N,loading:v||N,"data-sentry-element":"Button","data-sentry-source-file":"index.tsx",children:"Confirm"})]})]}),d?(0,s.jsx)("div",{className:"border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10 w-[50%] bg-studio"}):null,(0,s.jsx)(e7.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),a(!n)},"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"index.tsx",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})})};let nD=e=>{let{readonly:t}=e,{fields:n,append:a,remove:r}=(0,eb.Dq)({name:"args"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&tZ()(n)&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,s.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,s.jsx)(eR.Wi,{name:"args.".concat(n,".name"),render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...n,disabled:t,placeholder:"argument_name"})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{name:"args.".concat(n,".type"),render:e=>{let{field:n}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:t?(0,s.jsx)(ez.I,{value:n.value,disabled:!0,readOnly:!0,className:"h-auto"}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(nZ.Ph,{disabled:t,onValueChange:n.onChange,defaultValue:n.value,children:[(0,s.jsx)(nZ.i4,{className:"h-[38px]",children:(0,s.jsx)(nZ.ki,{})}),(0,s.jsx)(nZ.Bw,{children:(0,s.jsx)(nk.x,{className:"h-52",children:["integer",...ng.DL].map(e=>(0,s.jsx)(nZ.Ql,{value:e,children:e},e))})})]})})}),(0,s.jsx)(eR.zG,{})]})}}),!t&&(0,s.jsx)(E.z,{type:"danger",icon:(0,s.jsx)(x.Z,{size:12}),onClick:()=>r(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,s.jsx)(E.z,{type:"default",icon:(0,s.jsx)(d.Z,{size:12}),onClick:()=>a({name:"",type:"integer"}),disabled:t,children:"Add a new argument"})]})]})},nB=e=>{let{readonly:t}=e,{fields:n,append:a,remove:r}=(0,eb.Dq)({name:"config_params"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h5",{className:"text-base text-foreground",children:"Configuration Parameters"}),(0,s.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&tZ()(n)&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),n.map((e,n)=>(0,s.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,s.jsx)(eR.Wi,{name:"config_params.".concat(n,".name"),render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t,placeholder:"parameter_name"})}),(0,s.jsx)(eR.zG,{})]})}}),(0,s.jsx)(eR.Wi,{name:"config_params.".concat(n,".value"),render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{className:"flex-1",children:[(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t,placeholder:"parameter_value"})}),(0,s.jsx)(eR.zG,{})]})}}),!t&&(0,s.jsx)(E.z,{type:"danger",icon:(0,s.jsx)(x.Z,{size:12}),onClick:()=>r(n),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,s.jsx)(E.z,{type:"default",icon:(0,s.jsx)(d.Z,{size:12}),onClick:()=>a({name:"",type:""}),disabled:t,children:"Add a new config"})]})]})},nW=["plpgsql","sql","plcoffee","plv8","plls"],nO=()=>{let{project:e}=(0,g.d2)(),{data:t}=(0,e5.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString},{select:e=>em()(e,e=>!e0()(e.installed_version))[0]}),n=(0,p.useMemo)(()=>nW.filter(e=>!e.startsWith("pl")||(null==t?void 0:t.find(t=>t.name===e))!==void 0),[t]);return(0,s.jsx)(eR.Wi,{name:"language",render:e=>{let{field:t}=e;return(0,s.jsx)(n_.E,{label:"Language",layout:"horizontal",children:(0,s.jsxs)(nZ.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(nZ.i4,{className:"col-span-8",children:(0,s.jsx)(nZ.ki,{})}),(0,s.jsx)(nZ.Bw,{children:n.map(e=>(0,s.jsx)(nZ.Ql,{value:e,children:e},e))})]})})},"data-sentry-element":"FormField_Shadcn_","data-sentry-component":"FormFieldLanguage","data-sentry-source-file":"index.tsx"})};async function nq(e){let{projectRef:t,connectionString:n,func:s}=e,{sql:a,zod:r}=eC.Z.functions.remove(s),{result:l}=await (0,eE.R)({projectRef:t,connectionString:n,sql:a,queryKey:["functions","delete",s.id.toString()]});return l}let nM=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>nq(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(ny.A.databaseFunctions(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to delete database function: ".concat(e.message)):t(e,n,s)},...n})};var nV=e=>{let{func:t,visible:n,setVisible:a}=e,{project:r}=(0,g.d2)(),{name:l,schema:i}=null!=t?t:{},{mutate:o,isLoading:c}=nM({onSuccess:()=>{eN.Am.success("Successfully removed function ".concat(l)),a(!1)}});async function d(){return t?r?void o({func:t,projectRef:r.ref,connectionString:r.connectionString}):console.error("Project is required"):console.error("Function is required")}return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nh.Z,{variant:"warning",visible:n,onCancel:()=>a(!n),onConfirm:d,title:"Delete this function",loading:c,confirmLabel:"Delete function ".concat(l),confirmPlaceholder:"Type in name of function",confirmString:null!=l?l:"Unknown",text:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"This will delete the function"})," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:l})," ",(0,s.jsx)("span",{children:"from the schema"})," ",(0,s.jsx)("span",{className:"text-bold text-foreground",children:i})]}),alert:{title:"You cannot recover this function once deleted."},"data-sentry-element":"TextConfirmModal","data-sentry-source-file":"DeleteFunction.tsx"})})},nY=n(94784),nH=n(31899),nU=n(91539),nX=n(71904),nQ=n(84860),nG=n(57852);async function nJ(e){let{projectRef:t,connectionString:n,schema:s,name:a,description:r,values:l}=e,i='create type "'.concat(s,'"."').concat(a,'" as enum (').concat(l.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==r?'comment on type "'.concat(s,'"."').concat(a,"\" is '").concat(r,"';"):"",c=(0,nQ.J)("".concat(i," ").concat(o)),{result:d}=await (0,eE.R)({projectRef:t,connectionString:n,sql:c});return d}let nK=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>nJ(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nG.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n$=n(19224),n0=e=>{let{index:t,id:n,field:a,isDisabled:r=!1,onRemoveValue:l}=e;return(0,s.jsx)(nU._l,{draggableId:n,index:t,isDragDisabled:r,"data-sentry-element":"Draggable","data-sentry-component":"EnumeratedTypeValueRow","data-sentry-source-file":"EnumeratedTypeValueRow.tsx",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2 space-y-2",children:[(0,s.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(r?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,s.jsx)(n$.Z,{size:16,strokeWidth:1.5})}),(0,s.jsx)(ez.I,{...a,className:"w-full"}),(0,s.jsx)(E.z,{type:"default",size:"small",disabled:r,icon:(0,s.jsx)(x.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>l()})]})})};let n1=[...ng.ji,...ng.BB,...ng.YF,...ng.Ks,...ng.XO,...ng.lb,...ng.vH,"bigint","bigserial","bit","bit varying","boolean","box","bytea","char","character","character varying","cidr","circle","date","double precision","inet","int","integer","interval","line","lseg","macaddr","macaddr8","money","numeric","decimal","path","pg_lsn","pg_snapshot","point","polygon","real","smallint","smallserial","serial","time with timezone","timestamp with timezone","tsquery","tsvector","txid_snapshot","xml"];var n2=n(2552),n4=e=>{let{visible:t,onClose:n,schema:a}=e,r={name:"",description:"",values:[{value:""}]},l=(0,p.useRef)(null),{project:i}=(0,g.d2)(),{mutate:o,isLoading:c}=nK({onSuccess:(e,t)=>{eN.Am.success('Successfully created type "'.concat(t.name,'"')),b()}});(0,p.useEffect)(()=>{m.reset(r)},[t]);let u=ew.Ry({name:ew.Z_().min(1,"Please provide a name for your enumerated type").refine(e=>!n1.includes(e),{message:"Name cannot be a native Postgres data type"}).default(""),description:ew.Z_().default("").optional(),values:ew.Ry({value:ew.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ev.F)(u),defaultValues:r}),{fields:x,append:h,remove:j,move:y}=(0,eb.Dq)({name:"values",control:m.control}),v=e=>{e.destination&&y(e.source.index,e.destination.index)},b=()=>{m.reset(r),n()};return(0,s.jsx)(eF.ZP,{loading:c,visible:t,onCancel:b,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{l.current&&l.current.click()},"data-sentry-element":"SidePanel","data-sentry-component":"CreateEnumeratedTypeSidePanel","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(eF.ZP.Content,{className:"py-4","data-sentry-element":"unknown","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(eR.l0,{...m,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:(0,s.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;return(null==i?void 0:i.ref)===void 0?console.error("Project ref required"):(null==i?void 0:i.connectionString)===void 0?console.error("Project connectionString required"):void o({projectRef:i.ref,connectionString:i.connectionString,schema:a,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value.trim())})}),children:[(0,s.jsx)(eR.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Name"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t})}),(0,s.jsx)(eR.zG,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx"}),(0,s.jsx)(eR.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Description"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t})}),(0,s.jsx)(eR.pf,{children:"Optional"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx"}),(0,s.jsx)(nU.Z5,{onDragEnd:e=>v(e),"data-sentry-element":"DragDropContext","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(nU.bK,{droppableId:"enum_type_values_droppable","data-sentry-element":"Droppable","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,children:[x.map((e,t)=>(0,s.jsx)(eR.Wi,{control:m.control,name:"values.".concat(t,".value"),render:n=>{let{field:a}=n;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{className:(0,eo.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,s.jsxs)(nX.bZ,{children:[(0,s.jsx)(e1.Z,{strokeWidth:1.5}),(0,s.jsx)(nX.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,s.jsxs)(nX.X,{children:[(0,s.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,s.jsx)(E.z,{asChild:!0,type:"default",icon:(0,s.jsx)(n2.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,s.jsx)(f(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(n0,{index:t,id:e.id,field:a,isDisabled:x.length<2,onRemoveValue:()=>j(t)})}),(0,s.jsx)(eR.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,s.jsx)(E.z,{type:"default",icon:(0,s.jsx)(d.Z,{strokeWidth:1.5}),onClick:()=>h({value:""}),"data-sentry-element":"Button","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:"Add value"}),(0,s.jsx)(E.z,{ref:l,htmlType:"submit",type:"default",className:"hidden","data-sentry-element":"Button","data-sentry-source-file":"CreateEnumeratedTypeSidePanel.tsx",children:"Update"})]})})})})};async function n5(e){let{projectRef:t,connectionString:n,name:s,schema:a}=e,r="drop type if exists ".concat(a,'."').concat(s,'"'),{result:l}=await (0,eE.R)({projectRef:t,connectionString:n,sql:r});return l}let n3=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>n5(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nG.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n8=e=>{let{visible:t,selectedEnumeratedType:n,onClose:a}=e,{project:r}=(0,g.d2)(),{mutate:l,isLoading:i}=n3({onSuccess:()=>{eN.Am.success('Successfully deleted "'.concat(n.name,'"')),a()}}),o=()=>void 0===n?console.error("No enumerated type selected"):(null==r?void 0:r.ref)===void 0?console.error("Project ref required"):(null==r?void 0:r.connectionString)===void 0?console.error("Project connectionString required"):void l({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,name:n.name,schema:n.schema});return(0,s.jsxs)(e7.Z,{variant:"destructive",size:"medium",loading:i,visible:t,title:(0,s.jsxs)(s.Fragment,{children:["Confirm to delete enumerated type"," ",(0,s.jsx)("code",{className:"text-sm",children:null==n?void 0:n.name})]}),confirmLabel:"Confirm delete",confirmLabelLoading:"Deleting...",onCancel:a,onConfirm:()=>o(),alert:{title:"This action cannot be undone",description:"You will need to re-create the enumerated type if you want to revert the deletion."},"data-sentry-element":"ConfirmationModal","data-sentry-component":"DeleteEnumeratedTypeModal","data-sentry-source-file":"DeleteEnumeratedTypeModal.tsx",children:[(0,s.jsx)("p",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,s.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,s.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})};async function n6(e){let{projectRef:t,connectionString:n,schema:s,name:a,description:r,values:l=[]}=e,i=[];a.original!==a.updated&&i.push('alter type "'.concat(s,'"."').concat(a.original,'" rename to "').concat(a.updated,'";')),l.length>0&&l.forEach((e,t)=>{if(e.isNew){if(0===t){let t=l.find(e=>!e.isNew);i.push('alter type "'.concat(s,'"."').concat(a.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else i.push('alter type "'.concat(s,'"."').concat(a.updated,"\" add value '").concat(e.updated,"' after '").concat(l[t-1].updated,"';"))}else e.original!==e.updated&&i.push('alter type "'.concat(s,'"."').concat(a.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==r&&i.push('comment on type "'.concat(s,'"."').concat(a.updated,"\" is '").concat(r,"';"));let o=(0,nQ.J)(i.join(" ")),{result:c}=await (0,eE.R)({projectRef:t,connectionString:n,sql:o});return c}let n9=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,eZ.NL)();return(0,ek.D)(e=>n6(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(nG.P.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?eN.Am.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,n,s)},...n})};var n7=e=>{var t;let{visible:n,selectedEnumeratedType:a,onClose:r}=e,l=(0,p.useRef)(null),{project:i}=(0,g.d2)(),{mutate:o,isLoading:c}=n9({onSuccess:(e,t)=>{eN.Am.success('Successfully updated type "'.concat(t.name.updated,'"')),r()}}),u=ew.Ry({name:ew.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:ew.Z_().default("").optional(),values:ew.Ry({isNew:ew.O7(),originalValue:ew.Z_(),updatedValue:ew.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ev.F)(u),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:x,append:h,remove:j,move:y}=(0,eb.Dq)({name:"values",control:m.control}),v=e=>{e.destination&&y(e.source.index,e.destination.index)},b=(null!==(t=null==a?void 0:a.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,p.useEffect)(()=>{if(void 0!==a){var e;m.reset({name:a.name,description:null!==(e=a.comment)&&void 0!==e?e:"",values:b})}void 0==a&&m.reset({values:b})},[a]),(0,s.jsx)(eF.ZP,{loading:c,visible:n,onCancel:r,header:'Update type "'.concat(null==a?void 0:a.name,'"'),confirmText:"Update type",onConfirm:()=>{l.current&&l.current.click()},"data-sentry-element":"SidePanel","data-sentry-component":"EditEnumeratedTypeSidePanel","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(eF.ZP.Content,{className:"py-4","data-sentry-element":"unknown","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(eR.l0,{...m,"data-sentry-element":"Form_Shadcn_","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:(0,s.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;if((null==i?void 0:i.ref)===void 0)return console.error("Project ref required");if((null==i?void 0:i.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===a)return console.error("selectedEnumeratedType required");let n={schema:a.schema,name:{original:a.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue.trim(),isNew:e.isNew})),...e.description!==a.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:i.ref,connectionString:i.connectionString,...n})}),children:[(0,s.jsx)(eR.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Name"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t})}),(0,s.jsx)(eR.zG,{})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx"}),(0,s.jsx)(eR.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{children:"Description"}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(ez.I,{...t})}),(0,s.jsx)(eR.pf,{children:"Optional"})]})},"data-sentry-element":"FormField_Shadcn_","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx"}),(0,s.jsx)(nU.Z5,{onDragEnd:e=>v(e),"data-sentry-element":"DragDropContext","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:(0,s.jsx)(nU.bK,{droppableId:"enum_type_values_droppable","data-sentry-element":"Droppable","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,children:[x.map((e,t)=>(0,s.jsx)(eR.Wi,{control:m.control,name:"values.".concat(t,".updatedValue"),render:n=>{let{field:a}=n;return(0,s.jsxs)(eR.xJ,{children:[(0,s.jsx)(eR.lX,{className:(0,eo.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,s.jsxs)(nX.bZ,{children:[(0,s.jsx)(e1.Z,{strokeWidth:1.5}),(0,s.jsx)(nX.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,s.jsxs)(nX.X,{children:[(0,s.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,s.jsx)(E.z,{asChild:!0,type:"default",icon:(0,s.jsx)(n2.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,s.jsx)(f(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,s.jsx)(eR.NI,{children:(0,s.jsx)(n0,{index:t,id:e.id,field:a,isDisabled:!e.isNew,onRemoveValue:()=>j(t)})}),(0,s.jsx)(eR.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,s.jsx)(E.z,{type:"default",icon:(0,s.jsx)(d.Z,{strokeWidth:1.5}),onClick:()=>h({isNew:!0,originalValue:"",updatedValue:""}),"data-sentry-element":"Button","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:"Add value"}),(0,s.jsx)(E.z,{ref:l,htmlType:"submit",type:"default",className:"hidden","data-sentry-element":"Button","data-sentry-source-file":"EditEnumeratedTypeSidePanel.tsx",children:"Update"})]})})})})},se=()=>{let{project:e}=(0,g.d2)(),[t,n]=(0,p.useState)(""),{selectedSchema:a,setSelectedSchema:r}=(0,es.B)(),[l,i]=(0,p.useState)(!1),[o,d]=(0,p.useState)(),[h,f]=(0,p.useState)(),{data:j}=(0,nY.Q1)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:y,error:N,isLoading:S,isError:C,isSuccess:Z}=(0,nH.k)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),R=(null!=y?y:[]).filter(e=>e.enums.length>0),z=t.length>0?R.filter(e=>e.schema===a&&e.name.toLowerCase().includes(t.toLowerCase())):R.filter(e=>e.schema===a),P=(null!=j?j:[]).filter(e=>{var t;return k.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),I=null==j?void 0:j.find(e=>e.name===a),A=P.some(e=>e.id===(null==I?void 0:I.id));return(0,s.jsxs)("div",{className:"space-y-4","data-sentry-component":"EnumeratedTypes","data-sentry-source-file":"EnumeratedTypes.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(O.Z,{className:"w-[180px]",size:"tiny",showError:!1,selectedSchemaName:a,onSelectSchema:r,"data-sentry-element":"SchemaSelector","data-sentry-source-file":"EnumeratedTypes.tsx"}),(0,s.jsx)(_.Z,{size:"tiny",value:t,className:"w-52",onChange:e=>n(e.target.value),placeholder:"Search for a type",icon:(0,s.jsx)(c.Z,{size:14}),"data-sentry-element":"Input","data-sentry-source-file":"EnumeratedTypes.tsx"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(e2.G,{href:"https://www.postgresql.org/docs/current/datatype-enum.html","data-sentry-element":"DocsButton","data-sentry-source-file":"EnumeratedTypes.tsx"}),!A&&(0,s.jsx)(E.z,{className:"ml-auto",type:"primary",onClick:()=>i(!0),children:"Create type"})]})]}),A&&(0,s.jsx)(F.Z,{schema:a,entity:"enumerated types"}),S&&(0,s.jsx)(w.A,{}),C&&(0,s.jsx)(b.Z,{error:N,subject:"Failed to retrieve database enumerated types"}),Z&&(0,s.jsx)(v.Z,{head:[(0,s.jsx)(v.Z.th,{children:"Schema"},"schema"),(0,s.jsx)(v.Z.th,{children:"Name"},"name"),(0,s.jsx)(v.Z.th,{children:"Values"},"values"),(0,s.jsx)(v.Z.th,{},"actions")],body:(0,s.jsxs)(s.Fragment,{children:[0===z.length&&0===t.length&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:4,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',a,'"']})]})}),0===z.length&&t.length>0&&(0,s.jsx)(v.Z.tr,{children:(0,s.jsxs)(v.Z.td,{colSpan:4,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),z.length>0&&z.map(e=>(0,s.jsxs)(v.Z.tr,{children:[(0,s.jsx)(v.Z.td,{className:"w-20",children:(0,s.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,s.jsx)(v.Z.td,{children:e.name}),(0,s.jsx)(v.Z.td,{children:e.enums.join(", ")}),(0,s.jsx)(v.Z.td,{children:!A&&(0,s.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,s.jsxs)(T.h_,{children:[(0,s.jsx)(T.$F,{asChild:!0,children:(0,s.jsx)(E.z,{type:"default",className:"px-1",icon:(0,s.jsx)(u.Z,{})})}),(0,s.jsxs)(T.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,s.jsxs)(T.Xi,{className:"space-x-2",onClick:()=>d(e),children:[(0,s.jsx)(m.Z,{size:14}),(0,s.jsx)("p",{children:"Update type"})]}),(0,s.jsxs)(T.Xi,{className:"space-x-2",onClick:()=>f(e),children:[(0,s.jsx)(x.Z,{size:14}),(0,s.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,s.jsx)(n4,{visible:l,onClose:()=>i(!1),schema:a,"data-sentry-element":"CreateEnumeratedTypeSidePanel","data-sentry-source-file":"EnumeratedTypes.tsx"}),(0,s.jsx)(n7,{visible:void 0!==o,selectedEnumeratedType:o,onClose:()=>d(void 0),"data-sentry-element":"EditEnumeratedTypeSidePanel","data-sentry-source-file":"EnumeratedTypes.tsx"}),(0,s.jsx)(n8,{visible:void 0!==h,selectedEnumeratedType:h,onClose:()=>f(void 0),"data-sentry-element":"DeleteEnumeratedTypeModal","data-sentry-source-file":"EnumeratedTypes.tsx"})]})}},73362:function(e,t,n){n.d(t,{Q:function(){return i}});var s=n(97458),a=n(90537),r=n(28436),l=n(69735),i=e=>{let{page:t,menu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto","data-sentry-component":"ProductMenu","data-sentry-source-file":"ProductMenu.tsx",children:(0,s.jsx)(a.ZP,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"ProductMenu.tsx",children:n.map((e,i)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"my-6 space-y-8",children:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(a.ZP.Group,{title:e.title?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,s.jsx)("span",{children:e.title}),e.isPreview&&(0,s.jsx)(r.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,s.jsx)("div",{children:e.items.map(e=>(0,s.jsx)(l.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),i!==n.length-1&&(0,s.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},16323:function(e,t,n){n.d(t,{k:function(){return d}});var s=n(36457),a=n(64618),r=n(34549),l=n(61250),i=n(29020),o=n(91605);async function c(e){let{projectRef:t,connectionString:n,schema:s,name:a,version:r,cascade:o=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,i.R)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(s)})}catch(e){throw e}let{data:u,error:m}=await (0,l.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:s,name:a,version:r,cascade:o},headers:d});return m&&(0,l.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,a.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await l.invalidateQueries(o.o.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},71292:function(e,t,n){n.d(t,{H:function(){return c}});var s=n(28894),a=n(61250),r=n(91605),l=n(51735),i=n(77946);async function o(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,a.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:r,signal:t});return i&&(0,a.S3)(i),l}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(0,l.Vm)(),u=(null==d?void 0:d.status)===i.S.ACTIVE_HEALTHY;return(0,s.a)(r.o.list(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t&&u,...c})}},69452:function(e,t,n){n.d(t,{R:function(){return c}});var s=n(95199),a=n(28894),r=n(30344),l=n(29020);let i=s.Z.functions.list();async function o(e,t,n){let{projectRef:s,connectionString:a}=e,r=new Headers(n),{result:o}=await (0,l.R)({projectRef:s,connectionString:a,sql:i.sql,queryKey:["database-functions"]},t,r);return o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.a)(r.A.databaseFunctions(t),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...l})}},4621:function(e,t,n){n.d(t,{z:function(){return i}});var s=n(28894),a=n(61250),r=n(24877);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,a.U2)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:r,signal:t});return i&&(0,a.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.z.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...i})}},33645:function(e,t,n){n.d(t,{u:function(){return c}});var s=n(36457),a=n(64618),r=n(34549),l=n(61250),i=n(24877);async function o(e){let{projectRef:t,connectionString:n,id:s,tables:a,publish_insert:r,publish_update:i,publish_delete:o,publish_truncate:c}=e,d=new Headers;n&&d.set("x-connection-encrypted",n);let u={id:s};void 0!==a&&(u.tables=a),void 0!==r&&(u.publish_insert=r),void 0!==i&&(u.publish_update=i),void 0!==o&&(u.publish_delete=o),void 0!==c&&(u.publish_truncate=c);let{data:m,error:x}=await (0,l.r$)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:s}},body:u,headers:d});return x&&(0,l.S3)(x),m}let c=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,a.D)(e=>o(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await l.invalidateQueries(i.z.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to update database publication: ".concat(e.message)):t(e,n,s)},...n})}},24877:function(e,t,n){n.d(t,{z:function(){return s}});let s={list:e=>["projects",e,"database-publications"]}},16211:function(e,t,n){n.d(t,{x:function(){return d}});var s=n(36457),a=n(64618),r=n(34549),l=n(55410),i=n(77946),o=n(61929);async function c(e){let{projectRef:t,connectionString:n,payload:s}=e,a=new Headers;n&&a.set("x-connection-encrypted",n);let r=await (0,l.v_)("".concat(i.T5,"/pg-meta/").concat(t,"/triggers"),s,{headers:Object.fromEntries(a)});if(r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,a.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await l.invalidateQueries(o.D.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,n,s)},...n})}},25768:function(e,t,n){n.d(t,{m:function(){return d}});var s=n(36457),a=n(64618),r=n(34549),l=n(55410),i=n(77946),o=n(61929);async function c(e){let{id:t,projectRef:n,connectionString:s}=e,a=new Headers;s&&a.set("x-connection-encrypted",s);let r=await (0,l.$v)("".concat(i.T5,"/pg-meta/").concat(n,"/triggers?id=").concat(t),void 0,{headers:Object.fromEntries(a)});if(null==r?void 0:r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,s.NL)();return(0,a.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:a}=n;await l.invalidateQueries(o.D.list(a)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,n,s)},...n})}},24358:function(e,t,n){n.d(t,{T:function(){return o}});var s=n(28894),a=n(61250),r=n(30344),l=n(51735);async function i(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:s,error:r}=await (0,a.U2)("/platform/database/{ref}/backups",{params:{path:{ref:n}},signal:t});return r&&(0,a.S3)(r),s}let o=function(e){let{projectRef:t}=e,{enabled:n=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=(0,l.Qv)();return(0,s.a)(r.A.backups(t),e=>{let{signal:n}=e;return i({projectRef:t},n)},{enabled:n&&!1===o&&void 0!==t,...a})}},94485:function(e,t,n){n.d(t,{E3:function(){return o}});var s=n(28894),a=n(29020),r=n(30344);let l=()=>"show max_connections";async function i(e,t){let{projectRef:n,connectionString:s}=e,r=l(),{result:i}=await (0,a.R)({projectRef:n,connectionString:s,sql:r,queryKey:["max-connections"]},t);return{maxConnections:parseInt(i[0].max_connections)}}let o=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.A.maxConnections(t),e=>{let{signal:s}=e;return i({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...l})}},31899:function(e,t,n){n.d(t,{k:function(){return i}});var s=n(28894),a=n(61250),r=n(57852);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let r=new Headers;s&&r.set("x-connection-encrypted",s);let{data:l,error:i}=await (0,a.U2)("/platform/pg-meta/{ref}/types",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:Object.fromEntries(r),signal:t});return i&&(0,a.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:n}=e,{enabled:a=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.P.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:a&&void 0!==t,...i})}},9390:function(e,t,n){n.d(t,{T:function(){return s}});let s={list:e=>["projects",e,"foreignTables"],listBySchema:(e,t)=>[...s.list(e),t]}},84860:function(e,t,n){n.d(t,{J:function(){return s}});function s(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}},2325:function(e,t,n){n.d(t,{N:function(){return s}});let s={list:e=>["projects",e,"views"],listBySchema:(e,t)=>[...s.list(e),t]}},32902:function(e,t,n){var s=n(97458),a=n(92197);t.Z=()=>(0,s.jsx)("div",{className:"block w-full rounded border border-muted border-opacity-50 bg-gray-300 p-3","data-sentry-component":"BackupsEmpty","data-sentry-source-file":"BackupsEmpty.tsx",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)(a.Z,{size:20,strokeWidth:1.5,"data-sentry-element":"Info","data-sentry-source-file":"BackupsEmpty.tsx"}),(0,s.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},76285:function(e,t,n){var s=n(97458),a=n(71904),r=n(55203);t.Z=()=>(0,s.jsxs)(a.bZ,{variant:"default","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"BackupsStorageAlert","data-sentry-source-file":"BackupsStorageAlert.tsx",children:[(0,s.jsx)(r.aN,{"data-sentry-element":"WarningIcon","data-sentry-source-file":"BackupsStorageAlert.tsx"}),(0,s.jsx)(a.X,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"BackupsStorageAlert.tsx",children:"Database backups do not include objects stored via the Storage API, as the database only includes metadata about these objects. Restoring an old backup does not restore objects that have been deleted since then."})]})},85760:function(e,t,n){var s=n(97458),a=n(81449),r=n(7082),l=n(2552),i=n(52983),o=n(34549),c=n(20170),d=n(98261),u=n(16323),m=n(94784),x=n(29020),h=n(2054),f=n(93009),p=n(96789),j=n(83571),g=n(71904),y=n(55203),v=n(19168),b=n(61911),N=n(26655),w=n(51735);let S=["vector","postgis"];t.Z=e=>{let{visible:t,extension:n,onCancel:C}=e,{project:Z}=(0,c.d2)(),k=(0,w.Qv)(),[E,_]=(0,i.useState)(),[T,F]=(0,i.useState)(!1),{data:R,isLoading:z}=(0,m.Q1)({projectRef:null==Z?void 0:Z.ref,connectionString:null==Z?void 0:Z.connectionString}),{mutate:P,isLoading:I}=(0,u.k)({onSuccess:()=>{o.Am.success("".concat(n.name," is on.")),C()},onError:e=>{o.Am.error("Failed to enable ".concat(n.name,": ").concat(e.message))}});(0,i.useEffect)(()=>{let e=!1;return t&&(async()=>{e||(F(!0),_(void 0));try{let t=await (0,x.R)({projectRef:null==Z?void 0:Z.ref,connectionString:null==Z?void 0:Z.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(n.name,"'")});e||_(t.result[0].schema)}catch(e){}F(!1)})(),()=>{e=!0}},[t,n.name]);let A=async e=>{if(void 0===Z)return console.error("Project is required");let t=null!=E?E:"custom"===e.schema?e.name:e.schema;P({projectRef:Z.ref,connectionString:null==Z?void 0:Z.connectionString,schema:t,name:n.name,version:n.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,s.jsx)(h.Z,{hideFooter:!0,visible:t,onCancel:C,size:"small",header:(0,s.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,s.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,s.jsx)("code",{className:"text-xs",children:n.name})]}),"data-sentry-element":"Modal","data-sentry-component":"EnableExtensionModal","data-sentry-source-file":"EnableExtensionModal.tsx",children:(0,s.jsx)(f.Z,{initialValues:{name:n.name,schema:"extensions"},validate:e=>{let t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:A,"data-sentry-element":"Form","data-sentry-source-file":"EnableExtensionModal.tsx",children:e=>{let{values:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.Z.Content,{className:"flex flex-col gap-y-2",children:[k&&S.includes(n.name)&&(0,s.jsxs)(b.J,{type:"default",title:"Extension is limited by OrioleDB",children:[(0,s.jsxs)("span",{className:"block",children:[n.name," cannot be accelerated by indexes on tables that are using the OrioleDB access method"]}),(0,s.jsx)(N.G,{abbrev:!1,className:"mt-2",href:"https://supabase.com/docs"})]}),T||z?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.Z,{}),(0,s.jsx)("div",{className:"w-3/4",children:(0,s.jsx)(d.Z,{})})]}):E?(0,s.jsx)(p.Z,{disabled:!0,id:"schema",name:"schema",value:E,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(E,".")}):(0,s.jsxs)(j.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,s.jsxs)(j.Z.Option,{id:"custom",label:'Create a new schema "'.concat(n.name,'"'),value:"custom",addOnBefore:()=>(0,s.jsx)(a.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',n.name,'"']},"custom"),(0,s.jsx)(h.Z.Separator,{}),null==R?void 0:R.map(e=>(0,s.jsx)(j.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,s.jsx)(r.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})]}),"custom"===t.schema&&(0,s.jsx)(h.Z.Content,{children:(0,s.jsx)(p.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===n.name&&(null==Z?void 0:Z.cloud_provider)==="FLY"&&(0,s.jsx)(h.Z.Content,{children:(0,s.jsxs)(g.bZ,{variant:"warning",children:[(0,s.jsx)(y.aN,{}),(0,s.jsx)(g.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,s.jsx)(g.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,s.jsx)(g.X,{className:"mt-3",children:(0,s.jsx)(v.z,{asChild:!0,type:"default",iconRight:(0,s.jsx)(l.Z,{width:12,height:12}),children:(0,s.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("span",{children:"Learn more"})})})})]})}),(0,s.jsx)(h.Z.Separator,{}),(0,s.jsxs)(h.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,s.jsx)(v.z,{type:"default",disabled:I,onClick:()=>C(),children:"Cancel"}),(0,s.jsx)(v.z,{htmlType:"submit",disabled:I,loading:I,children:"Enable extension"})]})]})}})})}},44165:function(e,t,n){n.d(t,{Z:function(){return F}});var s=n(97458),a=n(198),r=n(70437),l=n(45553),i=n(32605),o=n(76225),c=n(37669),d=n.n(c),u=n(52983),m=n(34549),x=n(20170),h=n(36457),f=n(64618),p=n(61250),j=n(91605);async function g(e){let{projectRef:t,connectionString:n,id:s}=e,a=new Headers;n&&a.set("x-connection-encrypted",n);let{data:r,error:l}=await (0,p.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t},query:{id:s}},headers:a});return l&&(0,p.S3)(l),r}let y=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,h.NL)();return(0,f.D)(e=>g(e),{async onSuccess(t,n,a){let{projectRef:r}=n;await s.invalidateQueries(j.o.list(r)),await (null==e?void 0:e(t,n,a))},async onError(e,n,s){void 0===t?m.Am.error("Failed to disable database extension: ".concat(e.message)):t(e,n,s)},...n})};var v=n(87790),b=n(51735),N=n(88116),w=n(5546),S=n(82445),C=n(16787),Z=n(19168),k=n(61911),E=n(587),_=n(85760),T=n(23220),F=e=>{var t,n,c,h,f;let{extension:p}=e,{project:j}=(0,x.d2)(),g=null!==p.installed_version,F=(0,b.Qv)(),[R,z]=(0,u.useState)(!1),[P,I]=(0,u.useState)(!1),A=(0,v.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),L=F&&"orioledb"===p.name,D=!A||L,B="px-5",W=N.Rw.find(e=>e.name===p.name),O=(null==W?void 0:W.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null===(t=N.Rw.find(e=>e.name===p.name))||void 0===t?void 0:t.link):null!==(c=null===(n=N.Rw.find(e=>e.name===p.name))||void 0===n?void 0:n.link)&&void 0!==c?c:void 0,{mutate:q,isLoading:M}=y({onSuccess:()=>{m.Am.success("".concat(p.name," is off.")),z(!1)}}),V=()=>{if(void 0===j)return console.error("Project is required");q({projectRef:j.ref,connectionString:j.connectionString,id:p.name})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-surface-100 border border-overlay flex flex-col overflow-hidden rounded shadow-sm",children:[(0,s.jsxs)("div",{className:(0,w.cn)("border-b border-overlay flex justify-between w-full py-3",B),children:[(0,s.jsxs)("div",{className:"max-w-[85%] flex items-center space-x-3 truncate",children:[(0,s.jsx)("h3",{title:p.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:p.name}),(0,s.jsx)("p",{className:"text-sm text-foreground-light font-mono tracking-tighter",children:null!==(h=null==p?void 0:p.installed_version)&&void 0!==h?h:p.default_version})]}),M?(0,s.jsx)(r.Z,{className:"animate-spin",size:16}):(0,s.jsxs)(S.u,{children:[(0,s.jsx)(S.aJ,{children:(0,s.jsx)(C.r,{disabled:D,checked:g,onCheckedChange:()=>g?z(!0):I(!0)})}),D&&(0,s.jsx)(S._v,{side:"bottom",children:A?L?"Project is using OrioleDB and cannot be disabled":null:"You need additional permissions to toggle extensions"})]})]}),g&&(0,s.jsx)("div",{className:(0,w.cn)("border-b border-overlay py-2",B),children:(0,s.jsxs)("p",{className:"text-foreground-light text-sm",children:["Installed in ",(0,s.jsx)("span",{className:"text-foreground",children:p.schema})," schema"]})}),(0,s.jsxs)("div",{className:(0,w.cn)("flex h-full flex-col gap-y-3 py-3",B),children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:p.comment}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(null==W?void 0:W.github_url)&&(0,s.jsx)(Z.z,{asChild:!0,type:"default",icon:(0,s.jsx)(l.Z,{}),className:"rounded-full",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:W.github_url,className:"font-mono tracking-tighter",children:W.github_url.split("/").slice(-2).join("/")})}),void 0!==O&&(0,s.jsx)(Z.z,{asChild:!0,type:"default",icon:(0,s.jsx)(i.Z,{}),className:"rounded-full",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",className:"font-mono tracking-tighter",href:O,children:"Docs"})})]})]}),(null==W?void 0:W.product)&&(0,s.jsxs)("div",{className:(0,w.cn)("border-t border-overlay py-3 flex items-center gap-x-3",B),children:[(0,s.jsx)("div",{className:"min-w-5 w-5 h-5 border border-brand/50 rounded flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"text-brand",size:12})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:[(0,s.jsx)("span",{className:"text-foreground",children:p.name})," is used by"," ",W.product_url?(0,s.jsx)(d(),{href:W.product_url.replace("{ref}",null!==(f=null==j?void 0:j.ref)&&void 0!==f?f:""),className:"transition hover:text-foreground",children:W.product}):W.product]}),!g&&(0,s.jsxs)("p",{className:"text-foreground-lighter text-xs",children:["Install extension to use ",W.product]})]})]})]}),(0,s.jsx)(_.Z,{visible:P,extension:p,onCancel:()=>I(!1),"data-sentry-element":"EnableExtensionModal","data-sentry-source-file":"ExtensionCard.tsx"}),(0,s.jsx)(E.Z,{visible:R,title:"Confirm to disable extension",confirmLabel:"Disable",variant:"destructive",confirmLabelLoading:"Disabling",onCancel:()=>z(!1),onConfirm:()=>V(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"ExtensionCard.tsx",children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',p.name,'" extension?']}),T.FL[p.name]&&(0,s.jsx)(k.J,{type:"warning",className:"m-0",children:T.FL[p.name]})]})})]})}},69019:function(e,t,n){n.d(t,{Z:function(){return p}});var s=n(97458),a=n(53995),r=n(17221),l=n(73362),i=n(71292),o=n(34493),c=n(51735),d=n(23385),u=n(85394),m=n(77946),x=n(68056);let h=(e,t)=>{var n;let a=null!==(n=null==e?void 0:e.ref)&&void 0!==n?n:"default",{pgNetExtensionExists:r,pitrEnabled:l,columnLevelPrivileges:i}=t||{};return[{title:"Database Management",items:[{name:"Schema Visualizer",key:"schemas",url:"/project/".concat(a,"/database/schemas"),items:[]},{name:"Tables",key:"tables",url:"/project/".concat(a,"/database/tables"),items:[]},{name:"Functions",key:"functions",url:"/project/".concat(a,"/database/functions"),items:[]},{name:"Triggers",key:"triggers",url:"/project/".concat(a,"/database/triggers"),items:[]},{name:"Enumerated Types",key:"types",url:"/project/".concat(a,"/database/types"),items:[]},{name:"Extensions",key:"extensions",url:"/project/".concat(a,"/database/extensions"),items:[]},{name:"Indexes",key:"indexes",url:"/project/".concat(a,"/database/indexes"),items:[]},{name:"Publications",key:"publications",url:"/project/".concat(a,"/database/publications"),items:[]}]},{title:"Access Control",items:[{name:"Roles",key:"roles",url:"/project/".concat(a,"/database/roles"),items:[]},...i?[{name:"Column Privileges",key:"column-privileges",url:"/project/".concat(a,"/database/column-privileges"),items:[],label:"ALPHA"}]:[],{name:"Policies",key:"policies",url:"/project/".concat(a,"/auth/policies"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]},{title:"Platform",items:[...m.Qy?[{name:"Backups",key:"backups",url:l?"/project/".concat(a,"/database/backups/pitr"):"/project/".concat(a,"/database/backups/scheduled"),items:[]}]:[],{name:"Migrations",key:"migrations",url:"/project/".concat(a,"/database/migrations"),items:[]},{name:"Wrappers",key:"wrappers",url:"/project/".concat(a,"/integrations?category=wrapper"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},...r?[{name:"Webhooks",key:"hooks",url:"/project/".concat(a,"/integrations/webhooks/overview"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]:[]]},{title:"Tools",items:[{name:"Security Advisor",key:"security-advisor",url:"/project/".concat(a,"/advisors/security"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},{name:"Performance Advisor",key:"performance-advisor",url:"/project/".concat(a,"/advisors/performance"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(a,"/advisors/query-performance"),rightIcon:(0,s.jsx)(x.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]}]},f=()=>{let e=(0,c.Vm)(),t=(0,a.useRouter)().pathname.split("/")[4],{data:n}=(0,i.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:d}=(0,o.F)({projectRef:null==e?void 0:e.ref}),u=void 0!==(null!=n?n:[]).find(e=>"pg_net"===e.name),m=(null==d?void 0:d.selected_addons.find(e=>"pitr"===e.type))!==void 0,x=(0,r.ar)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.Q,{page:t,menu:h(e,{pgNetExtensionExists:u,pitrEnabled:m,columnLevelPrivileges:x}),"data-sentry-element":"ProductMenu","data-sentry-source-file":"DatabaseLayout.tsx"})})};var p=(0,d.Q)(e=>{let{children:t}=e;return(0,s.jsx)(u.Z,{product:"Database",productMenu:(0,s.jsx)(f,{}),isBlocking:!1,"data-sentry-element":"ProjectLayout","data-sentry-component":"DatabaseLayout","data-sentry-source-file":"DatabaseLayout.tsx",children:t})})},7004:function(e,t,n){n.d(t,{CG:function(){return f},FW:function(){return u},I7:function(){return x},Lc:function(){return j},Wv:function(){return y},_S:function(){return m},g$:function(){return p},gW:function(){return b},jX:function(){return h},q7:function(){return d},s_:function(){return o},tM:function(){return g},tU:function(){return c},ur:function(){return v},y:function(){return i}});var s=n(97458),a=n(52983),r=n(70559),l=n(5546);let i="mx-auto w-full max-w-[1200px]",o="px-4 md:px-6 lg:px-14 xl:px-24 2xl:px-28",c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("header",{...a,ref:t,className:(0,l.cn)("w-full","flex-col gap-3 py-6",n)})}),d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("h1",{ref:t,...a,className:(0,l.cn)("text-2xl",n)})}),u=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("span",{ref:t,...a,className:(0,l.cn)("text-sm text-foreground-light",n)})}),m=a.forwardRef((e,t)=>{let{className:n,bottomPadding:a,...c}=e,{aiAssistantPanel:d}=(0,r.WZ)(),{open:u}=d;return(0,s.jsx)("div",{ref:t,...c,className:(0,l.cn)(i,o,a&&"pb-16",u?"xl:px-6":"",n)})}),x=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("w-full h-px bg-border",n)})}),h=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("flex flex-col gap-3 py-6","lg:grid md:grid-cols-12 lg:py-12",n)})}),f=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("flex flex-col gap-3","min-w-[420px]",n)})}),p=a.forwardRef((e,t)=>{let{className:n,children:a,title:r,...i}=e;return(0,s.jsxs)("div",{ref:t,...i,className:(0,l.cn)("col-span-4 xl:col-span-5 prose text-sm",n),children:[r&&(0,s.jsx)("h2",{children:r}),a]})}),j=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("col-span-8 xl:col-span-7","flex flex-col gap-6",n)})}),g=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("flex flex-col gap-3 items-center",n)})}),y=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("flex w-full items-center",n)})}),v=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)("flex flex-row gap-3",n)})}),b=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)("div",{ref:t,...a,className:(0,l.cn)(i,o,"my-8 flex flex-col gap-8",n)})});c.displayName="ScaffoldHeader",d.displayName="ScaffoldTitle",u.displayName="ScaffoldDescription",m.displayName="ScaffoldContainer",x.displayName="ScaffoldDivider",h.displayName="ScaffoldSection",f.displayName="ScaffoldColumn",p.displayName="ScaffoldSectionDetail",j.displayName="ScaffoldSectionContent",g.displayName="ScaffoldFilterAndContent",y.displayName="ScaffoldActionsContainer",v.displayName="ScaffoldActionsGroup",b.displayName="ScaffoldContainerLegacy"},2207:function(e,t,n){var s=n(97458),a=n(50588),r=n(77946);t.Z=()=>(0,s.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center","data-sentry-component":"NoSearchResults","data-sentry-source-file":"NoSearchResults.tsx",children:[(0,s.jsx)(a.Z,{src:"".concat(r.GW,"/img/no-search-results.svg"),preProcessor:e=>e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"'),"data-sentry-element":"SVG","data-sentry-source-file":"NoSearchResults.tsx"}),(0,s.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that match your query."})]})},50060:function(e,t,n){n.d(t,{i:function(){return r}});var s=n(97458),a=n(19168);let r=e=>{let{form:t,hasChanges:n,handleReset:r,helper:l,disabled:i=!1,isSubmitting:o,submitText:c="Save"}=e,d=o||i||!n&&void 0!==n;return(0,s.jsxs)("div",{className:["flex w-full items-center gap-2",l?"justify-between":"justify-end"].join(" "),"data-sentry-component":"FormActions","data-sentry-source-file":"FormActions.tsx",children:[l&&(0,s.jsx)("span",{className:"text-sm text-foreground-lighter",children:l}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.z,{disabled:d,type:"default",htmlType:"reset",onClick:()=>r(),"data-sentry-element":"Button","data-sentry-source-file":"FormActions.tsx",children:"Cancel"}),(0,s.jsx)(a.z,{form:t,type:"primary",htmlType:"submit",disabled:d,loading:o,"data-sentry-element":"Button","data-sentry-source-file":"FormActions.tsx",children:c})]})]})}},21371:function(e,t,n){var s=n(97458),a=n(5546),r=n(19168);t.Z=e=>{let{searchString:t,onResetFilter:n,className:l}=e;return(0,s.jsxs)("div",{className:(0,a.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",l),"data-sentry-component":"NoSearchResults","data-sentry-source-file":"NoSearchResults.tsx",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==n&&(0,s.jsx)(r.z,{type:"default",onClick:()=>n(),children:"Reset filter"})]})}},69735:function(e,t,n){var s=n(97458),a=n(37669),r=n.n(a),l=n(90537),i=n(28436),o=n(19168);t.Z=e=>{let{name:t="",isActive:n,isExternal:a,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:x,textClassName:h="",hoverText:f="",label:p}=e,j=(0,s.jsx)(l.ZP.Item,{icon:c,rounded:!0,active:n,onClick:x,children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,s.jsxs)("div",{title:f||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+h,children:[(0,s.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==p&&(0,s.jsx)(i.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:p})]}),d&&(0,s.jsx)("div",{children:d})]})});return u?a?(0,s.jsx)(o.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,s.jsx)(r(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,s.jsx)(r(),{href:u,className:"block",target:m,children:j}):j}},26781:function(e,t,n){var s=n(97458),a=n(1662),r=n(45196),l=n(81449),i=n(52983),o=n(198),c=n(20170),d=n(94784),u=n(87790),m=n(19168),x=n(71904),h=n(41341),f=n(88587),p=n(89861);t.Z=e=>{let{className:t,disabled:n=!1,size:j="tiny",showError:g=!0,selectedSchemaName:y,supportSelectAll:v=!1,excludedSchemas:b=[],onSelectSchema:N,onSelectCreateSchema:w}=e,[S,C]=(0,i.useState)(!1),Z=(0,u.Xo)(o.KA.TENANT_SQL_ADMIN_WRITE,"schemas"),{project:k}=(0,c.d2)(),{data:E,isLoading:_,isSuccess:T,isError:F,error:R,refetch:z}=(0,d.Q1)({projectRef:null==k?void 0:k.ref,connectionString:null==k?void 0:k.connectionString}),P=(E||[]).filter(e=>!b.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name));return(0,s.jsxs)("div",{className:t,"data-sentry-component":"SchemaSelector","data-sentry-source-file":"SchemaSelector.tsx",children:[_&&(0,s.jsx)(m.z,{type:"default",className:"justify-start",block:!0,size:j,loading:!0,children:"Loading schemas..."}),g&&F&&(0,s.jsxs)(x.bZ,{variant:"warning",className:"!px-3 !py-3",children:[(0,s.jsx)(x.Cd,{className:"text-xs text-amber-900",children:"Failed to load schemas"}),(0,s.jsxs)(x.X,{className:"text-xs mb-2 break-words",children:["Error: ",null==R?void 0:R.message]}),(0,s.jsx)(m.z,{type:"default",size:"tiny",onClick:()=>z(),children:"Reload schemas"})]}),T&&(0,s.jsxs)(h.J2,{open:S,onOpenChange:C,modal:!1,children:[(0,s.jsx)(h.xo,{asChild:!0,children:(0,s.jsx)(m.z,{size:j,disabled:n,type:"default",className:"w-full [&>span]:w-full",iconRight:(0,s.jsx)(a.Z,{className:"text-foreground-muted",strokeWidth:2,size:14}),children:y?(0,s.jsxs)("div",{className:"w-full flex gap-1",children:[(0,s.jsx)("p",{className:"text-foreground-lighter",children:"schema:"}),(0,s.jsx)("p",{className:"text-foreground",children:"*"===y?"All schemas":y})]}):(0,s.jsx)("div",{className:"w-full flex gap-1",children:(0,s.jsx)("p",{className:"text-foreground-lighter",children:"Choose a schema"})})})}),(0,s.jsx)(h.yk,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,s.jsxs)(f.mY,{children:[(0,s.jsx)(f.sZ,{placeholder:"Find schema..."}),(0,s.jsxs)(f.e8,{children:[(0,s.jsx)(f.rb,{children:"No schemas found"}),(0,s.jsx)(f.fu,{children:(0,s.jsxs)(p.x,{className:(P||[]).length>7?"h-[210px]":"",children:[v&&(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N("*"),C(!1)},onClick:()=>{N("*"),C(!1)},children:[(0,s.jsx)("span",{children:"All schemas"}),"*"===y&&(0,s.jsx)(r.Z,{className:"text-brand",strokeWidth:2,size:16})]},"select-all"),null==P?void 0:P.map(e=>(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{N(e.name),C(!1)},onClick:()=>{N(e.name),C(!1)},children:[(0,s.jsx)("span",{children:e.name}),y===e.name&&(0,s.jsx)(r.Z,{className:"text-brand",strokeWidth:2,size:16})]},e.id))]})}),void 0!==w&&Z&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.zz,{}),(0,s.jsx)(f.fu,{children:(0,s.jsxs)(f.di,{className:"cursor-pointer flex items-center gap-x-2 w-full",onSelect:()=>{w(),C(!1)},onClick:()=>{w(),C(!1)},children:[(0,s.jsx)(l.Z,{size:12}),"Create a new schema"]})})]})]})]})})]})]})}},59262:function(e,t,n){var s=n(97458),a=n(5546);t.Z=e=>{let{max:t=100,value:n=0,barClass:r="bg-foreground",bgClass:l="",type:i="vertical",borderClass:o="",labelBottom:c="",labelBottomClass:d="tabular-nums",labelTop:u="",labelTopClass:m=""}=e;if("horizontal"===i){let e=Number(n/t*100),i=c||u;return(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[i&&(0,s.jsxs)("div",{className:"flex align-baseline justify-between pb-1 space-x-8",children:[(0,s.jsx)("p",{className:(0,a.cn)("text-foreground text-sm truncate capitalize-sentence",u.length>0&&"max-w-[75%]",d),children:c}),(0,s.jsx)("p",{className:(0,a.cn)("text-foreground-light text-sm",m),children:u})]}),(0,s.jsx)("div",{className:"relative rounded h-1 overflow-hidden w-full border p-0 ".concat(l||"bg-surface-400"," ").concat(o||"border-none"),children:(0,s.jsx)("div",{className:"absolute rounded inset-x-0 bottom-0 h-1 ".concat(r," transition-all"),style:{width:"".concat(e,"%")}})})]})}{let e=Number(n/t*35);return e<2&&(e=2),(0,s.jsx)("div",{className:"relative rounded w-5 overflow-hidden border p-1 ".concat(l||"bg-gray-400"," ").concat(o||"border-none"),style:{height:35},children:(0,s.jsx)("div",{className:"absolute inset-x-0 bottom-0 w-5 ".concat(r),style:{height:e}})})}}},45756:function(e,t,n){var s=n(97458),a=n(53995),r=n(27614);t.Z=e=>{let{message:t}=e,n=(0,a.useRouter)(),{ref:l}=n.query;return(0,s.jsx)(r.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{n.push("/project/".concat(l,"/editor"))},"data-sentry-element":"ProductEmptyState","data-sentry-component":"NoTableState","data-sentry-source-file":"NoTableState.tsx",children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},48653:function(e,t,n){var s=n(97458),a=n(99517);n(52983);var r=n(82188);let l=e=>{let{open:t,children:n,className:r,...l}=e;return(0,s.jsx)(a.fC,{asChild:l.asChild,defaultOpen:l.defaultOpen,open:t,onOpenChange:l.onOpenChange,disabled:l.disabled,className:r,"data-sentry-element":"unknown","data-sentry-component":"Collapsible","data-sentry-source-file":"Collapsible.tsx",children:n})};l.Trigger=function(e){let{children:t,asChild:n}=e;return(0,s.jsx)(a.xz,{asChild:n,"data-sentry-element":"unknown","data-sentry-component":"Trigger","data-sentry-source-file":"Collapsible.tsx",children:t})},l.Content=function(e){let{asChild:t,children:n,className:l}=e,i=(0,r.Z)("collapsible");return(0,s.jsx)(a.VY,{asChild:t,className:[i.content,l].join(" "),"data-sentry-element":"unknown","data-sentry-component":"Content","data-sentry-source-file":"Collapsible.tsx",children:n})},t.ZP=l}}]);