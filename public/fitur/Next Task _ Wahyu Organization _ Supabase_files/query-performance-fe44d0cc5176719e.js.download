!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f78ca7b0-25a6-4c25-9ae7-38f54eb9aeab",e._sentryDebugIdIdentifier="sentry-dbid-f78ca7b0-25a6-4c25-9ae7-38f54eb9aeab")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9173],{942:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/advisors/query-performance",function(){return n(66903)}])},59905:function(e,t,n){"use strict";n.d(t,{V$:function(){return o},cr:function(){return d},j5:function(){return l},sU:function(){return i}});var s=n(28977),r=n.n(s),a=n(92081);let o=24,i=[{text:"Last 24 hours",calcFrom:()=>r()().subtract(1,"day").startOf("day").toISOString(),calcTo:()=>"",default:!0},{text:"Last 7 days",calcFrom:()=>r()().subtract(7,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 14 days",calcFrom:()=>r()().subtract(14,"day").startOf("day").toISOString(),calcTo:()=>""},{text:"Last 30 days",calcFrom:()=>r()().subtract(30,"day").startOf("day").toISOString(),calcTo:()=>""}],l={iso_timestamp_start:i[0].calcFrom(),iso_timestamp_end:i[0].calcTo()},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(0===e.length)return"";let n=e.map(e=>{let t=e.key.split("."),n=[t[t.length-2],t[t.length-1]].join("."),s=e.key.includes(".")?n:e.key;return"matches"===e.compare?"REGEXP_CONTAINS(".concat(s,", '").concat(e.value,"')"):"is"===e.compare?"".concat(s," = ").concat(e.value):void 0}).join(" AND ");return t?"WHERE "+n:"AND "+n},d={[a.s.API]:{title:"API",queries:{totalRequests:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC")},topRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},errorCounts:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          count(t.id) as count\n        FROM edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        WHERE\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")},topErrorRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        where\n          response.status_code >= 400\n        ".concat(c(e,!1),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          count desc\n        limit 10\n        ")},responseSpeed:{queryType:"logs",sql:e=>"\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          avg(response.origin_time) as avg\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          ".concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n      ")},topSlowRoutes:{queryType:"logs",sql:e=>"\n        select\n          request.path as path,\n          request.method as method,\n          request.search as search,\n          response.status_code as status_code,\n          count(t.id) as count,\n          avg(response.origin_time) as avg\n        from edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n        ".concat(c(e),"\n        group by\n          request.path, request.method, request.search, response.status_code\n        order by\n          avg desc\n        limit 10\n        ")},networkTraffic:{queryType:"logs",sql:e=>'\n        select\n          cast(timestamp_trunc(t.timestamp, hour) as datetime) as timestamp,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as ingress_mb,\n          coalesce(\n            safe_divide(\n              sum(\n                cast(coalesce(resp_headers.content_length, "0") as int64)\n              ),\n              1000000\n            ),\n            0\n          ) as egress_mb,\n        FROM\n          edge_logs t\n          cross join unnest(metadata) as m\n          cross join unnest(m.response) as response\n          cross join unnest(m.request) as request\n          cross join unnest(request.headers) as headers\n          cross join unnest(response.headers) as resp_headers\n          '.concat(c(e),"\n        GROUP BY\n          timestamp\n        ORDER BY\n          timestamp ASC\n        ")}}},[a.s.AUTH]:{title:"",queries:{}},[a.s.STORAGE]:{title:"Storage",queries:{cacheHitRate:{queryType:"logs",sql:e=>"\n-- cache-hit-rate\nSELECT\n  timestamp_trunc(timestamp, hour) as timestamp,\n  countif( h.cf_cache_status in ('HIT', 'STALE', 'REVALIDATED', 'UPDATING') ) as hit_count,\n  countif( h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC') ) as miss_count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') and r.method = 'GET'\ngroup by timestamp\norder by timestamp desc\n"},topCacheMisses:{queryType:"logs",sql:e=>"\n-- top-cache-misses\nSELECT\n  r.path as path,\n  r.search as search,\n  count(id) as count\nfrom edge_logs f\n  cross join unnest(f.metadata) as m\n  cross join unnest(m.request) as r\n  cross join unnest(m.response) as res\n  cross join unnest(res.headers) as h\nwhere starts_with(r.path, '/storage/v1/object') \n  and r.method = 'GET'\n  and h.cf_cache_status in ('MISS', 'NONE/UNKNOWN', 'EXPIRED', 'BYPASS', 'DYNAMIC')\ngroup by path, search\norder by count desc\nlimit 12\n    "}}},[a.s.QUERY_PERFORMANCE]:{title:"Query performance",queries:{mostFrequentlyInvoked:{queryType:"db",sql:(e,t,n)=>"\n-- Most frequently called queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by statements.calls desc","\n  limit 20;")},mostTimeConsuming:{queryType:"db",sql:(e,t,n)=>"\n-- Most time consuming queries\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) OVER()) * 100, 'FM90D0') || '%'  AS prop_total_time\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by total_time desc","\n  limit 20;")},slowestExecutionTime:{queryType:"db",sql:(e,t,n)=>"\n-- Slowest queries by max execution time\nset search_path to public, extensions;\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  ".concat(t||"","\n  ").concat(n||"order by max_time desc","\n  limit 20")},queryHitRate:{queryType:"db",sql:e=>"-- Cache and index hit rate\nselect\n    'index hit rate' as name,\n    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio\n  from pg_statio_user_indexes\n  union all\n  select\n    'table hit rate' as name,\n    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio\n  from pg_statio_user_tables;"}}},[a.s.DATABASE]:{title:"database",queries:{largeObjects:{queryType:"db",sql:e=>"SELECT \n        SCHEMA_NAME,\n        relname,\n        table_size\n      FROM\n        (SELECT \n          pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,\n          relname,\n          pg_total_relation_size(pg_catalog.pg_class.oid) AS table_size\n        FROM pg_catalog.pg_class\n        JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid\n        ) t\n      WHERE SCHEMA_NAME NOT LIKE 'pg_%'\n      ORDER BY table_size DESC\n      LIMIT 5;"}}}}},92081:function(e,t,n){"use strict";var s,r;n.d(t,{s:function(){return s}}),(r=s||(s={})).API="api",r.STORAGE="storage",r.AUTH="auth",r.QUERY_PERFORMANCE="query_performance",r.DATABASE="database"},73362:function(e,t,n){"use strict";n.d(t,{Q:function(){return i}});var s=n(97458),r=n(90537),a=n(28436),o=n(69735),i=e=>{let{page:t,menu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto","data-sentry-component":"ProductMenu","data-sentry-source-file":"ProductMenu.tsx",children:(0,s.jsx)(r.ZP,{type:"pills","data-sentry-element":"Menu","data-sentry-source-file":"ProductMenu.tsx",children:n.map((e,i)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"my-6 space-y-8",children:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(r.ZP.Group,{title:e.title?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,s.jsx)("span",{children:e.title}),e.isPreview&&(0,s.jsx)(a.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,s.jsx)("div",{children:e.items.map(e=>(0,s.jsx)(o.Z,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),i!==n.length-1&&(0,s.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},16323:function(e,t,n){"use strict";n.d(t,{k:function(){return d}});var s=n(36457),r=n(64618),a=n(34549),o=n(61250),i=n(29020),l=n(91605);async function c(e){let{projectRef:t,connectionString:n,schema:s,name:r,version:a,cascade:l=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,i.R)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(s)})}catch(e){throw e}let{data:u,error:m}=await (0,o.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:s,name:r,version:a,cascade:l},headers:d});return m&&(0,o.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,s.NL)();return(0,r.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:r}=n;await o.invalidateQueries(l.o.list(r)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?a.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},71292:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var s=n(28894),r=n(61250),a=n(91605),o=n(51735),i=n(77946);async function l(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let a=new Headers;s&&a.set("x-connection-encrypted",s);let{data:o,error:i}=await (0,r.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:a,signal:t});return i&&(0,r.S3)(i),o}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=(0,o.Vm)(),u=(null==d?void 0:d.status)===i.S.ACTIVE_HEALTHY;return(0,s.a)(a.o.list(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:r&&void 0!==t&&u,...c})}},30863:function(e,t,n){"use strict";n.d(t,{fA:function(){return d},x4:function(){return c}});var s=n(95199),r=n(28894),a=n(29020);let o=e=>["projects",e,"database-roles"],i=s.Z.roles.list();async function l(e,t){let{projectRef:n,connectionString:s}=e,{result:r}=await (0,a.R)({projectRef:n,connectionString:s,sql:i.sql,queryKey:["database-roles"]},t);return r}let c=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.a)(o(t),e=>{let{signal:s}=e;return l({projectRef:t,connectionString:n},s)},{enabled:s&&void 0!==t,...a})};function d(e,t){return e.invalidateQueries(o(t))}},24544:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(67634).Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]])},17542:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(67634).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},77733:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(67634).Z)("Table2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]])},42613:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(67634).Z)("TextSearch",[["path",{d:"M21 6H3",key:"1jwq7v"}],["path",{d:"M10 12H3",key:"1ulcyk"}],["path",{d:"M10 18H3",key:"13769t"}],["circle",{cx:"17",cy:"15",r:"3",key:"1upz2a"}],["path",{d:"m21 19-1.9-1.9",key:"dwi7p8"}]])},80954:function(e,t,n){"use strict";n.d(t,{H:function(){return o},u:function(){return a}});var s=n(32987),r=n(98453);let a=e=>Object.fromEntries(new URLSearchParams(e)),o=(e,t)=>Object.entries(e).reduce((e,n)=>{let[a,{sql:o,queryType:i}]=n;return"db"===i?{...e,[a]:()=>(0,s.Z)({sql:o})}:{...e,[a]:()=>(0,r.Z)(t)}},{})},94502:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(97458),r=n(53995),a=n(73362),o=n(51735),i=n(23385),l=n(85394);let c=e=>{var t;let n=null!==(t=null==e?void 0:e.ref)&&void 0!==t?t:"default";return[{title:"Advisors",items:[{name:"Security Advisor",key:"security",url:"/project/".concat(n,"/advisors/security"),items:[]},{name:"Performance Advisor",key:"performance",url:"/project/".concat(n,"/advisors/performance"),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(n,"/advisors/query-performance"),items:[]}]}]};var d=(0,i.Q)(e=>{let{children:t}=e,n=(0,o.Vm)(),i=(0,r.useRouter)().pathname.split("/")[4];return(0,s.jsx)(l.Z,{isLoading:!1,product:"Advisors",productMenu:(0,s.jsx)(a.Q,{page:i,menu:c(n)}),"data-sentry-element":"ProjectLayout","data-sentry-component":"AdvisorsLayout","data-sentry-source-file":"AdvisorsLayout.tsx",children:t})})},97705:function(e,t,n){"use strict";n.d(t,{E:function(){return u}});var s=n(97458),r=n(52983),a=n(41341),o=n(19168),i=n(89861),l=n(65497),c=n(27037),d=n(5546);let u=e=>{let{title:t,options:n=[],activeOptions:u=[],valueKey:m,labelKey:p,iconKey:x="icon",name:h="default",variant:f="rectangular",buttonType:y,disabled:g,labelClass:v,maxHeightClass:j="h-[205px]",clearButtonText:_="Clear",onSaveFilters:b}=e,[N,w]=(0,r.useState)(!1),[E,q]=(0,r.useState)([]),S=u.map(e=>{let t=n.find(t=>t[m]===e);return t&&t[p]?t[p]:""});return(0,r.useEffect)(()=>{!N&&u.length>0&&q(u)},[N,u]),(0,s.jsxs)(a.J2,{open:N,onOpenChange:w,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"FilterPopover","data-sentry-source-file":"FilterPopover.tsx",children:[(0,s.jsx)(a.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:(0,s.jsx)(o.z,{asChild:!0,disabled:g,type:null!=y?y:u.length>0?"default":"dashed",onClick:()=>w(!1),className:"rounded"===f?"rounded-full":"","data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:h}),u.length>0&&(0,s.jsx)("span",{className:"mr-1",children:":"}),u.length>=3?(0,s.jsxs)("span",{children:[S[0]," and ",u.length-1," others"]}):u.length>0?(0,s.jsx)("span",{children:S.join(", ")}):null]})})}),(0,s.jsxs)(a.yk,{className:"p-0 w-44",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"FilterPopover.tsx",children:[(0,s.jsx)("div",{className:"border-b border-overlay bg-surface-200 rounded-t pb-1 px-3",children:(0,s.jsx)("span",{className:"text-xs text-foreground-light",children:null!=t?t:"Select ".concat(h.toLowerCase())})}),(0,s.jsx)(i.x,{className:n.length>7?j:"","data-sentry-element":"ScrollArea","data-sentry-source-file":"FilterPopover.tsx",children:(0,s.jsx)("div",{className:"p-3 flex flex-col gap-y-2",children:n.map(e=>{let t=e[m],n=x?e[x]:void 0;return(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(l.X,{id:t,checked:E.includes(t),onCheckedChange:()=>{E.includes(t)?q(E.filter(e=>e!==t)):q(E.concat(t))}}),(0,s.jsxs)(c._,{htmlFor:e[m],className:(0,d.cn)("flex items-center gap-x-2",v),children:[n&&(0,s.jsx)("img",{src:n,alt:e[p],className:(0,d.cn)("w-4 h-4",e.iconClass)}),(0,s.jsx)("span",{children:e[p]})]})]},t)})})}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,s.jsx)(o.z,{size:"tiny",type:"default",onClick:()=>{b([]),q([]),w(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:_}),(0,s.jsx)(o.z,{type:"primary",onClick:()=>{let e=n.map(e=>e[m]);b(E.sort((t,n)=>e.indexOf(t)-e.indexOf(n))),w(!1)},"data-sentry-element":"Button","data-sentry-source-file":"FilterPopover.tsx",children:"Save"})]})]})]})}},8504:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});var s=n(97458),r=n(5546),a=n(26655);let o=e=>{let{title:t,description:n,docsUrl:o,actions:i,className:l}=e;return(0,s.jsxs)("div",{className:(0,r.cn)("mb-6 flex items-center justify-between gap-x-4 ".concat(l)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),n&&(0,s.jsx)("div",{className:"prose text-sm max-w-full",children:n})]}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==o&&(0,s.jsx)(a.G,{href:o}),i]})]})}},69735:function(e,t,n){"use strict";var s=n(97458),r=n(37669),a=n.n(r),o=n(90537),i=n(28436),l=n(19168);t.Z=e=>{let{name:t="",isActive:n,isExternal:r,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:p,textClassName:x="",hoverText:h="",label:f}=e,y=(0,s.jsx)(o.ZP.Item,{icon:c,rounded:!0,active:n,onClick:p,children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,s.jsxs)("div",{title:h||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+x,children:[(0,s.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,s.jsx)(i.C,{variant:"warning",className:"py-0 px-1.5 capitalize",children:f})]}),d&&(0,s.jsx)("div",{children:d})]})});return u?r?(0,s.jsx)(l.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,s.jsx)(a(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,s.jsx)(a(),{href:u,className:"block",target:m,children:y}):y}},32987:function(e,t,n){"use strict";var s=n(28894),r=n(59905),a=n(20170),o=n(80887),i=n(29020),l=n(82689);t.Z=e=>{var t;let{sql:n,params:c=r.j5,where:d,orderBy:u}=e,{project:m}=(0,a.d2)(),p=(0,l.TF)(),{data:x}=(0,o.bN)({projectRef:null==m?void 0:m.ref}),h=null===(t=(x||[]).find(e=>e.identifier===p.selectedDatabaseId))||void 0===t?void 0:t.connectionString,f=p.selectedDatabaseId,y="function"==typeof n?n([]):n,{data:g,error:v,isLoading:j,isRefetching:_,refetch:b}=(0,s.a)(["projects",null==m?void 0:m.ref,"db",{...c,sql:y,identifier:f},d,u],e=>{let{signal:t}=e;return(0,i.R)({projectRef:null==m?void 0:m.ref,connectionString:h||(null==m?void 0:m.connectionString),sql:y},t).then(e=>e.result)},{enabled:!!y,refetchOnWindowFocus:!1,refetchOnReconnect:!1});return{error:v||("object"==typeof g?null==g?void 0:g.error:""),data:g,isLoading:j,isRefetching:_,params:c,runQuery:b,resolvedSql:y}}},66903:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eb}});var s,r,a=n(97458),o=n(53995),i=n(45925),l=n(37173),c=n(14415),d=n(52983),u=n(34549),m=n(20170),p=n(29020),x=n(36421),h=n(77946),f=n(82689),y=n(23066),g=n(5546),v=n(82445),j=n(19168),_=n(59863),b=n(88586),N=n(42772),w=n(59905),E=n(92081),q=n(32987);let S=e=>{let{preset:t,orderBy:n,searchQuery:s="",roles:r}=e,a=w.cr[E.s.QUERY_PERFORMANCE].queries[t],o=[void 0!==r&&r.length>0?"auth.rolname in (".concat(r.map(e=>"'".concat(e,"'")).join(", "),")"):"",s.length>0?"statements.query ~ '".concat(s,"'"):""].filter(e=>e.length>0).join(" AND "),i=n&&"ORDER BY ".concat(n.column," ").concat(n.order),l=a.sql([],o.length>0?"WHERE ".concat(o):void 0,i);return(0,q.Z)({sql:l,params:void 0,where:o,orderBy:i})};(s=r||(r={})).MOST_TIME_CONSUMING="most_time_consuming",s.MOST_FREQUENT="most_frequent",s.SLOWEST_EXECUTION="slowest_execution";let C={most_time_consuming:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180},{id:"prop_total_time",name:"Time consumed",description:void 0,minWidth:150}],most_frequent:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}],slowest_execution:[{id:"query",name:"Query",description:void 0,minWidth:600},{id:"rolname",name:"Role",description:void 0,minWidth:void 0},{id:"avg_rows",name:"Avg. Rows",description:void 0,minWidth:void 0},{id:"calls",name:"Calls",description:void 0,minWidth:void 0},{id:"max_time",name:"Max time",description:void 0,minWidth:void 0},{id:"mean_time",name:"Mean time",description:void 0,minWidth:void 0},{id:"min_time",name:"Min time",description:void 0,minWidth:void 0},{id:"total_time",name:"Total time",description:"latency",minWidth:180}]};var T=n(51478),R=n(24544),P=n(17542),A=n(97705),I=n(30863),k=n(77518),M=n(41341),O=n(15895);let Q=e=>{let{name:t,value:n="",placeholder:s,rows:r=4,onSaveText:o}=e,[i,l]=(0,d.useState)(!1),[c,u]=(0,d.useState)(n),m=()=>{o(c),l(!1)};return(0,a.jsxs)(M.J2,{open:i,onOpenChange:l,modal:!1,"data-sentry-element":"Popover_Shadcn_","data-sentry-component":"TextSearchPopover","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,a.jsx)(M.xo,{asChild:!0,"data-sentry-element":"PopoverTrigger_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,a.jsx)(j.z,{asChild:!0,type:n.length>0?"default":"dashed",onClick:()=>l(!1),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:(0,a.jsxs)("div",{className:"max-w-[170px]",children:[(0,a.jsx)("span",{children:t}),n.length>0&&(0,a.jsx)("span",{className:"mr-1",children:":"}),(0,a.jsx)("span",{className:"truncate",children:n})]})})}),(0,a.jsxs)(M.yk,{className:"p-0",side:"bottom",align:"start","data-sentry-element":"PopoverContent_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx",children:[(0,a.jsx)("div",{className:"space-y-4 p-3 min-w-[170px]",children:(0,a.jsx)(O.K,{value:c,onChange:e=>u(e.target.value),rows:r,className:"text-xs font-mono tracking-tight",placeholder:null!=s?s:"Search for a query",onKeyDown:e=>{e.metaKey&&"Enter"===e.code&&m()},"data-sentry-element":"TextArea_Shadcn_","data-sentry-source-file":"TextSearchPopover.tsx"})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t border-overlay bg-surface-200 py-2 px-3",children:[(0,a.jsx)(j.z,{size:"tiny",type:"default",onClick:()=>{o(""),u(""),l(!1)},"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Clear"}),(0,a.jsx)(j.z,{type:"primary",onClick:()=>m(),"data-sentry-element":"Button","data-sentry-source-file":"TextSearchPopover.tsx",children:"Apply search"})]})]})]})},F=e=>{let{queryPerformanceQuery:t,onResetReportClick:n}=e,s=(0,o.useRouter)(),{project:r}=(0,m.d2)(),[i]=(0,x.l)(h.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),l=s.query.search?String(s.query.search):"",c=s.query.roles?s.query.roles:[],u=s.query.sort?{column:s.query.sort,order:s.query.order}:void 0,[p,f]=(0,d.useState)(l),[y,g]=(0,d.useState)({roles:"string"==typeof c?[c]:c,query:""}),[v,_]=(0,d.useState)(null!=u?u:{column:"prop_total_time",order:"desc"}),{isLoading:b,isRefetching:N}=t,{data:w,isLoading:E}=(0,I.x4)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),q=(null!=w?w:[]).sort((e,t)=>e.name.localeCompare(t.name)),S=e=>{_({column:"prop_total_time",order:e}),s.push({...s,query:{...s.query,sort:"prop_total_time",order:e}})};return(0,a.jsxs)("div",{className:"flex justify-between items-center","data-sentry-component":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)("div",{className:"flex items-center gap-x-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"text-xs prose",children:"Filter by"}),(0,a.jsx)(A.E,{name:"Roles",options:q,labelKey:"name",valueKey:"name",activeOptions:E?[]:y.roles,onSaveFilters:e=>{g({...y,roles:e}),s.push({...s,query:{...s.query,roles:e}})},"data-sentry-element":"FilterPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,a.jsx)(Q,{name:"Query",value:p,onSaveText:e=>{if(f(e),e&&"string"==typeof e)s.push({...s,query:{...s.query,search:e}});else{let{search:e,...t}=s.query;s.push({...s,query:{...t}})}},"data-sentry-element":"TextSearchPopover","data-sentry-source-file":"QueryPerformanceFilterBar.tsx"}),(0,a.jsx)("div",{className:"border-r border-strong h-6"}),(0,a.jsxs)(k.h_,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)(k.$F,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,a.jsx)(j.z,{icon:(null==v?void 0:v.order)==="desc"?(0,a.jsx)(T.Z,{}):(0,a.jsx)(R.Z,{}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(null==u?void 0:u.order)==="desc"?"Sorted by latency - high to low":"Sorted by latency - low to high"})}),(0,a.jsx)(k.AW,{className:"w-56","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:(0,a.jsxs)(k._x,{value:null==v?void 0:v.order,onValueChange:e=>S(e),"data-sentry-element":"DropdownMenuRadioGroup","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:[(0,a.jsx)(k.qB,{value:"desc",defaultChecked:(null==v?void 0:v.order)==="desc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - high to low"}),(0,a.jsx)(k.qB,{value:"asc",defaultChecked:(null==v?void 0:v.order)==="asc","data-sentry-element":"DropdownMenuRadioItem","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Sort by latency - low to high"})]})})]})]})}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[!i&&n&&(0,a.jsx)(j.z,{onClick:()=>{n()},type:"default",children:"Reset report"}),(0,a.jsx)(j.z,{type:"default",size:"tiny",onClick:()=>t.runQuery(),disabled:b||N,icon:(0,a.jsx)(P.Z,{size:12,className:"text-foreground-light ".concat(b||N?"animate-spin":"")}),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformanceFilterBar.tsx",children:"Refresh"})]})]})};var L=n(42613),D=n(44914),Z=n(51790),z=n(82558),U=n(71904),W=n(57249);let B=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,g.cn)("flex flex-col gap-y-6 py-4",n),"data-sentry-component":"QueryPanelContainer","data-sentry-source-file":"QueryPanel.tsx",children:t})},H=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,g.cn)("px-5 flex flex-col gap-y-2",n),"data-sentry-component":"QueryPanelSection","data-sentry-source-file":"QueryPanel.tsx",children:t})},G=e=>{let{className:t,name:n,description:s,before:r,after:o,hideArrowMarkers:i=!1}=e;return(0,a.jsxs)("div",{className:(0,g.cn)("py-4 px-4 flex",t),"data-sentry-component":"QueryPanelScoreSection","data-sentry-source-file":"QueryPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex gap-x-2 w-48",children:[(0,a.jsx)("span",{className:"text-sm",children:n}),(0,a.jsxs)(v.u,{"data-sentry-element":"Tooltip_Shadcn_","data-sentry-source-file":"QueryPanel.tsx",children:[(0,a.jsx)(v.aJ,{asChild:!0,className:"mt-1","data-sentry-element":"TooltipTrigger_Shadcn_","data-sentry-source-file":"QueryPanel.tsx",children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light","data-sentry-element":"InformationCircleIcon","data-sentry-source-file":"QueryPanel.tsx"})}),(0,a.jsx)(v._v,{side:"top",className:"w-52 text-center","data-sentry-element":"TooltipContent_Shadcn_","data-sentry-source-file":"QueryPanel.tsx",children:s})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsxs)("div",{className:"flex gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"Currently:"}),(0,a.jsx)("span",{className:(0,g.cn)("font-mono",void 0!==r&&void 0!==o&&r!==o?"text-foreground-light":""),children:r})]}),void 0!==r&&void 0!==o&&r!==o&&(0,a.jsxs)("div",{className:"flex items-center gap-x-2 text-sm",children:[(0,a.jsx)("span",{className:"text-foreground-light w-20",children:"With index:"}),(0,a.jsx)("span",{className:"font-mono",children:o}),void 0!==r&&!i&&(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[o>r?(0,a.jsx)(R.Z,{size:14,className:"text-warning"}):(0,a.jsx)(T.Z,{size:14,className:"text-brand"}),0!==r&&(0,a.jsxs)("span",{className:(0,g.cn)("font-mono tracking-tighter",o>r?"text-warning":"text-brand"),children:[((r-o)/r*100).toFixed(2),"%"]})]})]})]})]})};n(97743);let V=e=>{let{reportType:t,selectedRow:n,onClickViewSuggestion:s}=e,r=C[t],[o,i]=(0,d.useState)(null==n?void 0:n.query);return(0,d.useEffect)(()=>{if(void 0!==n)try{let e=(0,W.WU)(n.query,{language:"postgresql",keywordCase:"lower"});i(e)}catch(e){i(n.query)}},[n]),(0,a.jsxs)(B,{"data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryDetail","data-sentry-source-file":"QueryDetail.tsx",children:[(0,a.jsxs)(H,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:[(0,a.jsx)("p",{className:"text-sm",children:"Query pattern"}),(0,a.jsx)(z.d,{hideLineNumbers:!0,value:o,language:"sql",className:(0,g.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap"),"data-sentry-element":"CodeBlock","data-sentry-source-file":"QueryDetail.tsx"}),!1]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsx)(H,{className:"gap-y-1","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryDetail.tsx",children:r.filter(e=>"query"!==e.id).map(e=>{let t=e.name.includes("time")?"".concat(null==n?void 0:n[e.id].toFixed(2),"ms"):String(null==n?void 0:n[e.id]);return(0,a.jsxs)("div",{className:"flex gap-x-2",children:[(0,a.jsx)("p",{className:"text-foreground-lighter text-sm w-32",children:e.name}),(0,a.jsx)("p",{className:"text-sm w-32",children:t})]},e.id)})})]})};var X=n(77733),Y=n(45196),K=n(42852),J=n(61223),$=n(71292),ee=n(28894),et=n(30344);async function en(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");let r=s.replace(/'/g,"''"),{result:a}=await (0,p.R)({projectRef:t,connectionString:n,sql:"select * from index_advisor('".concat(r,"');")});return a[0]}let es=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ee.a)(et.A.indexAdvisorFromQuery(t,s),()=>en({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&(s.startsWith("select")||s.startsWith("SELECT"))||s.trim().toLowerCase().startsWith("with pgrst_source"),...a})};async function er(e){let{projectRef:t,connectionString:n,query:s}=e;if(!t)throw Error("Project ref is required");try{let{result:e}=await (0,p.R)({projectRef:t,connectionString:n,sql:"\nCREATE OR REPLACE FUNCTION pg_temp.explain_query(query TEXT) RETURNS JSONB AS $$\nDECLARE\n    explain_result JSONB;\n    prepared_statement_name TEXT := 'query_to_explain';\n    n_args INT;\nBEGIN\n    -- Disallow multiple statements\n    IF query ILIKE '%;%' THEN\n        RAISE EXCEPTION 'Query must not contain a semicolon';\n    END IF;\n\n    -- Construct the parameterized query\n    EXECUTE 'PREPARE ' || prepared_statement_name || ' AS ' || query;\n\n    -- Detect how many arguments are present in the prepared statement\n    SELECT COALESCE(array_length(parameter_types, 1), 0)\n    INTO n_args\n    FROM pg_prepared_statements\n    WHERE name = prepared_statement_name\n    LIMIT 1;\n\n    -- Construct the EXECUTE statement with parameters using dynamic SQL construction\n    IF n_args > 0 THEN\n        EXECUTE 'EXPLAIN (FORMAT JSON) EXECUTE ' || prepared_statement_name || '(' || quote_literal($1) || ')' INTO explain_result;\n    ELSE\n        EXECUTE 'EXPLAIN (FORMAT JSON) EXECUTE ' || prepared_statement_name INTO explain_result;\n    END IF;\n\n    -- Deallocate the prepared statement\n    EXECUTE 'DEALLOCATE ' || prepared_statement_name;\n\n    -- Return the explain result\n    RETURN explain_result;\nEND;\n$$ LANGUAGE plpgsql;\nselect pg_temp.explain_query('".concat(s,"') as plans;\n").trim()}),r=e[0].plans.filter(e=>"Index Name"in e.Plan).map(e=>"'".concat(e.Plan["Index Name"],"'"));if(0===r.length)return[];let{result:a}=await (0,p.R)({projectRef:t,connectionString:n,sql:"select schemaname as schema, tablename as table, indexname as name from pg_indexes where indexname in (".concat(r.join(", "),");")});return a}catch(e){return[]}}let ea=function(e){let{projectRef:t,connectionString:n,query:s}=e,{enabled:r=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ee.a)(et.A.indexesFromQuery(t,s),()=>er({projectRef:t,connectionString:n,query:s}),{retry:!1,enabled:r&&void 0!==t&&void 0!==s&&void 0!==s&&(s.startsWith("select")||s.startsWith("SELECT"))||s.trim().toLowerCase().startsWith("with pgrst_source"),...a})};var eo=n(48442),ei=n(20821),el=n(37669),ec=n.n(el),ed=n(26655),eu=n(16323);let em=()=>{let{ref:e}=(0,i.UO)(),{project:t}=(0,m.d2)(),{data:n}=(0,$.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),s=(null!=n?n:[]).find(e=>"hypopg"===e.name),r=(null!=n?n:[]).find(e=>"index_advisor"===e.name),{mutateAsync:o,isLoading:l}=(0,eu.k)(),c=async()=>{if(void 0===t)return console.error("Project is required");try{var e,n;(null==s?void 0:s.installed_version)===null&&await o({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:s.name,schema:null!==(e=null==s?void 0:s.schema)&&void 0!==e?e:"extensions",version:s.default_version}),(null==r?void 0:r.installed_version)===null&&await o({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,name:r.name,schema:null!==(n=null==r?void 0:r.schema)&&void 0!==n?n:"extensions",version:r.default_version}),u.Am.success("Successfully enabled index advisor!")}catch(e){u.Am.error("Failed to enable index advisor: ".concat(e.message))}};return(0,a.jsxs)(U.bZ,{className:"mb-6","data-sentry-element":"Alert_Shadcn_","data-sentry-component":"IndexAdvisorDisabledState","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:[(0,a.jsx)(U.Cd,{"data-sentry-element":"AlertTitle_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsx)(N.U,{className:"text-foreground",content:void 0===r?"Newer version of Postgres required":"Postgres extensions `index_advisor` and `hypopg` required","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,a.jsx)(U.X,{"data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsx)(N.U,{content:void 0===r?"Upgrade to the latest version of Postgres to get recommendations on indexes for your queries":"These extensions can help in recommending database indexes to reduce the costs of your query.","data-sentry-element":"Markdown","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})}),(0,a.jsx)(U.X,{className:"mt-3","data-sentry-element":"AlertDescription_Shadcn_","data-sentry-source-file":"IndexAdvisorDisabledState.tsx",children:(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0===r?(0,a.jsx)(j.z,{asChild:!0,type:"default",children:(0,a.jsx)(ec(),{href:"/project/".concat(e,"/settings/infrastructure"),children:"Upgrade Postgres version"})}):(0,a.jsx)(j.z,{type:"default",disabled:l,loading:l,onClick:()=>c(),children:"Enable extensions"}),(0,a.jsx)(ed.G,{href:"https://supabase.com/docs/guides/database/extensions/index_advisor","data-sentry-element":"DocsButton","data-sentry-source-file":"IndexAdvisorDisabledState.tsx"})]})})]})},ep=e=>{let{selectedRow:t}=e,{project:n}=(0,m.d2)(),[s,r]=(0,d.useState)(!1),{data:o,isSuccess:i,isLoading:l}=ea({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query}),{data:c,isLoading:p}=(0,$.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),x=(null!=c?c:[]).find(e=>"hypopg"===e.name),h=(null!=c?c:[]).find(e=>"index_advisor"===e.name),f=void 0!==h&&null!==h.installed_version&&void 0!==x&&null!==x.installed_version,{data:y,error:v,refetch:_,isError:N,isSuccess:w,isLoading:E}=es({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,query:null==t?void 0:t.query},{enabled:f}),{index_statements:q,startup_cost_after:S,startup_cost_before:C,total_cost_after:T,total_cost_before:R}=null!=y?y:{index_statements:[],total_cost_after:0,total_cost_before:0},P=w&&q.length>0,A=w?(R-T)/R*100:0,{mutate:I,isLoading:k}=(0,eo.r)({onSuccess:async()=>{await _(),u.Am.success("Successfully created index")},onError:e=>{u.Am.error("Failed to create index: ".concat(e.message))}}),M=()=>{0!==q.length&&I({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString,sql:q.join(";\n")+";"})};return(0,a.jsxs)(B,{className:"h-full","data-sentry-element":"QueryPanelContainer","data-sentry-component":"QueryIndexes","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)(H,{"data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm",children:"Indexes in use"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["This query is using the following index",(null!=o?o:[]).length>1?"s":"",":"]})]}),l&&(0,a.jsx)(b.A,{}),i&&(0,a.jsxs)("div",{children:[0===o.length&&(0,a.jsxs)("div",{className:"border rounded border-dashed flex flex-col items-center justify-center py-4 px-20 gap-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"No indexes are involved in this query"}),(0,a.jsx)("p",{className:"text-center text-xs text-foreground-lighter",children:"Indexes may not necessarily be used if they incur a higher cost when executing the query"})]}),o.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-x-4 bg-surface-100 border first:rounded-tl first:rounded-tr border-b-0 last:border-b last:rounded-b px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(X.Z,{size:14,className:"text-foreground-light"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-foreground-light",children:[e.schema,".",e.table]})]}),(0,a.jsx)("span",{className:"text-xs font-mono",children:e.name})]},e.name))]})]}),(0,a.jsx)("div",{className:"border-t"}),(0,a.jsxs)(H,{className:"flex flex-col gap-y-6","data-sentry-element":"QueryPanelSection","data-sentry-source-file":"QueryIndexes.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"New index recommendations"}),p?(0,a.jsx)(b.A,{}):f?(0,a.jsxs)(a.Fragment,{children:[E&&(0,a.jsx)(b.A,{}),N&&(0,a.jsx)(J.Z,{projectRef:null==n?void 0:n.ref,error:v,subject:"Failed to retrieve result from index advisor"}),w&&(0,a.jsx)(a.Fragment,{children:0===(null!=q?q:[]).length?(0,a.jsxs)(U.bZ,{className:"[&>svg]:rounded-full",children:[(0,a.jsx)(Y.Z,{}),(0,a.jsx)(U.Cd,{children:"This query is optimized"}),(0,a.jsx)(U.X,{children:"Recommendations for indexes will show here"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Creating the following ",q.length>1?"indexes":"index"," ","on ",(0,a.jsx)("code",{className:"text-xs",children:"public.files"})," can improve this query's performance by"," ",(0,a.jsxs)("span",{className:"text-brand",children:[A.toFixed(2),"%"]}),":"]}),(0,a.jsx)(z.d,{hideLineNumbers:!0,value:q.join(";\n")+";",language:"sql",className:(0,g.cn)("max-w-full max-h-[310px]","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"This recommendation serves to prevent your queries from slowing down as your application grows, and hence the index may not be used immediately after it's created. (e.g If your table is still small at this time)"})]})})]}):(0,a.jsx)(em,{})]}),f&&P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"Query costs"}),(0,a.jsxs)("div",{className:"border rounded-md flex flex-col bg-surface-100",children:[(0,a.jsx)(G,{name:"Total cost of query",description:"An estimate of how long it will take to return all the rows (Includes start up cost)",before:R,after:T}),(0,a.jsxs)(ei.zF,{open:s,onOpenChange:r,children:[(0,a.jsx)(ei.Fw,{asChild:!0,className:"pb-3",children:(0,a.jsx)(G,{hideArrowMarkers:!0,className:"border-t",name:"Start up cost",description:"An estimate of how long it will take to fetch the first row",before:C,after:S})}),(0,a.jsxs)(ei.wy,{className:"text-xs py-1.5 border-t text-foreground-light bg-studio w-full rounded-b-md",children:["View ",s?"less":"more"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("p",{className:"text-sm",children:"FAQ"}),(0,a.jsxs)(K.UQ,{collapsible:!0,type:"single",className:"border rounded-md",children:[(0,a.jsxs)(K.Qd,{value:"1",children:[(0,a.jsx)(K.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"What units are cost in?"}),(0,a.jsx)(K.vF,{className:"px-4 text-foreground-light",children:"Costs are in an arbitrary unit, and do not represent a unit of time. The units are anchored (by default) to a single sequential page read costing 1.0 units. They do, however, serve as a predictor of higher execution times."})]}),(0,a.jsxs)(K.Qd,{value:"2",className:"border-b-0",children:[(0,a.jsx)(K.o4,{className:"px-4 py-3 text-sm font-normal text-foreground-light hover:text-foreground transition [&[data-state=open]]:text-foreground",children:"How should I prioritize start up and total cost?"}),(0,a.jsxs)(K.vF,{className:"px-4 text-foreground-light [&>div]:space-y-2",children:[(0,a.jsx)("p",{children:"This depends on the expected size of the result set from the query."}),(0,a.jsx)("p",{children:"For queries that return a small number or rows, the startup cost is more critical and minimizing startup cost can lead to faster response times, especially in interactive applications."}),(0,a.jsx)("p",{children:"For queries that return a large number of rows, the total cost becomes more important, and optimizing it will help in efficiently using resources and reducing overall query execution time."})]})]})]})]})]})]}),f&&P&&(0,a.jsxs)("div",{className:"bg-studio sticky bottom-0 border-t py-3 flex items-center justify-between px-5",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("span",{children:"Apply index to database"}),(0,a.jsx)("span",{className:"text-xs text-foreground-light",children:"This will run the SQL that is shown above"})]}),(0,a.jsx)(j.z,{disabled:k,loading:k,type:"primary",onClick:()=>M(),children:"Create index"})]})]})},ex=e=>{var t,n,s,l,u;let{queryPerformanceQuery:m}=e,p=(0,o.useRouter)(),x=(0,d.useRef)(null),{preset:h,sort:f,order:v,roles:_,search:N}=(0,i.UO)(),{isLoading:w}=m,E=p.query.sort?{column:p.query.sort,order:p.query.order}:void 0,[q,S]=(0,d.useState)("details"),[P,A]=(0,d.useState)(E),[I,k]=(0,d.useState)(),M=null!=h?h:r.MOST_TIME_CONSUMING,O=C[M].map(e=>{var t;return{key:e.id,name:e.name,resizable:!0,minWidth:null!==(t=e.minWidth)&&void 0!==t?t:120,headerCellClass:"first:pl-6 cursor-pointer",renderHeaderCell:()=>(0,a.jsxs)("div",{className:"flex items-center justify-between font-mono font-normal text-xs w-full",onClick:()=>U(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("p",{className:"!text-foreground",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-foreground-lighter",children:e.description})]}),(null==P?void 0:P.column)===e.id&&(0,a.jsx)(a.Fragment,{children:"desc"===P.order?(0,a.jsx)(T.Z,{size:14}):(0,a.jsx)(R.Z,{size:14})})]}),renderCell:t=>{var n;let s=null===(n=t.row)||void 0===n?void 0:n[e.id],r=e.name.includes("time"),o=r?"".concat(Number(s.toFixed(2)).toLocaleString(),"ms"):s.toLocaleString();return(0,a.jsxs)("div",{className:(0,g.cn)("w-full flex flex-col justify-center font-mono text-xs","number"==typeof s?"text-right":""),children:[(0,a.jsx)("p",{children:o}),r&&(0,a.jsxs)("p",{className:"text-foreground-lighter",children:[(s/1e3).toFixed(2),"s"]})]})}}}),Q=void 0!==I?null===(n=m.data)||void 0===n?void 0:null===(t=n[I])||void 0===t?void 0:t.query:void 0,F=(null!=Q?Q:"").trim().toLowerCase(),z=F.startsWith("select")||F.startsWith("with pgrst_source"),U=e=>{let t;if(A(t=(null==P?void 0:P.column)===e?"desc"===P.order?{column:e,order:"asc"}:void 0:{column:e,order:"desc"}),void 0===t){let{sort:e,order:t,...n}=p.query;p.push({...p,query:n})}else p.push({...p,query:{...p.query,sort:t.column,order:t.order}})};return(0,d.useEffect)(()=>{k(void 0)},[h,N,_,f,v]),(0,a.jsxs)(Z.pO,{direction:"horizontal",className:"relative flex flex-grow bg-alternative min-h-0",autoSaveId:"query-performance-layout-v1","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:[(0,a.jsx)(Z.ee,{defaultSize:1,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"QueryPerformanceGrid.tsx",children:(0,a.jsx)(D.ZP,{ref:x,style:{height:"100%"},className:(0,g.cn)("flex-1 flex-grow h-full"),rowHeight:44,headerRowHeight:36,columns:O,rows:null!==(u=null==m?void 0:m.data)&&void 0!==u?u:[],rowClass:(e,t)=>{let n=t===I;return["".concat(n?"bg-surface-300 dark:bg-surface-300":"bg-200"," cursor-pointer"),"".concat(n?"[&>div:first-child]:border-l-4 border-l-secondary [&>div]:border-l-foreground":""),"[&>.rdg-cell]:border-box [&>.rdg-cell]:outline-none [&>.rdg-cell]:shadow-none","[&>.rdg-cell:first-child>div]:ml-4"].join(" ")},renderers:{renderRow:(e,t)=>(0,d.createElement)(D.X2,{...t,key:"qp-row-".concat(t.rowIdx),onClick:()=>{if("number"==typeof e&&e>=0){var t;k(e),null===(t=x.current)||void 0===t||t.scrollToCell({idx:0,rowIdx:e});let n=m.data[e].query;(null!=n?n:"").trim().toLowerCase().startsWith("select")||S("details")}}}),noRowsFallback:w?(0,a.jsx)("div",{className:"absolute top-14 px-6 w-full",children:(0,a.jsx)(b.A,{})}):(0,a.jsxs)("div",{className:"absolute top-20 px-6 flex flex-col items-center justify-center w-full gap-y-2",children:[(0,a.jsx)(L.Z,{className:"text-foreground-muted",strokeWidth:1}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-foreground",children:"No queries detected"}),(0,a.jsx)("p",{className:"text-foreground-light",children:"There are no actively running queries that match the criteria"})]})]})},"data-sentry-element":"DataGrid","data-sentry-source-file":"QueryPerformanceGrid.tsx"})}),void 0!==I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Dp,{withHandle:!0}),(0,a.jsxs)(Z.ee,{defaultSize:30,maxSize:45,minSize:30,className:"bg-studio border-t",children:[(0,a.jsx)(j.z,{type:"text",className:"absolute top-3 right-3 px-1",icon:(0,a.jsx)(c.Z,{}),onClick:()=>k(void 0)}),(0,a.jsxs)(y.mQ,{value:q,className:"flex flex-col h-full",onValueChange:e=>S(e),children:[(0,a.jsxs)(y.dr,{className:"px-5 flex gap-x-4 min-h-[46px]",children:[(0,a.jsx)(y.SP,{value:"details",className:"px-0 pb-0 h-full text-xs  data-[state=active]:bg-transparent !shadow-none",children:"Query details"}),z&&(0,a.jsx)(y.SP,{value:"suggestion",className:"px-0 pb-0 h-full text-xs data-[state=active]:bg-transparent !shadow-none",children:"Indexes"})]}),(0,a.jsx)(y.nU,{value:"details",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(V,{reportType:M,selectedRow:null===(s=m.data)||void 0===s?void 0:s[I],onClickViewSuggestion:()=>S("suggestion")})}),(0,a.jsx)(y.nU,{value:"suggestion",className:"mt-0 flex-grow min-h-0 overflow-y-auto",children:(0,a.jsx)(ep,{selectedRow:null===(l=m.data)||void 0===l?void 0:l[I]})})]})]})]})]})},eh=e=>{let{queryHitRate:t,queryPerformanceQuery:n}=e,s=(0,o.useRouter)(),{ref:w,preset:E}=(0,i.UO)(),{project:q}=(0,m.d2)(),C=(0,f.TF)(),[T,R]=(0,d.useState)(null!=E?E:r.MOST_TIME_CONSUMING),[P,A]=(0,d.useState)(!1),[I,k]=(0,x.l)(h.dA.QUERY_PERF_SHOW_BOTTOM_SECTION,!0),M=()=>{n.runQuery(),t.runQuery()},{data:O,isLoading:Q}=S({preset:"mostTimeConsuming"}),{data:L,isLoading:D}=S({preset:"mostFrequentlyInvoked"}),{data:Z,isLoading:z}=S({preset:"slowestExecutionTime"}),U=(0,d.useMemo)(()=>[{id:r.MOST_TIME_CONSUMING,label:"Most time consuming",description:"Lists queries ordered by their cumulative total execution time.",isLoading:Q,max:(null!=O?O:[]).length>0?Math.max(...(null!=O?O:[]).map(e=>e.total_time)).toFixed(2):void 0},{id:r.MOST_FREQUENT,label:"Most frequent",description:"Lists queries in order of their execution count",isLoading:D,max:(null!=L?L:[]).length>0?Math.max(...(null!=L?L:[]).map(e=>e.calls)).toFixed(2):void 0},{id:r.SLOWEST_EXECUTION,label:"Slowest execution",description:"Lists queries ordered by their maximum execution time",isLoading:z,max:(null!=Z?Z:[]).length>0?Math.max(...(null!=Z?Z:[]).map(e=>e.max_time)).toFixed(2):void 0}],[D,z,Q,L,O,Z]);return(0,d.useEffect)(()=>{C.setSelectedDatabaseId(w)},[w]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.mQ,{defaultValue:T,onValueChange:e=>{R(e);let{sort:t,search:n,...r}=s.query;s.push({...s,query:{...r,preset:e}})},"data-sentry-element":"Tabs_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:(0,a.jsx)(y.dr,{className:(0,g.cn)("flex gap-0 border-0 items-end z-10"),"data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"QueryPerformance.tsx",children:U.map(e=>(0,a.jsxs)(y.SP,{value:e.id,className:(0,g.cn)("group relative","px-6 py-3 border-b-0 flex flex-col items-start !shadow-none border-default border-t","even:border-x last:border-r even:!border-x-strong last:!border-r-strong",e.id===T?"!bg-surface-200":"!bg-surface-200/[33%]","hover:!bg-surface-100","data-[state=active]:!bg-surface-200","hover:text-foreground-light","transition"),children:[e.id===T&&(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-foreground"}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)("span",{className:"",children:e.label}),(0,a.jsxs)(v.u,{children:[(0,a.jsx)(v.aJ,{asChild:!0,children:(0,a.jsx)(l.Z,{className:"transition text-foreground-muted w-3 h-3 data-[state=delayed-open]:text-foreground-light"})}),(0,a.jsx)(v._v,{side:"top",children:e.description})]})]}),e.isLoading?(0,a.jsx)(b.Z,{className:"w-32 pt-1"}):void 0===e.max?(0,a.jsx)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:"No data yet"}):(0,a.jsxs)("span",{className:"text-xs text-foreground-muted group-hover:text-foreground-lighter group-data-[state=active]:text-foreground-lighter transition",children:[Number(e.max).toLocaleString(),e.id!==r.MOST_FREQUENT?"ms":" calls"]}),e.id===T&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-[1px] bg-surface-200"})]},e.id))})}),(0,a.jsx)("div",{className:"px-6 py-3 bg-surface-200 border-t -mt-px",children:(0,a.jsx)(F,{queryPerformanceQuery:n,onResetReportClick:()=>{A(!0)},"data-sentry-element":"QueryPerformanceFilterBar","data-sentry-source-file":"QueryPerformance.tsx"})}),(0,a.jsx)(ex,{queryPerformanceQuery:n,"data-sentry-element":"QueryPerformanceGrid","data-sentry-source-file":"QueryPerformance.tsx"}),(0,a.jsxs)("div",{className:(0,g.cn)("px-6 py-6 flex gap-x-4 border-t relative",{hidden:!1===I}),children:[(0,a.jsx)(j.z,{className:"absolute top-1.5 right-3 px-1.5",type:"text",size:"tiny",onClick:()=>{k(!1)},"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:(0,a.jsx)(c.Z,{size:"14","data-sentry-element":"X","data-sentry-source-file":"QueryPerformance.tsx"})}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Reset report"}),(0,a.jsx)("p",{className:"text-xs text-foreground-light",children:"Consider resetting the analysis after optimizing any queries"}),(0,a.jsx)(j.z,{type:"default",className:"!mt-3 w-min",onClick:()=>A(!0),"data-sentry-element":"Button","data-sentry-source-file":"QueryPerformance.tsx",children:"Reset report"})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"How is this report generated?"}),(0,a.jsx)(N.U,{className:"text-xs",content:"This report uses the pg_stat_statements table, and pg_stat_statements extension. [Learn more here](https://supabase.com/docs/guides/platform/performance#examining-query-performance).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]}),(0,a.jsxs)("div",{className:"w-[33%] flex flex-col gap-y-1 text-sm",children:[(0,a.jsx)("p",{children:"Inspect your database for potential issues"}),(0,a.jsx)(N.U,{className:"text-xs",content:"The Supabase CLI comes with a range of tools to help inspect your Postgres instances for potential issues. [Learn more here](https://supabase.com/docs/guides/database/inspect).","data-sentry-element":"Markdown","data-sentry-source-file":"QueryPerformance.tsx"})]})]}),(0,a.jsx)(_.Z,{danger:!0,visible:P,title:"Reset query performance analysis",description:"This will reset the `extensions.pg_stat_statements` table that is used to calculate query performance. This data will repopulate immediately after.",buttonLabel:"Clear table",buttonLoadingLabel:"Deleting",onSelectCancel:()=>A(!1),onSelectConfirm:async()=>{try{await (0,p.R)({projectRef:null==q?void 0:q.ref,connectionString:null==q?void 0:q.connectionString,sql:"SELECT pg_stat_statements_reset();"}),M(),A(!1)}catch(e){u.Am.error("Failed to reset analysis: ".concat(e.message))}},"data-sentry-element":"ConfirmModal","data-sentry-source-file":"QueryPerformance.tsx"})]})};var ef=n(80954),ey=n(94502),eg=n(35603),ev=n(8504);let ej={[r.MOST_TIME_CONSUMING]:"mostTimeConsuming",[r.MOST_FREQUENT]:"mostFrequentlyInvoked",[r.SLOWEST_EXECUTION]:"slowestExecutionTime"},e_=()=>{var e,t;let n=(0,o.useRouter)(),{ref:s,search:r,sort:l,order:c,preset:d}=(0,i.UO)(),u=w.cr[E.s.QUERY_PERFORMANCE],m=(0,ef.H)(u.queries,null!=s?s:"default").queryHitRate(),p=null!==(t=null==n?void 0:null===(e=n.query)||void 0===e?void 0:e.roles)&&void 0!==t?t:[],x=S({searchQuery:null!=r?r:"",orderBy:void 0!==l?{column:l,order:c}:void 0,preset:void 0!==d?ej[d]:"mostTimeConsuming",roles:"string"==typeof p?[p]:p});return(0,a.jsxs)("div",{className:"h-full flex flex-col","data-sentry-component":"QueryPerformanceReport","data-sentry-source-file":"query-performance.tsx",children:[(0,a.jsx)(ev.p,{className:"py-4 px-6 !mb-0",title:"Query Performance",docsUrl:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",actions:(0,a.jsx)(eg.Z,{}),"data-sentry-element":"FormHeader","data-sentry-source-file":"query-performance.tsx"}),(0,a.jsx)(eh,{queryHitRate:m,queryPerformanceQuery:x,"data-sentry-element":"QueryPerformance","data-sentry-source-file":"query-performance.tsx"})]})};e_.getLayout=e=>(0,a.jsx)(ey.Z,{title:"Query performance",children:e});var eb=e_},59863:function(e,t,n){"use strict";var s=n(97458),r=n(52983),a=n(2054),o=n(93009),i=n(19168);t.Z=e=>{let{visible:t=!1,danger:n=!1,title:l="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:p=()=>{},onSelectConfirm:x=()=>{}}=e;(0,r.useEffect)(()=>{t&&f(!1)},[t]);let[h,f]=(0,r.useState)(!1),y=()=>{f(!0),x()};return(0,s.jsx)(a.Z,{header:l,visible:t,title:l,description:c,size:d,hideFooter:!0,onCancel:p,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,s.jsx)(o.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>y(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(a.Z.Content,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.z,{block:!0,htmlType:"button",type:"default",onClick:p,disabled:h,children:"Cancel"}),(0,s.jsx)(i.z,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:h,loading:h,children:m&&h?m:u||"Confirm"})]})})})})})}},90537:function(e,t,n){"use strict";n.d(t,{ZP:function(){return m}});var s=n(97458),r=n(52983),a=n(82188),o=n(5546);function i(e){let{children:t,className:n,tag:r="div",style:a}=e;return(0,s.jsx)("".concat(r),{style:a,"data-sentry-element":"CustomTag","data-sentry-component":"Typography","data-sentry-source-file":"Typography.tsx",children:t})}i.Title=function(e){let{className:t,level:n=1,children:r,style:a}=e;return(0,s.jsx)("h".concat(n),{style:a,"data-sentry-element":"CustomTag","data-sentry-component":"Title","data-sentry-source-file":"Title.tsx",children:r})},i.Text=function(e){let{className:t,children:n,style:r,type:a,disabled:o,mark:i,code:l,keyboard:c,underline:d,strikethrough:u,strong:m,small:p}=e;return l?(0,s.jsx)("code",{style:r,children:n}):i?(0,s.jsx)("mark",{style:r,children:n}):c?(0,s.jsx)("kbd",{style:r,children:n}):m?(0,s.jsx)("strong",{style:r,children:n}):(0,s.jsx)("span",{style:r,"data-sentry-component":"Text","data-sentry-source-file":"Text.tsx",children:n})},i.Link=function(e){let{children:t,target:n="_blank",href:r,className:a,onClick:o,style:i}=e;return(0,s.jsx)("a",{onClick:o,href:r,target:n,rel:"noopener noreferrer",style:i,"data-sentry-component":"Link","data-sentry-source-file":"Link.tsx",children:t})};let l=(0,r.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,s.jsx)(l.Provider,{value:{type:t},"data-sentry-element":"unknown","data-sentry-component":"MenuContextProvider","data-sentry-source-file":"MenuContext.tsx",children:e.children})},d=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:r,style:a,type:o="text"}=e;return(0,s.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:a,"data-sentry-component":"Menu","data-sentry-source-file":"Menu.tsx",children:(0,s.jsx)(c,{type:o,"data-sentry-element":"MenuContextProvider","data-sentry-source-file":"Menu.tsx",children:(0,s.jsx)("ul",{className:r,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:r,rounded:i,onClick:l,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,p=(0,a.Z)("menu"),{type:x}=d(),h=[p.item.base];h.push(p.item.variants[x].base),r?h.push(p.item.variants[x].active):h.push(p.item.variants[x].normal);let f=[p.item.content.base];r?f.push(p.item.content.active):f.push(p.item.content.normal);let y=[p.item.icon.base];return r?y.push(p.item.icon.active):y.push(p.item.icon.normal),(0,s.jsxs)("li",{role:"menuitem",className:(0,o.cn)("outline-none",h),style:m,onClick:l,"aria-current":r?"page":void 0,"data-sentry-component":"Item","data-sentry-source-file":"Menu.tsx",children:[n&&(0,s.jsx)("div",{className:"".concat(y.join(" ")," min-w-fit"),children:n}),(0,s.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:r}=e,o=(0,a.Z)("menu"),{type:i}=d();return(0,s.jsxs)("div",{className:[o.group.base,o.group.variants[i]].join(" "),"data-sentry-component":"Group","data-sentry-source-file":"Menu.tsx",children:[n&&(0,s.jsx)("span",{className:o.group.icon,children:n}),(0,s.jsx)("span",{className:o.group.content,children:r}),t]})},u.Misc=function(e){let{children:t}=e;return(0,s.jsx)("div",{"data-sentry-component":"Misc","data-sentry-source-file":"Menu.tsx",children:(0,s.jsx)(i.Text,{"data-sentry-element":"unknown","data-sentry-source-file":"Menu.tsx",children:(0,s.jsx)("span",{children:t})})})};var m=u},42852:function(e,t,n){"use strict";n.d(t,{Qd:function(){return c},UQ:function(){return l},o4:function(){return d},vF:function(){return u}});var s=n(97458),r=n(93761),a=n(63204),o=n(52983),i=n(5546);let l=r.fC,c=o.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,s.jsx)(r.ck,{ref:t,className:(0,i.cn)("border-b",n),...a})});c.displayName="AccordionItem";let d=o.forwardRef((e,t)=>{let{className:n,children:o,hideIcon:l,...c}=e;return(0,s.jsx)(r.h4,{className:"flex",children:(0,s.jsxs)(r.xz,{ref:t,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...c,children:[o,!l&&(0,s.jsx)(a.Z,{className:"h-4 w-4 transition-transform duration-200"})]})})});d.displayName=r.xz.displayName;let u=o.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,s.jsx)(r.VY,{ref:t,className:(0,i.cn)("overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",n),...o,children:(0,s.jsx)("div",{className:"pb-4 pt-0",children:a})})});u.displayName=r.VY.displayName},37173:function(e,t,n){"use strict";var s=n(52983);let r=s.forwardRef(function({title:e,titleId:t,...n},r){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},n),e?s.createElement("title",{id:t},e):null,s.createElement("path",{fillRule:"evenodd",d:"M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0ZM9 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM6.75 8a.75.75 0 0 0 0 1.5h.75v1.75a.75.75 0 0 0 1.5 0v-2.5A.75.75 0 0 0 8.25 8h-1.5Z",clipRule:"evenodd"}))});t.Z=r},93761:function(e,t,n){"use strict";n.d(t,{VY:function(){return B},ck:function(){return z},fC:function(){return Z},h4:function(){return U},xz:function(){return W}});var s=n(83573),r=n(52983),a=n(95831),o=n(34981),i=n(61031),l=n(12527),c=n(29650),d=n(85418),u=n(99517),m=n(29028),p=n(72929);let x="Accordion",h=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[f,y,g]=(0,o.B)(x),[v,j]=(0,a.b)(x,[g,u.p_]),_=(0,u.p_)(),b=r.forwardRef((e,t)=>{let{type:n,...a}=e;return r.createElement(f.Provider,{scope:e.__scopeAccordion},"multiple"===n?r.createElement(C,(0,s.Z)({},a,{ref:t})):r.createElement(S,(0,s.Z)({},a,{ref:t})))});b.propTypes={type(e){let t=e.value||e.defaultValue;return e.type&&!["single","multiple"].includes(e.type)?Error("Invalid prop `type` supplied to `Accordion`. Expected one of `single | multiple`."):"multiple"===e.type&&"string"==typeof t?Error("Invalid prop `type` supplied to `Accordion`. Expected `single` when `defaultValue` or `value` is type `string`."):"single"===e.type&&Array.isArray(t)?Error("Invalid prop `type` supplied to `Accordion`. Expected `multiple` when `defaultValue` or `value` is type `string[]`."):null}};let[N,w]=v(x),[E,q]=v(x,{collapsible:!1}),S=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},collapsible:i=!1,...l}=e,[d,u]=(0,c.T)({prop:n,defaultProp:a,onChange:o});return r.createElement(N,{scope:e.__scopeAccordion,value:d?[d]:[],onItemOpen:u,onItemClose:r.useCallback(()=>i&&u(""),[i,u])},r.createElement(E,{scope:e.__scopeAccordion,collapsible:i},r.createElement(P,(0,s.Z)({},l,{ref:t}))))}),C=r.forwardRef((e,t)=>{let{value:n,defaultValue:a,onValueChange:o=()=>{},...i}=e,[l=[],d]=(0,c.T)({prop:n,defaultProp:a,onChange:o}),u=r.useCallback(e=>d((t=[])=>[...t,e]),[d]),m=r.useCallback(e=>d((t=[])=>t.filter(t=>t!==e)),[d]);return r.createElement(N,{scope:e.__scopeAccordion,value:l,onItemOpen:u,onItemClose:m},r.createElement(E,{scope:e.__scopeAccordion,collapsible:!0},r.createElement(P,(0,s.Z)({},i,{ref:t}))))}),[T,R]=v(x),P=r.forwardRef((e,t)=>{let{__scopeAccordion:n,disabled:a,dir:o,orientation:c="vertical",...u}=e,m=r.useRef(null),x=(0,i.e)(m,t),g=y(n),v="ltr"===(0,p.gm)(o),j=(0,l.M)(e.onKeyDown,e=>{var t;if(!h.includes(e.key))return;let n=e.target,s=g().filter(e=>{var t;return!(null!==(t=e.ref.current)&&void 0!==t&&t.disabled)}),r=s.findIndex(e=>e.ref.current===n),a=s.length;if(-1===r)return;e.preventDefault();let o=r,i=a-1,l=()=>{(o=r+1)>i&&(o=0)},d=()=>{(o=r-1)<0&&(o=i)};switch(e.key){case"Home":o=0;break;case"End":o=i;break;case"ArrowRight":"horizontal"===c&&(v?l():d());break;case"ArrowDown":"vertical"===c&&l();break;case"ArrowLeft":"horizontal"===c&&(v?d():l());break;case"ArrowUp":"vertical"===c&&d()}null===(t=s[o%a].ref.current)||void 0===t||t.focus()});return r.createElement(T,{scope:n,disabled:a,direction:o,orientation:c},r.createElement(f.Slot,{scope:n},r.createElement(d.WV.div,(0,s.Z)({},u,{"data-orientation":c,ref:x,onKeyDown:a?void 0:j}))))}),A="AccordionItem",[I,k]=v(A),M=r.forwardRef((e,t)=>{let{__scopeAccordion:n,value:a,...o}=e,i=R(A,n),l=w(A,n),c=_(n),d=(0,m.M)(),p=a&&l.value.includes(a)||!1,x=i.disabled||e.disabled;return r.createElement(I,{scope:n,open:p,disabled:x,triggerId:d},r.createElement(u.fC,(0,s.Z)({"data-orientation":i.orientation,"data-state":D(p)},c,o,{ref:t,disabled:x,open:p,onOpenChange:e=>{e?l.onItemOpen(a):l.onItemClose(a)}})))}),O=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(x,n),i=k("AccordionHeader",n);return r.createElement(d.WV.h3,(0,s.Z)({"data-orientation":o.orientation,"data-state":D(i.open),"data-disabled":i.disabled?"":void 0},a,{ref:t}))}),Q="AccordionTrigger",F=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(x,n),i=k(Q,n),l=q(Q,n),c=_(n);return r.createElement(f.ItemSlot,{scope:n},r.createElement(u.xz,(0,s.Z)({"aria-disabled":i.open&&!l.collapsible||void 0,"data-orientation":o.orientation,id:i.triggerId},c,a,{ref:t})))}),L=r.forwardRef((e,t)=>{let{__scopeAccordion:n,...a}=e,o=R(x,n),i=k("AccordionContent",n),l=_(n);return r.createElement(u.VY,(0,s.Z)({role:"region","aria-labelledby":i.triggerId,"data-orientation":o.orientation},l,a,{ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}}))});function D(e){return e?"open":"closed"}let Z=b,z=M,U=O,W=F,B=L},98219:function(e,t,n){"use strict";function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{_:function(){return s}})}},function(e){e.O(0,[1885,588,520,2597,8703,9505,3351,6019,7191,2594,175,659,2829,5294,5313,5970,9080,7249,9885,495,7546,6064,111,5394,5931,9774,2888,179],function(){return e(e.s=942)}),_N_E=e.O()}]);