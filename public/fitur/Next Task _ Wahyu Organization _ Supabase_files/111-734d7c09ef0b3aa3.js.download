!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7669e0d3-030f-4340-80b9-792c2d34cacb",e._sentryDebugIdIdentifier="sentry-dbid-7669e0d3-030f-4340-80b9-792c2d34cacb")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[111],{98653:function(e,n,t){"use strict";t.d(n,{o:function(){return a}});let a=[{id:1,type:"template",title:"Create table",description:'Basic table template. Change "table_name" to the name you prefer.',sql:"create table table_name (\n  id bigint generated by default as identity primary key,\n  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null,\n  updated_at timestamp with time zone default timezone('utc'::text, now()) not null,\n  data jsonb,\n  name text\n);"},{id:2,type:"template",title:"Add view",description:"Template to add a view. Make sure to change the table and column names to ones that already exist.",sql:"CREATE VIEW countries_view AS\nSELECT id, continent\nFROM countries;"},{id:3,type:"template",title:"Add column",description:"Template to add a column. Make sure to change the name and type.",sql:"alter table table_name\nadd column new_column_name data_type;"},{id:4,type:"template",title:"Add comments",description:"Templates to add a comment to either a table or a column.",sql:"comment on table table_name is 'Table description';\ncomment on column table_name.column_name is 'Column description';"},{id:5,type:"template",title:"Show extensions",description:"Get a list of extensions in your database and status.",sql:"select\n  name, comment, default_version, installed_version\nfrom\n  pg_available_extensions\norder by\n  name asc;"},{id:6,type:"template",title:"Show version",description:"Get your Postgres version.",sql:"select * from\n  (select version()) as version,\n  (select current_setting('server_version_num')) as version_number;"},{id:7,type:"template",title:"Show active connections",description:"Get the number of active and max connections.",sql:"select * from\n(select count(pid) as active_connections FROM pg_stat_activity where state = 'active') active_connections,\n(select setting as max_connections from pg_settings where name = 'max_connections') max_connections;"},{id:8,type:"template",title:"Automatically update timestamps",description:"Update a column timestamp on every update.",sql:'\ncreate extension if not exists moddatetime schema extensions;\n\n-- assuming the table name is "todos", and a timestamp column "updated_at"\n-- this trigger will set the "updated_at" column to the current timestamp for every update\ncreate trigger\n  handle_updated_at before update\non todos\nfor each row execute\n  procedure moddatetime(updated_at);\n  '.trim()},{id:9,type:"template",title:"Increment field value",description:"Update a field with incrementing value using stored procedure.",sql:"\ncreate function increment(row_id int)\nreturns void as\n$$\n  update table_name\n  set field_name = field_name + 1\n  where id = row_id;\n$$\nlanguage sql volatile;\n\n-- you can call the function from your browser with supabase-js\n-- const { data, error } = await supabase.rpc('increment', { row_id: 2 })\n  ".trim()},{id:10,type:"template",title:"pg_stat_statements report",description:"Select from pg_stat_statements and view recent queries",sql:"-- pg_stat_statements report\n\n-- A limit of 100 has been added below\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows,\n    statements.wal_bytes,\n    statements.wal_records\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  order by\n    total_time desc\n  limit\n    100;"},{id:11,type:"quickstart",title:"Countries",description:"Create a table with all the countries in the world.",sql:"create type public.continents as enum (\n    'Africa',\n    'Antarctica',\n    'Asia',\n    'Europe',\n    'Oceania',\n    'North America',\n    'South America'\n);\ncreate table public.countries (\n  id bigint generated by default as identity primary key,\n  name text,\n  iso2 text not null,\n  iso3 text,\n  local_name text,\n  continent continents\n);\ncomment on table countries is 'Full list of countries.';\ncomment on column countries.name is 'Full country name.';\ncomment on column countries.iso2 is 'ISO 3166-1 alpha-2 code.';\ncomment on column countries.iso3 is 'ISO 3166-1 alpha-3 code.';\ncomment on column countries.local_name is 'Local variation of the name.';\ninsert into public.countries (name,iso2,iso3,local_name,continent) values\n  ('Bonaire, Sint Eustatius and Saba','BQ','BES',null,null),\n  ('Cura\xe7ao','CW','CUW',null,null),\n  ('Guernsey','GG','GGY',null,null),\n  ('Isle of Man','IM','IMN',null,null),\n  ('Jersey','JE','JEY',null,null),\n  ('\xc5land Islands','AX','ALA',null,null),\n  ('Montenegro','ME','MNE',null,null),\n  ('Saint Barth\xe9lemy','BL','BLM',null,null),\n  ('Saint Martin (French part)','MF','MAF',null,null),\n  ('Serbia','RS','SRB',null,null),\n  ('Sint Maarten (Dutch part)','SX','SXM',null,null),\n  ('South Sudan','SS','SSD',null,null),\n  ('Timor-Leste','TL','TLS',null,null),\n  ('American Samoa','as','ASM','Amerika Samoa','Oceania'),\n  ('Andorra','AD','AND','Andorra','Europe'),\n  ('Angola','AO','AGO','Angola','Africa'),\n  ('Anguilla','AI','AIA','Anguilla','North America'),\n  ('Antarctica','AQ','ATA','','Antarctica'),\n  ('Antigua and Barbuda','AG','ATG','Antigua and Barbuda','North America'),\n  ('Argentina','AR','ARG','Argentina','South America'),\n  ('Armenia','AM','ARM','Hajastan','Asia'),\n  ('Aruba','AW','ABW','Aruba','North America'),\n  ('Australia','AU','AUS','Australia','Oceania'),\n  ('Austria','AT','AUT','\xd6sterreich','Europe'),\n  ('Azerbaijan','AZ','AZE','Azerbaijan','Asia'),\n  ('Bahamas','BS','BHS','The Bahamas','North America'),\n  ('Bahrain','BH','BHR','Al-Bahrayn','Asia'),\n  ('Bangladesh','BD','BGD','Bangladesh','Asia'),\n  ('Barbados','BB','BRB','Barbados','North America'),\n  ('Belarus','BY','BLR','Belarus','Europe'),\n  ('Belgium','BE','BEL','Belgium/Belgique','Europe'),\n  ('Belize','BZ','BLZ','Belize','North America'),\n  ('Benin','BJ','BEN','Benin','Africa'),\n  ('Bermuda','BM','BMU','Bermuda','North America'),\n  ('Bhutan','BT','BTN','Druk-Yul','Asia'),\n  ('Bolivia','BO','BOL','Bolivia','South America'),\n  ('Bosnia and Herzegovina','BA','BIH','Bosna i Hercegovina','Europe'),\n  ('Botswana','BW','BWA','Botswana','Africa'),\n  ('Bouvet Island','BV','BVT','Bouvet Island','Antarctica'),\n  ('Brazil','BR','BRA','Brasil','South America'),\n  ('British Indian Ocean Territory','IO','IOT','British Indian Ocean Territory','Africa'),\n  ('Brunei Darussalam','BN','BRN','Brunei Darussalam','Asia'),\n  ('Bulgaria','BG','BGR','Balgarija','Europe'),\n  ('Burkina Faso','BF','BFA','Burkina Faso','Africa'),\n  ('Burundi','BI','BDI','Burundi/Uburundi','Africa'),\n  ('Cambodia','KH','KHM','Cambodia','Asia'),\n  ('Cameroon','CM','CMR','Cameroun/Cameroon','Africa'),\n  ('Canada','CA','CAN','Canada','North America'),\n  ('Cape Verde','CV','CPV','Cabo Verde','Africa'),\n  ('Cayman Islands','KY','CYM','Cayman Islands','North America'),\n  ('Central African Republic','CF','CAF','Centrafrique','Africa'),\n  ('Chad','TD','TCD','Tchad/Tshad','Africa'),\n  ('Chile','CL','CHL','Chile','South America'),\n  ('China','CN','CHN','Zhongguo','Asia'),\n  ('Christmas Island','CX','CXR','Christmas Island','Oceania'),\n  ('Cocos (Keeling) Islands','CC','CCK','Cocos (Keeling) Islands','Oceania'),\n  ('Colombia','CO','COL','Colombia','South America'),\n  ('Comoros','KM','COM','Komori/Comores','Africa'),\n  ('Congo','CG','COG','Congo','Africa'),\n  ('Congo, the Democratic Republic of the','CD','COD','Republique Democratique du Congo','Africa'),\n  ('Cook Islands','CK','COK','The Cook Islands','Oceania'),\n  ('Costa Rica','CR','CRI','Costa Rica','North America'),\n  ('Cote DIvoire','CI','CIV','C\xf4te dIvoire','Africa'),\n  ('Croatia','HR','HRV','Hrvatska','Europe'),\n  ('Cuba','CU','CUB','Cuba','North America'),\n  ('Cyprus','CY','CYP','Cyprus','Asia'),\n  ('Czech Republic','CZ','CZE','Czech','Europe'),\n  ('Denmark','DK','DNK','Danmark','Europe'),\n  ('Djibouti','DJ','DJI','Djibouti/Jibuti','Africa'),\n  ('Dominica','DM','DMA','Dominica','North America'),\n  ('Dominican Republic','DO','DOM','Republica Dominicana','North America'),\n  ('Ecuador','EC','ECU','Ecuador','South America'),\n  ('Egypt','EG','EGY','Misr','Africa'),\n  ('El Salvador','SV','SLV','El Salvador','North America'),\n  ('Equatorial Guinea','GQ','GNQ','Guinea Ecuatorial','Africa'),\n  ('Eritrea','ER','ERI','Ertra','Africa'),\n  ('Estonia','EE','EST','Eesti','Europe'),\n  ('Ethiopia','ET','ETH','Yeityopiya','Africa'),\n  ('Falkland Islands (Malvinas)','FK','FLK','Falkland Islands','South America'),\n  ('Faroe Islands','FO','FRO','Faroe Islands','Europe'),\n  ('Fiji','FJ','FJI','Fiji Islands','Oceania'),\n  ('Finland','FI','FIN','Suomi','Europe'),\n  ('France','FR','FRA','France','Europe'),\n  ('French Guiana','GF','GUF','Guyane francaise','South America'),\n  ('French Polynesia','PF','PYF','Polyn\xe9sie fran\xe7aise','Oceania'),\n  ('French Southern Territories','TF','ATF','Terres australes fran\xe7aises','Antarctica'),\n  ('Gabon','GA','GAB','Le Gabon','Africa'),\n  ('Gambia','GM','GMB','The Gambia','Africa'),\n  ('Georgia','GE','GEO','Sakartvelo','Asia'),\n  ('Germany','DE','DEU','Deutschland','Europe'),\n  ('Ghana','GH','GHA','Ghana','Africa'),\n  ('Gibraltar','GI','GIB','Gibraltar','Europe'),\n  ('Greece','GR','GRC','Greece','Europe'),\n  ('Greenland','GL','GRL','Kalaallit Nunaat','North America'),\n  ('Grenada','GD','GRD','Grenada','North America'),\n  ('Guadeloupe','GP','GLP','Guadeloupe','North America'),\n  ('Guam','GU','GUM','Guam','Oceania'),\n  ('Guatemala','GT','GTM','Guatemala','North America'),\n  ('Guinea','GN','GIN','Guinea','Africa'),\n  ('Guinea-Bissau','GW','GNB','Guinea-Bissau','Africa'),\n  ('Guyana','GY','GUY','Guyana','South America'),\n  ('Haiti','HT','HTI','Haiti/Dayti','North America'),\n  ('Heard Island and Mcdonald Islands','HM','HMD','Heard and McDonald Islands','Antarctica'),\n  ('Holy See (Vatican City State)','VA','VAT','Santa Sede/Citt\xe0 del Vaticano','Europe'),\n  ('Honduras','HN','HND','Honduras','North America'),\n  ('Hong Kong','HK','HKG','Xianggang/Hong Kong','Asia'),\n  ('Hungary','HU','HUN','Hungary','Europe'),\n  ('Iceland','IS','ISL','Iceland','Europe'),\n  ('India','IN','IND','Bharat/India','Asia'),\n  ('Indonesia','ID','IDN','Indonesia','Asia'),\n  ('Iran, Islamic Republic of','IR','IRN','Iran','Asia'),\n  ('Iraq','IQ','IRQ','Al-Irāq','Asia'),\n  ('Ireland','IE','IRL','Ireland','Europe'),\n  ('Israel','IL','ISR','Yisrael','Asia'),\n  ('Italy','IT','ITA','Italia','Europe'),\n  ('Jamaica','JM','JAM','Jamaica','North America'),\n  ('Japan','JP','JPN','Nihon/Nippon','Asia'),\n  ('Jordan','JO','JOR','Al-Urdunn','Asia'),\n  ('Kazakhstan','KZ','KAZ','Qazaqstan','Asia'),\n  ('Kenya','KE','KEN','Kenya','Africa'),\n  ('Kiribati','KI','KIR','Kiribati','Oceania'),\n  ('Korea, Democratic People''s Republic of','KP','PRK','Choson Minjujuui Inmin Konghwaguk (Bukhan)','Asia'),\n  ('Korea, Republic of','KR','KOR','Taehan-minguk (Namhan)','Asia'),\n  ('Kuwait','KW','KWT','Al-Kuwayt','Asia'),\n  ('Kyrgyzstan','KG','KGZ','Kyrgyzstan','Asia'),\n  ('Lao People''s Democratic Republic','LA','LAO','Lao','Asia'),\n  ('Latvia','LV','LVA','Latvija','Europe'),\n  ('Lebanon','LB','LBN','Lubnan','Asia'),\n  ('Lesotho','LS','LSO','Lesotho','Africa'),\n  ('Liberia','LR','LBR','Liberia','Africa'),\n  ('Libya','LY','LBY','Libiya','Africa'),\n  ('Liechtenstein','LI','LIE','Liechtenstein','Europe'),\n  ('Lithuania','LT','LTU','Lietuva','Europe'),\n  ('Luxembourg','LU','LUX','Luxembourg','Europe'),\n  ('Macao','MO','MAC','Macau/Aomen','Asia'),\n  ('Macedonia, the Former Yugoslav Republic of','MK','MKD','Makedonija','Europe'),\n  ('Madagascar','MG','MDG','Madagasikara/Madagascar','Africa'),\n  ('Malawi','MW','MWI','Malawi','Africa'),\n  ('Malaysia','MY','MYS','Malaysia','Asia'),\n  ('Maldives','MV','MDV','Dhivehi Raajje/Maldives','Asia'),\n  ('Mali','ML','MLI','Mali','Africa'),\n  ('Malta','MT','MLT','Malta','Europe'),\n  ('Marshall Islands','MH','MHL','Marshall Islands/Majol','Oceania'),\n  ('Martinique','MQ','MTQ','Martinique','North America'),\n  ('Mauritania','MR','MRT','Muritaniya/Mauritanie','Africa'),\n  ('Mauritius','MU','MUS','Mauritius','Africa'),\n  ('Mayotte','YT','MYT','Mayotte','Africa'),\n  ('Mexico','MX','MEX','Mexico','North America'),\n  ('Micronesia, Federated States of','FM','FSM','Micronesia','Oceania'),\n  ('Moldova, Republic of','MD','MDA','Moldova','Europe'),\n  ('Monaco','MC','MCO','Monaco','Europe'),\n  ('Mongolia','MN','MNG','Mongol Uls','Asia'),\n  ('Albania','AL','ALB','Republika e Shqip\xebris\xeb','Europe'),\n  ('Montserrat','MS','MSR','Montserrat','North America'),\n  ('Morocco','MA','MAR','Al-Maghrib','Africa'),\n  ('Mozambique','MZ','MOZ','Mozambique','Africa'),\n  ('Myanmar','MM','MMR','Myanma Pye','Asia'),\n  ('Namibia','NA','NAM','Namibia','Africa'),\n  ('Nauru','NR','NRU','Naoero/Nauru','Oceania'),\n  ('Nepal','NP','NPL','Nepal','Asia'),\n  ('Netherlands','NL','NLD','Nederland','Europe'),\n  ('New Caledonia','NC','NCL','Nouvelle-Cal\xe9donie','Oceania'),\n  ('New Zealand','NZ','NZL','New Zealand/Aotearoa','Oceania'),\n  ('Nicaragua','NI','NIC','Nicaragua','North America'),\n  ('Niger','NE','NER','Niger','Africa'),\n  ('Nigeria','NG','NGA','Nigeria','Africa'),\n  ('Niue','NU','NIU','Niue','Oceania'),\n  ('Norfolk Island','NF','NFK','Norfolk Island','Oceania'),\n  ('Northern Mariana Islands','MP','MNP','Northern Mariana Islands','Oceania'),\n  ('Norway','NO','NOR','Norge','Europe'),\n  ('Oman','OM','OMN','Oman','Asia'),\n  ('Pakistan','PK','PAK','Pakistan','Asia'),\n  ('Palau','PW','PLW','Belau/Palau','Oceania'),\n  ('Palestine, State of','PS','PSE','Filastin','Asia'),\n  ('Panama','PA','PAN','Rep\xfablica de Panam\xe1','North America'),\n  ('Papua New Guinea','PG','PNG','Papua New Guinea/Papua Niugini','Oceania'),\n  ('Paraguay','PY','PRY','Paraguay','South America'),\n  ('Peru','PE','PER','Per\xfa/Piruw','South America'),\n  ('Philippines','PH','PHL','Pilipinas','Asia'),\n  ('Pitcairn','PN','PCN','Pitcairn','Oceania'),\n  ('Poland','PL','POL','Polska','Europe'),\n  ('Portugal','PT','PRT','Portugal','Europe'),\n  ('Puerto Rico','PR','PRI','Puerto Rico','North America'),\n  ('Qatar','QA','QAT','Qatar','Asia'),\n  ('Reunion','RE','REU','Reunion','Africa'),\n  ('Romania','RO','ROM','Romania','Europe'),\n  ('Russian Federation','RU','RUS','Rossija','Europe'),\n  ('Rwanda','RW','RWA','Rwanda/Urwanda','Africa'),\n  ('Saint Helena, Ascension and Tristan da Cunha','SH','SHN','Saint Helena','Africa'),\n  ('Saint Kitts and Nevis','KN','KNA','Saint Kitts and Nevis','North America'),\n  ('Saint Lucia','LC','LCA','Saint Lucia','North America'),\n  ('Saint Pierre and Miquelon','PM','SPM','Saint-Pierre-et-Miquelon','North America'),\n  ('Saint Vincent and the Grenadines','VC','VCT','Saint Vincent and the Grenadines','North America'),\n  ('Samoa','WS','WSM','Samoa','Oceania'),\n  ('San Marino','SM','SMR','San Marino','Europe'),\n  ('Sao Tome and Principe','ST','STP','S\xe3o Tom\xe9 e Pr\xedncipe','Africa'),\n  ('Saudi Arabia','SA','SAU','Al-Mamlaka al-Arabiya as-Saudiya','Asia'),\n  ('Senegal','SN','SEN','S\xe9n\xe9gal/Sounougal','Africa'),\n  ('Seychelles','SC','SYC','Sesel/Seychelles','Africa'),\n  ('Sierra Leone','SL','SLE','Sierra Leone','Africa'),\n  ('Singapore','SG','SGP','Singapore/Singapura/Xinjiapo/Singapur','Asia'),\n  ('Slovakia','SK','SVK','Slovensko','Europe'),\n  ('Slovenia','SI','SVN','Slovenija','Europe'),\n  ('Solomon Islands','SB','SLB','Solomon Islands','Oceania'),\n  ('Somalia','SO','SOM','Soomaaliya','Africa'),\n  ('South Africa','ZA','ZAF','South Africa','Africa'),\n  ('South Georgia and the South Sandwich Islands','GS','SGS','South Georgia and the South Sandwich Islands','Antarctica'),\n  ('Spain','ES','ESP','Espa\xf1a','Europe'),\n  ('Sri Lanka','LK','LKA','Sri Lanka/Ilankai','Asia'),\n  ('Sudan','SD','SDN','As-Sudan','Africa'),\n  ('Suriname','SR','SUR','Suriname','South America'),\n  ('Svalbard and Jan Mayen','SJ','SJM','Svalbard og Jan Mayen','Europe'),\n  ('Swaziland','SZ','SWZ','kaNgwane','Africa'),\n  ('Sweden','SE','SWE','Sverige','Europe'),\n  ('Switzerland','CH','CHE','Schweiz/Suisse/Svizzera/Svizra','Europe'),\n  ('Syrian Arab Republic','SY','SYR','Suriya','Asia'),\n  ('Taiwan (Province of China)','TW','TWN','Tai-wan','Asia'),\n  ('Tajikistan','TJ','TJK','Tajikistan','Asia'),\n  ('Tanzania, United Republic of','TZ','TZA','Tanzania','Africa'),\n  ('Thailand','TH','THA','Prathet Thai','Asia'),\n  ('Togo','TG','TGO','Togo','Africa'),\n  ('Tokelau','TK','TKL','Tokelau','Oceania'),\n  ('Tonga','TO','TON','Tonga','Oceania'),\n  ('Trinidad and Tobago','TT','TTO','Trinidad and Tobago','North America'),\n  ('Tunisia','TN','TUN','Tunis/Tunisie','Africa'),\n  ('Turkey','TR','TUR','T\xfcrkiye','Asia'),\n  ('Turkmenistan','TM','TKM','T\xfcrkmenistan','Asia'),\n  ('Turks and Caicos Islands','TC','TCA','The Turks and Caicos Islands','North America'),\n  ('Tuvalu','TV','TUV','Tuvalu','Oceania'),\n  ('Uganda','UG','UGA','Uganda','Africa'),\n  ('Ukraine','UA','UKR','Ukrajina','Europe'),\n  ('United Arab Emirates','AE','ARE','Al-Amirat al-Arabiya al-Muttahida','Asia'),\n  ('United Kingdom','GB','GBR','United Kingdom','Europe'),\n  ('United States','US','USA','United States','North America'),\n  ('United States Minor Outlying Islands','UM','UMI','United States Minor Outlying Islands','Oceania'),\n  ('Uruguay','UY','URY','Uruguay','South America'),\n  ('Uzbekistan','UZ','UZB','Uzbekiston','Asia'),\n  ('Vanuatu','VU','VUT','Vanuatu','Oceania'),\n  ('Venezuela','VE','VEN','Venezuela','South America'),\n  ('Viet Nam','VN','VNM','Viet Nam','Asia'),\n  ('Virgin Islands (British)','VG','VGB','British Virgin Islands','North America'),\n  ('Virgin Islands (U.S.)','VI','VIR','Virgin Islands of the United States','North America'),\n  ('Wallis and Futuna','WF','WLF','Wallis-et-Futuna','Oceania'),\n  ('Western Sahara','EH','ESH','As-Sahrawiya','Africa'),\n  ('Yemen','YE','YEM','Al-Yaman','Asia'),\n  ('Zambia','ZM','ZMB','Zambia','Africa'),\n  ('Zimbabwe','ZW','ZWE','Zimbabwe','Africa'),\n  ('Afghanistan','AF','AFG','Afganistan/Afqanestan','Asia'),\n  ('Algeria','DZ','DZA','Al-Jazair/Algerie','Africa');\n".trim()},{id:12,type:"quickstart",title:"Slack Clone",description:"Build a basic slack clone with Row Level Security.",sql:"\n--\n-- For use with https://github.com/supabase/supabase/tree/master/examples/slack-clone/nextjs-slack-clone\n\n-- Custom types\ncreate type public.app_permission as enum ('channels.delete', 'messages.delete');\ncreate type public.app_role as enum ('admin', 'moderator');\ncreate type public.user_status as enum ('ONLINE', 'OFFLINE');\n\n-- USERS\ncreate table public.users (\n  id          uuid not null primary key, -- UUID from auth.users\n  username    text,\n  status      user_status default 'OFFLINE'::public.user_status\n);\ncomment on table public.users is 'Profile data for each user.';\ncomment on column public.users.id is 'References the internal Supabase Auth user.';\n\n-- CHANNELS\ncreate table public.channels (\n  id            bigint generated by default as identity primary key,\n  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,\n  slug          text not null unique,\n  created_by    uuid references public.users not null\n);\ncomment on table public.channels is 'Topics and groups.';\n\n-- MESSAGES\ncreate table public.messages (\n  id            bigint generated by default as identity primary key,\n  inserted_at   timestamp with time zone default timezone('utc'::text, now()) not null,\n  message       text,\n  user_id       uuid references public.users not null,\n  channel_id    bigint references public.channels on delete cascade not null\n);\ncomment on table public.messages is 'Individual messages sent by each user.';\n\n-- USER ROLES\ncreate table public.user_roles (\n  id        bigint generated by default as identity primary key,\n  user_id   uuid references public.users on delete cascade not null,\n  role      app_role not null,\n  unique (user_id, role)\n);\ncomment on table public.user_roles is 'Application roles for each user.';\n\n-- ROLE PERMISSIONS\ncreate table public.role_permissions (\n  id           bigint generated by default as identity primary key,\n  role         app_role not null,\n  permission   app_permission not null,\n  unique (role, permission)\n);\ncomment on table public.role_permissions is 'Application permissions for each role.';\n\n-- authorize with role-based access control (RBAC)\ncreate function public.authorize(\n  requested_permission app_permission,\n  user_id uuid\n)\nreturns boolean as\n$$\n  declare\n    bind_permissions int;\n  begin\n    select\n      count(*)\n    from public.role_permissions\n    inner join public.user_roles on role_permissions.role = user_roles.role\n    where\n      role_permissions.permission = authorize.requested_permission and\n      user_roles.user_id = authorize.user_id\n    into bind_permissions;\n\n    return bind_permissions > 0;\n  end;\n$$\nlanguage plpgsql security definer;\n\n-- Secure the tables\nalter table public.users\n  enable row level security;\nalter table public.channels\n  enable row level security;\nalter table public.messages\n  enable row level security;\nalter table public.user_roles\n  enable row level security;\nalter table public.role_permissions\n  enable row level security;\n\ncreate policy \"Allow logged-in read access\" on public.users\n  for select using (auth.role() = 'authenticated');\ncreate policy \"Allow individual insert access\" on public.users\n  for insert with check ((select auth.uid()) = id);\ncreate policy \"Allow individual update access\" on public.users\n  for update using ( (select auth.uid()) = id );\ncreate policy \"Allow logged-in read access\" on public.channels\n  for select using (auth.role() = 'authenticated');\ncreate policy \"Allow individual insert access\" on public.channels\n  for insert with check ((select auth.uid()) = created_by);\ncreate policy \"Allow individual delete access\" on public.channels\n  for delete using ((select auth.uid()) = created_by);\ncreate policy \"Allow authorized delete access\" on public.channels\n  for delete using (authorize('channels.delete', auth.uid()));\ncreate policy \"Allow logged-in read access\" on public.messages\n  for select using (auth.role() = 'authenticated');\ncreate policy \"Allow individual insert access\" on public.messages\n  for insert with check ((select auth.uid()) = user_id);\ncreate policy \"Allow individual update access\" on public.messages\n  for update using ((select auth.uid()) = user_id);\ncreate policy \"Allow individual delete access\" on public.messages\n  for delete using ((select auth.uid()) = user_id);\ncreate policy \"Allow authorized delete access\" on public.messages\n  for delete using (authorize('messages.delete', auth.uid()));\ncreate policy \"Allow individual read access\" on public.user_roles\n  for select using ((select auth.uid()) = user_id);\n\n-- Send \"previous data\" on change\nalter table public.users\n  replica identity full;\nalter table public.channels\n  replica identity full;\nalter table public.messages\n  replica identity full;\n\n-- inserts a row into public.users and assigns roles\ncreate function public.handle_new_user()\nreturns trigger\nset search_path = ''\nas $$\n  declare is_admin boolean;\n  begin\n    insert into public.users (id, username)\n    values (new.id, new.email);\n\n    select count(*) = 1 from auth.users into is_admin;\n\n    if position('+supaadmin@' in new.email) > 0 then\n      insert into public.user_roles (user_id, role) values (new.id, 'admin');\n    elsif position('+supamod@' in new.email) > 0 then\n      insert into public.user_roles (user_id, role) values (new.id, 'moderator');\n    end if;\n\n    return new;\n  end;\n$$ language plpgsql security definer;\n\n-- trigger the function every time a user is created\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row execute procedure public.handle_new_user();\n\n/**\n * REALTIME SUBSCRIPTIONS\n * Only allow realtime listening on public tables.\n */\n\nbegin;\n  -- remove the realtime publication\n  drop publication if exists supabase_realtime;\n\n  -- re-create the publication but don't enable it for any tables\n  create publication supabase_realtime;\ncommit;\n\n-- add tables to the publication\nalter publication supabase_realtime add table public.channels;\nalter publication supabase_realtime add table public.messages;\nalter publication supabase_realtime add table public.users;\n\n-- DUMMY DATA\ninsert into public.users (id, username)\nvalues\n    ('8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e', 'supabot');\n\ninsert into public.channels (slug, created_by)\nvalues\n    ('public', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),\n    ('random', '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');\n\ninsert into public.messages (message, channel_id, user_id)\nvalues\n    ('Hello World \uD83D\uDC4B', 1, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e'),\n    ('Perfection is attained, not when there is nothing more to add, but when there is nothing left to take away.', 2, '8d0fd2b3-9ca7-4d9e-a95f-9e13dded323e');\n\ninsert into public.role_permissions (role, permission)\nvalues\n    ('admin', 'channels.delete'),\n    ('admin', 'messages.delete'),\n    ('moderator', 'messages.delete');\n".trim()},{id:13,type:"quickstart",title:"Todo List",description:"Build a basic todo list with Row Level Security.",sql:'\n--\n-- For use with:\n-- https://github.com/supabase/supabase/tree/master/examples/todo-list/sveltejs-todo-list or\n-- https://github.com/supabase/examples-archive/tree/main/supabase-js-v1/todo-list\n--\n\ncreate table todos (\n  id bigint generated by default as identity primary key,\n  user_id uuid references auth.users not null,\n  task text check (char_length(task) > 3),\n  is_complete boolean default false,\n  inserted_at timestamp with time zone default timezone(\'utc\'::text, now()) not null\n);\nalter table todos enable row level security;\ncreate policy "Individuals can create todos." on todos for\n    insert with check (auth.uid() = user_id);\ncreate policy "Individuals can view their own todos. " on todos for\n    select using ((select auth.uid()) = user_id);\ncreate policy "Individuals can update their own todos." on todos for\n    update using ((select auth.uid()) = user_id);\ncreate policy "Individuals can delete their own todos." on todos for\n    delete using ((select auth.uid()) = user_id);\n'.trim()},{id:14,type:"quickstart",title:"Stripe Subscriptions",description:"Starter template for the Next.js Stripe Subscriptions Starter.",sql:"\n/**\n* USERS\n* Note: This table contains user data. Users should only be able to view and update their own data.\n*/\ncreate table users (\n  -- UUID from auth.users\n  id uuid references auth.users not null primary key,\n  full_name text,\n  avatar_url text,\n  -- The customer's billing address, stored in JSON format.\n  billing_address jsonb,\n  -- Stores your customer's payment instruments.\n  payment_method jsonb\n);\nalter table users\n  enable row level security;\ncreate policy \"Can view own user data.\" on users\n  for select using ((select auth.uid()) = id);\ncreate policy \"Can update own user data.\" on users\n  for update using ((select auth.uid()) = id);\n\n/**\n* This trigger automatically creates a user entry when a new user signs up via Supabase Auth.\n*/\ncreate function public.handle_new_user()\nreturns trigger\nset search_path = ''\nas $$\n  begin\n    insert into public.users (id, full_name, avatar_url)\n    values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');\n    return new;\n  end;\n$$\nlanguage plpgsql security definer;\n\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row\n    execute procedure public.handle_new_user();\n\n/**\n* CUSTOMERS\n* Note: this is a private table that contains a mapping of user IDs to Stripe customer IDs.\n*/\ncreate table customers (\n  -- UUID from auth.users\n  id uuid references auth.users not null primary key,\n  -- The user's customer ID in Stripe. User must not be able to update this.\n  stripe_customer_id text\n);\nalter table customers enable row level security;\n-- No policies as this is a private table that the user must not have access to.\n\n/**\n* PRODUCTS\n* Note: products are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate table products (\n  -- Product ID from Stripe, e.g. prod_1234.\n  id text primary key,\n  -- Whether the product is currently available for purchase.\n  active boolean,\n  -- The product's name, meant to be displayable to the customer. Whenever this product is sold via a subscription, name will show up on associated invoice line item descriptions.\n  name text,\n  -- The product's description, meant to be displayable to the customer. Use this field to optionally store a long form explanation of the product being sold for your own rendering purposes.\n  description text,\n  -- A URL of the product image in Stripe, meant to be displayable to the customer.\n  image text,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb\n);\nalter table products\n  enable row level security;\ncreate policy \"Allow public read-only access.\" on products\n  for select using (true);\n\n/**\n* PRICES\n* Note: prices are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate type pricing_type as enum ('one_time', 'recurring');\ncreate type pricing_plan_interval as enum ('day', 'week', 'month', 'year');\ncreate table prices (\n  -- Price ID from Stripe, e.g. price_1234.\n  id text primary key,\n  -- The ID of the prduct that this price belongs to.\n  product_id text references products,\n  -- Whether the price can be used for new purchases.\n  active boolean,\n  -- A brief description of the price.\n  description text,\n  -- The unit amount as a positive integer in the smallest currency unit (e.g., 100 cents for US$1.00 or 100 for \xa5100, a zero-decimal currency).\n  unit_amount bigint,\n  -- Three-letter ISO currency code, in lowercase.\n  currency text check (char_length(currency) = 3),\n  -- One of `one_time` or `recurring` depending on whether the price is for a one-time purchase or a recurring (subscription) purchase.\n  type pricing_type,\n  -- The frequency at which a subscription is billed. One of `day`, `week`, `month` or `year`.\n  interval pricing_plan_interval,\n  -- The number of intervals (specified in the `interval` attribute) between subscription billings. For example, `interval=month` and `interval_count=3` bills every 3 months.\n  interval_count integer,\n  -- Default number of trial days when subscribing a customer to this price using [`trial_from_plan=true`](https://stripe.com/docs/api#create_subscription-trial_from_plan).\n  trial_period_days integer,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb\n);\nalter table prices\n  enable row level security;\ncreate policy \"Allow public read-only access.\" on prices\n  for select using (true);\n\n/**\n* SUBSCRIPTIONS\n* Note: subscriptions are created and managed in Stripe and synced to our DB via Stripe webhooks.\n*/\ncreate type subscription_status as enum ('trialing', 'active', 'canceled', 'incomplete', 'incomplete_expired', 'past_due', 'unpaid');\ncreate table subscriptions (\n  -- Subscription ID from Stripe, e.g. sub_1234.\n  id text primary key,\n  user_id uuid references auth.users not null,\n  -- The status of the subscription object, one of subscription_status type above.\n  status subscription_status,\n  -- Set of key-value pairs, used to store additional information about the object in a structured format.\n  metadata jsonb,\n  -- ID of the price that created this subscription.\n  price_id text references prices,\n  -- Quantity multiplied by the unit amount of the price creates the amount of the subscription. Can be used to charge multiple seats.\n  quantity integer,\n  -- If true the subscription has been canceled by the user and will be deleted at the end of the billing period.\n  cancel_at_period_end boolean,\n  -- Time at which the subscription was created.\n  created timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- Start of the current period that the subscription has been invoiced for.\n  current_period_start timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- End of the current period that the subscription has been invoiced for. At the end of this period, a new invoice will be created.\n  current_period_end timestamp with time zone default timezone('utc'::text, now()) not null,\n  -- If the subscription has ended, the timestamp of the date the subscription ended.\n  ended_at timestamp with time zone default timezone('utc'::text, now()),\n  -- A date in the future at which the subscription will automatically get canceled.\n  cancel_at timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has been canceled, the date of that cancellation. If the subscription was canceled with `cancel_at_period_end`, `canceled_at` will still reflect the date of the initial cancellation request, not the end of the subscription period when the subscription is automatically moved to a canceled state.\n  canceled_at timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has a trial, the beginning of that trial.\n  trial_start timestamp with time zone default timezone('utc'::text, now()),\n  -- If the subscription has a trial, the end of that trial.\n  trial_end timestamp with time zone default timezone('utc'::text, now())\n);\nalter table subscriptions\n  enable row level security;\ncreate policy \"Can only view own subs data.\" on subscriptions\n  for select using ((select auth.uid()) = user_id);\n\n/**\n * REALTIME SUBSCRIPTIONS\n * Only allow realtime listening on public tables.\n */\ndrop publication if exists supabase_realtime;\ncreate publication supabase_realtime\n  for table products, prices;\n".trim()},{id:15,type:"quickstart",title:"User Management Starter",description:"Sets up a public Profiles table which you can access with your API.",sql:"\n-- Create a table for public profiles\ncreate table profiles (\n  id uuid references auth.users on delete cascade not null primary key,\n  updated_at timestamp with time zone,\n  username text unique,\n  full_name text,\n  avatar_url text,\n  website text,\n\n  constraint username_length check (char_length(username) >= 3)\n);\n-- Set up Row Level Security (RLS)\n-- See https://supabase.com/docs/guides/auth/row-level-security for more details.\nalter table profiles\n  enable row level security;\n\ncreate policy \"Public profiles are viewable by everyone.\" on profiles\n  for select using (true);\n\ncreate policy \"Users can insert their own profile.\" on profiles\n  for insert with check ((select auth.uid()) = id);\n\ncreate policy \"Users can update own profile.\" on profiles\n  for update using ((select auth.uid()) = id);\n\n-- This trigger automatically creates a profile entry when a new user signs up via Supabase Auth.\n-- See https://supabase.com/docs/guides/auth/managing-user-data#using-triggers for more details.\ncreate function public.handle_new_user()\nreturns trigger\nset search_path = ''\nas $$\nbegin\n  insert into public.profiles (id, full_name, avatar_url)\n  values (new.id, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');\n  return new;\nend;\n$$ language plpgsql security definer;\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row execute procedure public.handle_new_user();\n\n-- Set up Storage!\ninsert into storage.buckets (id, name)\n  values ('avatars', 'avatars');\n\n-- Set up access controls for storage.\n-- See https://supabase.com/docs/guides/storage#policy-examples for more details.\ncreate policy \"Avatar images are publicly accessible.\" on storage.objects\n  for select using (bucket_id = 'avatars');\n\ncreate policy \"Anyone can upload an avatar.\" on storage.objects\n  for insert with check (bucket_id = 'avatars');\n".trim()},{id:16,type:"quickstart",title:"NextAuth Schema Setup",description:"Sets up a the Schema and Tables for the NextAuth Supabase Adapter.",sql:'\n--\n-- Name: next_auth; Type: SCHEMA;\n--\nCREATE SCHEMA next_auth;\n\nGRANT USAGE ON SCHEMA next_auth TO service_role;\nGRANT ALL ON SCHEMA next_auth TO postgres;\n\n--\n-- Create users table\n--\nCREATE TABLE IF NOT EXISTS next_auth.users\n(\n    id uuid NOT NULL DEFAULT gen_random_uuid(),\n    name text,\n    email text,\n    "emailVerified" timestamp with time zone,\n    image text,\n    CONSTRAINT users_pkey PRIMARY KEY (id),\n    CONSTRAINT email_unique UNIQUE (email)\n);\n\nGRANT ALL ON TABLE next_auth.users TO postgres;\nGRANT ALL ON TABLE next_auth.users TO service_role;\n\n--- uid() function to be used in RLS policies\nCREATE FUNCTION next_auth.uid() RETURNS uuid\n    LANGUAGE sql STABLE\n    AS $$\n  select\n    coalesce(\n        nullif(current_setting(\'request.jwt.claim.sub\', true), \'\'),\n        (nullif(current_setting(\'request.jwt.claims\', true), \'\')::jsonb ->> \'sub\')\n    )::uuid\n$$;\n\n--\n-- Create sessions table\n--\nCREATE TABLE IF NOT EXISTS  next_auth.sessions\n(\n    id uuid NOT NULL DEFAULT gen_random_uuid(),\n    expires timestamp with time zone NOT NULL,\n    "sessionToken" text NOT NULL,\n    "userId" uuid,\n    CONSTRAINT sessions_pkey PRIMARY KEY (id),\n    CONSTRAINT sessionToken_unique UNIQUE ("sessionToken"),\n    CONSTRAINT "sessions_userId_fkey" FOREIGN KEY ("userId")\n        REFERENCES  next_auth.users (id) MATCH SIMPLE\n        ON UPDATE NO ACTION\n        ON DELETE CASCADE\n);\n\nGRANT ALL ON TABLE next_auth.sessions TO postgres;\nGRANT ALL ON TABLE next_auth.sessions TO service_role;\n\n--\n-- Create accounts table\n--\nCREATE TABLE IF NOT EXISTS  next_auth.accounts\n(\n    id uuid NOT NULL DEFAULT gen_random_uuid(),\n    type text NOT NULL,\n    provider text NOT NULL,\n    "providerAccountId" text NOT NULL,\n    refresh_token text,\n    access_token text,\n    expires_at bigint,\n    token_type text,\n    scope text,\n    id_token text,\n    session_state text,\n    oauth_token_secret text,\n    oauth_token text,\n    "userId" uuid,\n    CONSTRAINT accounts_pkey PRIMARY KEY (id),\n    CONSTRAINT provider_unique UNIQUE (provider, "providerAccountId"),\n    CONSTRAINT "accounts_userId_fkey" FOREIGN KEY ("userId")\n        REFERENCES  next_auth.users (id) MATCH SIMPLE\n        ON UPDATE NO ACTION\n        ON DELETE CASCADE\n);\n\nGRANT ALL ON TABLE next_auth.accounts TO postgres;\nGRANT ALL ON TABLE next_auth.accounts TO service_role;\n\n--\n-- Create verification_tokens table\n--\nCREATE TABLE IF NOT EXISTS  next_auth.verification_tokens\n(\n    identifier text,\n    token text,\n    expires timestamp with time zone NOT NULL,\n    CONSTRAINT verification_tokens_pkey PRIMARY KEY (token),\n    CONSTRAINT token_unique UNIQUE (token),\n    CONSTRAINT token_identifier_unique UNIQUE (token, identifier)\n);\n\nGRANT ALL ON TABLE next_auth.verification_tokens TO postgres;\nGRANT ALL ON TABLE next_auth.verification_tokens TO service_role;\n'.trim()},{id:17,type:"template",title:"Most frequently invoked",description:"Most frequently called queries in your database.",sql:"-- Most frequently called queries\n\n-- A limit of 100 has been added below\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  order by\n    statements.calls desc\n  limit\n    100;"},{id:18,type:"template",title:"Most time consuming",description:"Aggregate time spent on a query type.",sql:"-- Most time consuming queries\n\n-- A limit of 100 has been added below\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    to_char(((statements.total_exec_time + statements.total_plan_time)/sum(statements.total_exec_time + statements.total_plan_time) over()) * 100, 'FM90D0') || '%' as prop_total_time\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  order by\n    total_time desc\n  limit\n    100;"},{id:19,type:"template",title:"Slowest execution time",description:"Slowest queries based on max execution time.",sql:"-- Slowest queries by max execution time\n\n-- A limit of 100 has been added below\n\nselect\n    auth.rolname,\n    statements.query,\n    statements.calls,\n    -- -- Postgres 13, 14, 15\n    statements.total_exec_time + statements.total_plan_time as total_time,\n    statements.min_exec_time + statements.min_plan_time as min_time,\n    statements.max_exec_time + statements.max_plan_time as max_time,\n    statements.mean_exec_time + statements.mean_plan_time as mean_time,\n    -- -- Postgres <= 12\n    -- total_time,\n    -- min_time,\n    -- max_time,\n    -- mean_time,\n    statements.rows / statements.calls as avg_rows\n  from pg_stat_statements as statements\n    inner join pg_authid as auth on statements.userid = auth.oid\n  order by\n    max_time desc\n  limit\n    100;"},{id:20,type:"template",title:"Hit rate",description:"See your cache and index hit rate.",sql:"-- Cache and index hit rate\n\nselect\n    'index hit rate' as name,\n    (sum(idx_blks_hit)) / nullif(sum(idx_blks_hit + idx_blks_read),0) as ratio\n  from pg_statio_user_indexes\n  union all\n  select\n    'table hit rate' as name,\n    sum(heap_blks_hit) / nullif(sum(heap_blks_hit) + sum(heap_blks_read),0) as ratio\n  from pg_statio_user_tables;"},{id:21,type:"quickstart",title:"OpenAI Vector Search",description:"Template for the Next.js OpenAI Doc Search Starter.",sql:'\n-- Enable pg_vector extension\ncreate extension if not exists vector with schema public;\n\n-- Create tables\ncreate table "public"."nods_page" (\n  id bigserial primary key,\n  parent_page_id bigint references public.nods_page,\n  path text not null unique,\n  checksum text,\n  meta jsonb,\n  type text,\n  source text\n);\nalter table "public"."nods_page" enable row level security;\n\ncreate table "public"."nods_page_section" (\n  id bigserial primary key,\n  page_id bigint not null references public.nods_page on delete cascade,\n  content text,\n  token_count int,\n  embedding vector(1536),\n  slug text,\n  heading text\n);\nalter table "public"."nods_page_section" enable row level security;\n\n-- Create embedding similarity search functions\ncreate or replace function match_page_sections(embedding vector(1536), match_threshold float, match_count int, min_content_length int)\nreturns table (id bigint, page_id bigint, slug text, heading text, content text, similarity float)\nlanguage plpgsql\nas $$\n#variable_conflict use_variable\nbegin\n  return query\n  select\n    nods_page_section.id,\n    nods_page_section.page_id,\n    nods_page_section.slug,\n    nods_page_section.heading,\n    nods_page_section.content,\n    (nods_page_section.embedding <#> embedding) * -1 as similarity\n  from nods_page_section\n\n  -- We only care about sections that have a useful amount of content\n  where length(nods_page_section.content) >= min_content_length\n\n  -- The dot product is negative because of a Postgres limitation, so we negate it\n  and (nods_page_section.embedding <#> embedding) * -1 > match_threshold\n\n  -- OpenAI embeddings are normalized to length 1, so\n  -- cosine similarity and dot product will produce the same results.\n  -- Using dot product which can be computed slightly faster.\n  --\n  -- For the different syntaxes, see https://github.com/pgvector/pgvector\n  order by nods_page_section.embedding <#> embedding\n\n  limit match_count;\nend;\n$$;\n\ncreate or replace function get_page_parents(page_id bigint)\nreturns table (id bigint, parent_page_id bigint, path text, meta jsonb)\nlanguage sql\nas $$\n  with recursive chain as (\n    select *\n    from nods_page\n    where id = page_id\n\n    union all\n\n    select child.*\n      from nods_page as child\n      join chain on chain.parent_page_id = child.id\n  )\n  select id, parent_page_id, path, meta\n  from chain;\n$$;\n'.trim()},{id:22,type:"template",title:"Replication status report",description:"See the status of your replication slots and replication lag.",sql:"-- Replication status report\n\nSELECT\n  s.slot_name,\n  s.active,\n  COALESCE(r.state, 'N/A') as state,\n  COALESCE(r.client_addr, null) as replication_client_address,\n  GREATEST(0, ROUND((redo_lsn-restart_lsn)/1024/1024/1024, 2)) as replication_lag_gb\nFROM pg_control_checkpoint(), pg_replication_slots s\nLEFT JOIN pg_stat_replication r ON (r.pid = s.active_pid);\n"},{id:23,type:"quickstart",title:"LangChain",description:"LangChain is a popular framework for working with AI, Vectors, and embeddings.",sql:"\n-- Enable the pgvector extension to work with embedding vectors\ncreate extension vector;\n\n-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);\n\n-- Create a function to search for documents\ncreate function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;\n".trim()},{id:24,type:"template",title:"Install dbdev",description:"dbdev is a client for installing Trusted Language Extensions (TLE) into your database.",sql:"\n/*---------------------\n---- install dbdev ----\n-----------------------\nRequires:\n  - pg_tle: https://github.com/aws/pg_tle\n  - pgsql-http: https://github.com/pramsey/pgsql-http\n\nWarning:\nRestoring a logical backup of a database with a TLE installed can fail.\nFor this reason, dbdev should only be used with databases with physical backups enabled.\n*/\ncreate extension if not exists http with schema extensions;\ncreate extension if not exists pg_tle;\nselect pgtle.uninstall_extension_if_exists('supabase-dbdev');\ndrop extension if exists \"supabase-dbdev\";\nselect\n    pgtle.install_extension(\n        'supabase-dbdev',\n        resp.contents ->> 'version',\n        'PostgreSQL package manager',\n        resp.contents ->> 'sql'\n    )\nfrom http(\n    (\n        'GET',\n        'https://api.database.dev/rest/v1/'\n        || 'package_versions?select=sql,version'\n        || '&package_name=eq.supabase-dbdev'\n        || '&order=version.desc'\n        || '&limit=1',\n        array[\n            ('apiKey', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtdXB0cHBsZnZpaWZyYndtbXR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODAxMDczNzIsImV4cCI6MTk5NTY4MzM3Mn0.z2CN0mvO2No8wSi46Gw59DFGCTJrzM0AQKsu_5k134s')::http_header\n        ],\n        null,\n        null\n    )\n) x,\nlateral (\n    select\n        ((row_to_json(x) -> 'content') #>> '{}')::json -> 0\n) resp(contents);\ncreate extension \"supabase-dbdev\";\nselect dbdev.install('supabase-dbdev');\ndrop extension if exists \"supabase-dbdev\";\ncreate extension \"supabase-dbdev\";\n".trim()},{id:25,type:"template",title:"Large objects",description:"List large objects (tables/indexes) in your database.",sql:"SELECT\n    SCHEMA_NAME,\n    relname,\n    table_size\n  FROM\n    (SELECT\n      pg_catalog.pg_namespace.nspname AS SCHEMA_NAME,\n      relname,\n      pg_relation_size(pg_catalog.pg_class.oid) AS table_size\n    FROM pg_catalog.pg_class\n    JOIN pg_catalog.pg_namespace ON relnamespace = pg_catalog.pg_namespace.oid\n    ) t\n  WHERE SCHEMA_NAME NOT LIKE 'pg_%'\n  ORDER BY table_size DESC\n  LIMIT 25".trim()},{id:26,type:"template",title:"Limit MFA verification attempts to one in 2 seconds",description:"Create an Auth hook that limits the number of failed MFA verification attempts to one in 2 seconds.",sql:"\ncreate function public.hook_mfa_verification_attempt(event jsonb)\n  returns jsonb\n  language plpgsql\nas $$\n  declare\n    last_failed_at timestamp;\n  begin\n    if event->'valid' is true then\n      -- code is valid, accept it\n      return jsonb_build_object('decision', 'continue');\n    end if;\n\n    select last_failed_at into last_failed_at\n      from public.mfa_failed_verification_attempts\n      where\n        user_id = (event->'user_id')::uuid\n          and\n        factor_id = event->'factor_id';\n\n    if last_failed_at is not null and now() - last_failed_at < interval '2 seconds' then\n      -- last attempt was done too quickly\n      return jsonb_build_object(\n        'error', jsonb_build_object(\n          'http_code', 429,\n          'message',   'Please wait a moment before trying again.'\n        )\n      );\n    end if;\n\n    -- record this failed attempt\n    insert into public.mfa_failed_verification_attempts\n      (\n        user_id,\n        factor_id,\n        last_refreshed_at\n      )\n      values\n      (\n        event->'user_id',\n        event->'factor_id',\n        now()\n      )\n      on conflict do update\n        set last_refreshed_at = now();\n\n    -- finally let Supabase Auth do the default behavior for a failed attempt\n    return jsonb_build_object('decision', 'continue');\n  end;\n$$;\n\n-- Assign appropriate permissions and revoke access\ngrant execute\n  on function public.hook_mfa_verification_attempt\n  to supabase_auth_admin;\n\ngrant all\n  on table public.mfa_failed_verification_attempts\n  to supabase_auth_admin;\n\nrevoke execute\n  on function public.hook_mfa_verification_attempt\n  from authenticated, anon, public;\n\nrevoke all\n  on table public.mfa_failed_verification_attempts\n  from authenticated, anon, public;\n\ngrant usage on schema public to supabase_auth_admin;".trim()},{id:27,type:"template",title:"Add Auth Hook (Password Verification Attempt)",description:"Create an Auth Hook that limits number of failed password verification attempts to one in 10 seconds",sql:"\ncreate function public.hook_password_verification_attempt(event jsonb)\nreturns jsonb\nlanguage plpgsql\nas $$\n  declare\n    last_failed_at timestamp;\n  begin\n    if event->'valid' is true then\n      -- password is valid, accept it\n      return jsonb_build_object('decision', 'continue');\n    end if;\n\n    select last_failed_at into last_failed_at\n      from public.password_failed_verification_attempts\n      where\n        user_id = (event->'user_id')::uuid;\n\n    if last_failed_at is not null and now() - last_failed_at < interval '10 seconds' then\n      -- last attempt was done too quickly\n      return jsonb_build_object(\n        'error', jsonb_build_object(\n          'http_code', 429,\n          'message',   'Please wait a moment before trying again.'\n        )\n      );\n    end if;\n\n    -- record this failed attempt\n    insert into public.password_failed_verification_attempts\n      (\n        user_id,\n        last_failed_at\n      )\n      values\n      (\n        event->'user_id',\n        now()\n      )\n      on conflict do update\n        set last_failed_at = now();\n\n    -- finally let Supabase Auth do the default behavior for a failed attempt\n    return jsonb_build_object('decision', 'continue');\n  end;\n$$;\n\n-- Assign appropriate permissions\ngrant execute\n  on function public.hook_password_verification_attempt\n  to supabase_auth_admin;\n\ngrant all\n  on table public.password_failed_verification_attempts\n  to supabase_auth_admin;\n\nrevoke execute\n  on function public.hook_password_verification_attempt\n  from authenticated, anon, public;\n\nrevoke all\n  on table public.password_failed_verification_attempts\n  from authenticated, anon, public;\n\ngrant usage on schema public to supabase_auth_admin;".trim()},{id:28,type:"template",title:"Add Auth Hook (Custom Access Token)",description:"Create an Auth Hook to add custom claims to your Auth Token",sql:"\n-- Assumes that there is an is_admin flag on the profiles table.\ncreate or replace function public.custom_access_token_hook(event jsonb)\nreturns jsonb\nlanguage plpgsql\nas $$\n  declare\n    claims jsonb;\n    is_admin boolean;\n  begin\n    -- Check if the user is marked as admin in the profiles table\n    select is_admin into is_admin from profiles where user_id = (event->>'user_id')::uuid;\n\n    -- Proceed only if the user is an admin\n    if is_admin then\n      claims := event->'claims';\n\n      -- Check if 'user_metadata' exists in claims\n      if jsonb_typeof(claims->'user_metadata') is null then\n        -- If 'user_metadata' does not exist, create an empty object\n        claims := jsonb_set(claims, '{user_metadata}', '{}');\n      end if;\n\n      -- Set a claim of 'admin'\n      claims := jsonb_set(claims, '{user_metadata, admin}', 'true');\n\n      -- Update the 'claims' object in the original event\n      event := jsonb_set(event, '{claims}', claims);\n    end if;\n\n    -- Return the modified or original event\n    return event;\n  end;\n$$;\n\ngrant execute\n  on function public.custom_access_token_hook\n  to supabase_auth_admin;\n\nrevoke execute\n  on function public.custom_access_token_hook\n  from authenticated, anon, public;\n\ngrant usage on schema public to supabase_auth_admin;".trim()},{id:29,type:"template",title:"Add Auth Hook (General)",description:"Create an Auth Hook",sql:"\ncreate or replace function public.custom_access_token_hook(event jsonb)\nreturns jsonb\nlanguage plpgsql\nas $$\ndeclare\n  -- Insert variables here\nbegin\n  -- Insert logic here\n  return event;\nend;\n$$;\n-- Permissions for the hook\ngrant execute on function public.custom_access_token_hook to supabase_auth_admin;\nrevoke execute on function public.custom_access_token_hook from authenticated, anon, public;\n    "}]},59108:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var a=t(97458),i=t(54962),s=t.n(i),r=()=>(0,a.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center","data-sentry-component":"LogoLoader","data-sentry-source-file":"LogoLoader.tsx",children:(0,a.jsx)("div",{children:(0,a.jsx)("svg",{width:"60",height:"62",viewBox:"0 0 60 62",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:s().loading,"data-sentry-element":"svg","data-sentry-source-file":"LogoLoader.tsx",children:(0,a.jsx)("path",{d:"M30.2571 4.12811L30.257 4.12389C30.2133 1.21067 26.5349 -0.034778 24.7224 2.24311L1.76109 31.0996C-1.21104 34.8348 1.45637 40.34 6.23131 40.34H29.4845L29.7563 58.4432C29.8 61.3564 33.4783 62.6016 35.2908 60.324L34.8996 60.0127L35.2908 60.324L58.2521 31.4674C61.2241 27.7322 58.5568 22.227 53.782 22.227H30.3762L30.2571 4.12811Z",stroke:"hsl(var(--brand-default))",strokeWidth:2,strokeLinecap:"round","data-sentry-element":"path","data-sentry-source-file":"LogoLoader.tsx"})})})})},54962:function(e){e.exports={loading:"loading-anim_loading__rDN7u",dash:"loading-anim_dash__HIPR0"}}}]);